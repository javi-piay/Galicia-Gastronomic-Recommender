{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "r59EhgQpQBJF"
   },
   "source": [
    "# üìä Cap√≠tulo 6: Modelo de Recomendaci√≥n H√≠brido\n",
    "\n",
    "## ¬øEn qu√© consiste este modelo?\n",
    "\n",
    "En este cap√≠tulo desarrollamos un **sistema h√≠brido de recomendaci√≥n** basado en el contenido de los restaurantes.  \n",
    "Dado que no disponemos de datos de usuarios individuales (necesarios para un filtrado colaborativo cl√°sico), nos centramos en un h√≠brido **dentro del enfoque content-based**, que combina varios mecanismos:\n",
    "\n",
    "1. **üîé B√∫squeda por texto libre**  \n",
    "   El usuario puede introducir consultas (*ej: ‚Äúpulpo gallego barato‚Äù*) y encontrar restaurantes relevantes a partir de descripciones, rese√±as y categor√≠as.\n",
    "\n",
    "2. **üçî Filtros por categor√≠as, flags y subcategor√≠as**  \n",
    "   El sistema permite activar filtros como *vegano, hamburguesas, italiana, gourmet*, etc. (`flag_*`), as√≠ como subcategor√≠as m√°s espec√≠ficas (*ej: `subcat_espa√±ola_pulpo`, `subcat_veggie_sin_gluten`*).\n",
    "\n",
    "3. **üìä Ordenaci√≥n personalizada**  \n",
    "   Los resultados pueden ordenarse por criterios como `rating_final`, `reviews_final`, `price_num` o la m√©trica interna `score`.\n",
    "\n",
    "4. **üìç Proximidad geogr√°fica y horarios**  \n",
    "   Adem√°s, se incorporan filtros por distancia (Haversine o rutas reales con ORS) y disponibilidad horaria (`horarios_norm`), para que el usuario vea solo restaurantes cercanos y abiertos.\n",
    "\n",
    "Este **enfoque mixto** combina b√∫squeda sem√°ntica, filtrado, ordenaci√≥n y proximidad, ofreciendo una experiencia flexible y realista de exploraci√≥n gastron√≥mica.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "executionInfo": {
     "elapsed": 517,
     "status": "ok",
     "timestamp": 1763222028384,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "X6DXQsBAQG78",
    "outputId": "fe99313f-487d-4b40-82d2-4db0f208659c"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Dataset cargado: (3357, 83)\n",
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 3357 entries, 0 to 3356\n",
      "Data columns (total 83 columns):\n",
      " #   Column                           Non-Null Count  Dtype  \n",
      "---  ------                           --------------  -----  \n",
      " 0   id                               3357 non-null   int64  \n",
      " 1   nombre_final                     3357 non-null   object \n",
      " 2   nombre_final_norm                3357 non-null   object \n",
      " 3   ciudad                           3357 non-null   object \n",
      " 4   latitude                         3317 non-null   float64\n",
      " 5   longitude                        3317 non-null   float64\n",
      " 6   rating_final                     3357 non-null   float64\n",
      " 7   reviews_final                    3357 non-null   int64  \n",
      " 8   price_num                        2841 non-null   float64\n",
      " 9   score                            3336 non-null   float64\n",
      " 10  horarios_norm                    3357 non-null   object \n",
      " 11  maps_url_final                   3357 non-null   object \n",
      " 12  cuisines_traducidas              3357 non-null   object \n",
      " 13  platos_detectados                2523 non-null   object \n",
      " 14  categorias_asignadas             3357 non-null   object \n",
      " 15  review_keywords_es               232 non-null    object \n",
      " 16  diets_es                         482 non-null    object \n",
      " 17  meal_types_es                    1518 non-null   object \n",
      " 18  dining_options_es                1207 non-null   object \n",
      " 19  top_tags_es                      1405 non-null   object \n",
      " 20  address_norm                     3357 non-null   object \n",
      " 21  delivery                         2837 non-null   float64\n",
      " 22  reservable                       2385 non-null   float64\n",
      " 23  flag_pizza                       3357 non-null   int64  \n",
      " 24  flag_hamburguesas                3357 non-null   int64  \n",
      " 25  flag_turca                       3357 non-null   int64  \n",
      " 26  flag_mexicana                    3357 non-null   int64  \n",
      " 27  flag_italiana                    3357 non-null   int64  \n",
      " 28  flag_asi√°tica                    3357 non-null   int64  \n",
      " 29  flag_espa√±ola                    3357 non-null   int64  \n",
      " 30  flag_carnes                      3357 non-null   int64  \n",
      " 31  flag_veggie                      3357 non-null   int64  \n",
      " 32  flag_desayunos                   3357 non-null   int64  \n",
      " 33  flag_dulces                      3357 non-null   int64  \n",
      " 34  flag_r√°pida                      3357 non-null   int64  \n",
      " 35  flag_poke                        3357 non-null   int64  \n",
      " 36  flag_latina                      3357 non-null   int64  \n",
      " 37  flag_√°rabe                       3357 non-null   int64  \n",
      " 38  flag_africana                    3357 non-null   int64  \n",
      " 39  flag_gourmet                     3357 non-null   int64  \n",
      " 40  flag_europea                     3357 non-null   int64  \n",
      " 41  nombre_simplificado              3354 non-null   object \n",
      " 42  texto_combinado                  3357 non-null   object \n",
      " 43  subcat_veggie_vegetariano        3357 non-null   int64  \n",
      " 44  subcat_veggie_vegano             3357 non-null   int64  \n",
      " 45  subcat_veggie_sin_gluten         3357 non-null   int64  \n",
      " 46  subcat_latina_venezolana         3357 non-null   int64  \n",
      " 47  subcat_latina_brasile√±a          3357 non-null   int64  \n",
      " 48  subcat_latina_salvadore√±a        3357 non-null   int64  \n",
      " 49  subcat_latina_peruana            3357 non-null   int64  \n",
      " 50  subcat_latina_boliviana          3357 non-null   int64  \n",
      " 51  subcat_latina_argentina          3357 non-null   int64  \n",
      " 52  subcat_espa√±ola_pescados         3357 non-null   int64  \n",
      " 53  subcat_espa√±ola_men√∫_del_d√≠a     3357 non-null   int64  \n",
      " 54  subcat_espa√±ola_arroces          3357 non-null   int64  \n",
      " 55  subcat_espa√±ola_tapas            3357 non-null   int64  \n",
      " 56  subcat_espa√±ola_pulpo            3357 non-null   int64  \n",
      " 57  subcat_espa√±ola_mariscos         3357 non-null   int64  \n",
      " 58  subcat_espa√±ola_cocina_gallega   3357 non-null   int64  \n",
      " 59  subcat_otros_ocio                3357 non-null   int64  \n",
      " 60  subcat_otros_supermercados       3357 non-null   int64  \n",
      " 61  subcat_otros_bares               3357 non-null   int64  \n",
      " 62  subcat_otros_miscel√°nea          3357 non-null   int64  \n",
      " 63  subcat_gourmet_men√∫_degustaci√≥n  3357 non-null   int64  \n",
      " 64  subcat_dulces_helados            3357 non-null   int64  \n",
      " 65  subcat_dulces_pasteler√≠as        3357 non-null   int64  \n",
      " 66  subcat_desayunos_brunch          3357 non-null   int64  \n",
      " 67  subcat_desayunos_cafeter√≠a       3357 non-null   int64  \n",
      " 68  subcat_asi√°tica_ramen            3357 non-null   int64  \n",
      " 69  subcat_asi√°tica_china            3357 non-null   int64  \n",
      " 70  subcat_asi√°tica_japonesa         3357 non-null   int64  \n",
      " 71  subcat_asi√°tica_india            3357 non-null   int64  \n",
      " 72  subcat_r√°pida_bocadillos         3357 non-null   int64  \n",
      " 73  subcat_r√°pida_autoservicio       3357 non-null   int64  \n",
      " 74  description_es                   269 non-null    object \n",
      " 75  horarios_lista                   3357 non-null   object \n",
      " 76  phone                            3175 non-null   object \n",
      " 77  international_phone              1524 non-null   object \n",
      " 78  website                          2315 non-null   object \n",
      " 79  email                            961 non-null    object \n",
      " 80  featured_image                   2240 non-null   object \n",
      " 81  menu_link                        296 non-null    object \n",
      " 82  reservation_link                 202 non-null    object \n",
      "dtypes: float64(7), int64(51), object(25)\n",
      "memory usage: 2.1+ MB\n"
     ]
    }
   ],
   "source": [
    "# --- Paso 1: Cargar dataset y librer√≠as ---\n",
    "\n",
    "# Librer√≠as base\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import ast\n",
    "\n",
    "# NLP / Similaridad\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "\n",
    "# Visualizaci√≥n opcional\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "# Cargar dataset final\n",
    "df = pd.read_json(\"restaurantes_enriquecido.json\")\n",
    "\n",
    "print(\"‚úÖ Dataset cargado:\", df.shape)\n",
    "df.head(3)\n",
    "df.info()\n",
    "\n",
    "# --- Normalizar columnas que mezclan listas y strings ---\n",
    "def normalizar_listas(df, cols):\n",
    "    for col in cols:\n",
    "        if col in df.columns:\n",
    "            df[col] = df[col].apply(lambda x:\n",
    "                \", \".join(ast.literal_eval(x)) if isinstance(x, str) and x.startswith(\"[\") and x.endswith(\"]\")\n",
    "                else (\", \".join(x) if isinstance(x, list) else str(x))\n",
    "            )\n",
    "    return df\n",
    "\n",
    "cols_listas = [\n",
    "    \"cuisines_traducidas\", \"platos_detectados\", \"categorias_asignadas\",\n",
    "    \"review_keywords_es\", \"diets_es\", \"meal_types_es\",\n",
    "    \"dining_options_es\", \"top_tags_es\"\n",
    "]\n",
    "\n",
    "df = normalizar_listas(df, cols_listas)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "4jciuuGqRCcs"
   },
   "source": [
    "## Preprocesamiento para b√∫squeda por texto libre (TF-IDF)\n",
    "\n",
    "El objetivo es permitir al usuario buscar restaurantes introduciendo un texto libre (*ej: ‚Äúpulpo gallego barato‚Äù*).  \n",
    "\n",
    "Para ello:  \n",
    "1. Creamos un **campo combinado de texto** con varias columnas descriptivas (`nombre_final`, `description_es`, `review_keywords_es`, `cuisines_traducidas`, etc.).  \n",
    "2. Aplicamos **TF-IDF (Term Frequency - Inverse Document Frequency)** para vectorizar ese texto.  \n",
    "   - Cada restaurante se convierte en un vector num√©rico que representa sus palabras clave.  \n",
    "3. Calculamos similitudes de coseno entre la consulta del usuario y los restaurantes.  \n",
    "   - Cuanto m√°s alto el valor, m√°s relevante es el restaurante respecto a la b√∫squeda.  \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "executionInfo": {
     "elapsed": 106,
     "status": "ok",
     "timestamp": 1763222036347,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "R1ILaMcXRtO7",
    "outputId": "54f68c55-e7e9-48be-d94d-a5cd949ee7a4"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üìë Ejemplo de texto combinado:\n",
      "A Noiesa Casa de Comidas camino, jam√≥n, comida gallega, casco antiguo, bife, Santiago, chef juan carlos, Comida incre√≠ble, ROI, comi√≥ aqu√≠, desierto, Nuestro camarero, Preciosa cena, mariscos, lista de vinos, men√∫, Espa√±a, pollo, arroz, Mel Gibson, estrella michelin, plato, vieiras, berenjena, anoche mediterr√°nea, europea, espa√±ola, saludable Espa√±ola > cocina gallega, Veggie > vegetariano, Espa√±ola > mariscos, Europea, Espa√±ola > men√∫ del d√≠a, Carnes, Espa√±ola, Veggie, Espa√±ola > arroces, Veggi\n"
     ]
    }
   ],
   "source": [
    "# 1. Crear un campo combinado de texto m√°s completo\n",
    "def combine_text(row):\n",
    "    parts = []\n",
    "    for col in [\n",
    "        \"nombre_final\", \"description_es\", \"review_keywords_es\",\n",
    "        \"cuisines_traducidas\", \"categorias_asignadas\", \"diets_es\",\n",
    "        \"top_tags_es\", \"meal_types_es\", \"platos_detectados\"\n",
    "    ]:\n",
    "        val = row.get(col, None)\n",
    "\n",
    "        # Evitar valores nulos, None o \"None\"\n",
    "        if val is None or str(val).lower() in [\"none\", \"nan\", \"null\", \"\"]:\n",
    "            continue\n",
    "\n",
    "        if isinstance(val, list):\n",
    "            parts.extend([str(x).strip() for x in val if x and str(x).lower() not in [\"none\", \"nan\", \"null\"]])\n",
    "        elif isinstance(val, str):\n",
    "            val_clean = val.strip()\n",
    "            if val_clean.lower() not in [\"none\", \"nan\", \"null\", \"\"]:\n",
    "                parts.append(val_clean)\n",
    "\n",
    "    return \" \".join(parts)\n",
    "\n",
    "df[\"texto_combinado\"] = df.apply(combine_text, axis=1)\n",
    "df[\"texto_combinado\"] = df[\"texto_combinado\"].fillna(\"\").astype(str)\n",
    "\n",
    "\n",
    "print(\"üìë Ejemplo de texto combinado:\")\n",
    "print(df[\"texto_combinado\"].iloc[0][:500])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 258
    },
    "executionInfo": {
     "elapsed": 2574,
     "status": "ok",
     "timestamp": 1763222042039,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "bhFZDli2R6GM",
    "outputId": "849fce30-7ccd-4132-b694-ba9a76366054"
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[nltk_data] Downloading package stopwords to /root/nltk_data...\n",
      "[nltk_data]   Unzipping corpora/stopwords.zip.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Matriz TF-IDF creada: (3357, 5448)\n"
     ]
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"buscar_texto(\\\"pulpo barato \\\", top_n=5)\",\n  \"rows\": 5,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"D'luna Avellaneda\",\n          \"Meson do Pulpo\",\n          \"Restaurante Santa Comba\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 4,\n        \"samples\": [\n          \"vigo\",\n          \"santiago\",\n          \"ourense\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rating_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.3563705936241091,\n        \"min\": 3.7,\n        \"max\": 4.6,\n        \"num_unique_values\": 4,\n        \"samples\": [\n          3.7,\n          4.5,\n          4.4\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"price_num\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.5773502691896257,\n        \"min\": 1.0,\n        \"max\": 2.0,\n        \"num_unique_values\": 2,\n        \"samples\": [\n          2.0,\n          1.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"maps_url_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"https://maps.google.com/?cid=2250586477715317020&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\",\n          \"https://maps.google.com/?cid=4194399281606899682&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"similaridad\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.024188631447559644,\n        \"min\": 0.5156260278037869,\n        \"max\": 0.5773268347421321,\n        \"num_unique_values\": 5,\n        \"samples\": [\n          0.5518577718225668,\n          0.5156260278037869\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-89ed1e02-4713-4b57-af39-4300aacee7c9\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>rating_final</th>\n",
       "      <th>price_num</th>\n",
       "      <th>maps_url_final</th>\n",
       "      <th>similaridad</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2901</th>\n",
       "      <td>Saborido</td>\n",
       "      <td>ourense</td>\n",
       "      <td>4.4</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https://maps.google.com/?cid=9652082139609502941</td>\n",
       "      <td>0.577327</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3233</th>\n",
       "      <td>D'luna Avellaneda</td>\n",
       "      <td>vigo</td>\n",
       "      <td>3.7</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https://maps.google.com/?cid=22505864777153170...</td>\n",
       "      <td>0.551858</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2333</th>\n",
       "      <td>Restaurante Santa Comba</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>4.6</td>\n",
       "      <td>1.0</td>\n",
       "      <td>https://maps.google.com/?cid=15041195373028233220</td>\n",
       "      <td>0.529864</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>517</th>\n",
       "      <td>A Casita Do Pulpo</td>\n",
       "      <td>ourense</td>\n",
       "      <td>4.5</td>\n",
       "      <td>2.0</td>\n",
       "      <td>https://maps.google.com/?cid=34586541452771509...</td>\n",
       "      <td>0.529374</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>77</th>\n",
       "      <td>Meson do Pulpo</td>\n",
       "      <td>santiago</td>\n",
       "      <td>4.4</td>\n",
       "      <td>1.0</td>\n",
       "      <td>https://maps.google.com/?cid=41943992816068996...</td>\n",
       "      <td>0.515626</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-89ed1e02-4713-4b57-af39-4300aacee7c9')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-89ed1e02-4713-4b57-af39-4300aacee7c9 button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-89ed1e02-4713-4b57-af39-4300aacee7c9');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-ddf00747-bc97-4094-bf1d-5959041e34ee\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-ddf00747-bc97-4094-bf1d-5959041e34ee')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-ddf00747-bc97-4094-bf1d-5959041e34ee button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                 nombre_final    ciudad  rating_final  price_num  \\\n",
       "2901                 Saborido   ourense           4.4        NaN   \n",
       "3233        D'luna Avellaneda      vigo           3.7        NaN   \n",
       "2333  Restaurante Santa Comba  a coru√±a           4.6        1.0   \n",
       "517         A Casita Do Pulpo   ourense           4.5        2.0   \n",
       "77             Meson do Pulpo  santiago           4.4        1.0   \n",
       "\n",
       "                                         maps_url_final  similaridad  \n",
       "2901   https://maps.google.com/?cid=9652082139609502941     0.577327  \n",
       "3233  https://maps.google.com/?cid=22505864777153170...     0.551858  \n",
       "2333  https://maps.google.com/?cid=15041195373028233220     0.529864  \n",
       "517   https://maps.google.com/?cid=34586541452771509...     0.529374  \n",
       "77    https://maps.google.com/?cid=41943992816068996...     0.515626  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 2. Vectorizaci√≥n TF-IDF\n",
    "import nltk\n",
    "from nltk.corpus import stopwords\n",
    "\n",
    "# Descargar lista de palabras vac√≠as en espa√±ol\n",
    "nltk.download(\"stopwords\")\n",
    "stop_words_es = stopwords.words(\"spanish\")\n",
    "\n",
    "# Crear el vectorizador con stopwords en espa√±ol\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "vectorizer = TfidfVectorizer(stop_words=stop_words_es)\n",
    "\n",
    "# Crear matriz TF-IDF de todos los restaurantes\n",
    "tfidf_matrix = vectorizer.fit_transform(df[\"texto_combinado\"])\n",
    "\n",
    "print(\"‚úÖ Matriz TF-IDF creada:\", tfidf_matrix.shape)\n",
    "\n",
    "\n",
    "# 3. Funci√≥n de b√∫squeda\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "\n",
    "def buscar_texto(query, top_n=5):\n",
    "    # Convertir la consulta del usuario en vector\n",
    "    query_vec = vectorizer.transform([query])\n",
    "\n",
    "    # Calcular similitud de coseno entre la consulta y todos los restaurantes\n",
    "    sim = cosine_similarity(query_vec, tfidf_matrix).flatten()\n",
    "\n",
    "    # Ordenar de mayor a menor similitud\n",
    "    indices = sim.argsort()[::-1][:top_n]\n",
    "\n",
    "    # Recuperar resultados\n",
    "    resultados = df.iloc[indices][[\"nombre_final\", \"ciudad\", \"rating_final\", \"price_num\", \"maps_url_final\"]].copy()\n",
    "    resultados[\"similaridad\"] = sim[indices]\n",
    "\n",
    "    return resultados\n",
    "\n",
    "# Ejemplo de prueba\n",
    "buscar_texto(\"pulpo barato \", top_n=5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "8USxpxT-g1XX"
   },
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "\n",
    "def explicar_resultados_tfidf(query, top_n=5):\n",
    "    \"\"\"\n",
    "    Explica por qu√© aparecen los restaurantes en los resultados TF-IDF:\n",
    "    - Muestra coincidencias literales con la query\n",
    "    - Indica los scores de similitud\n",
    "    - Visualiza las palabras m√°s relevantes del top-1\n",
    "    \"\"\"\n",
    "    # Vectorizar la consulta\n",
    "    query_vec = vectorizer.transform([query])\n",
    "    sim = cosine_similarity(query_vec, tfidf_matrix).flatten()\n",
    "\n",
    "    # Obtener los √≠ndices de los restaurantes m√°s similares\n",
    "    indices = sim.argsort()[::-1][:top_n]\n",
    "    resultados = df.iloc[indices][[\"nombre_final\", \"ciudad\", \"rating_final\"]].copy()\n",
    "    resultados[\"similaridad\"] = sim[indices]\n",
    "\n",
    "    print(f\"\\nüîé **Consulta:** {query}\")\n",
    "    print(\"üìä Resultados m√°s similares por TF-IDF:\\n\")\n",
    "\n",
    "    for i, idx in enumerate(indices):\n",
    "        nombre = df.iloc[idx][\"nombre_final\"]\n",
    "        ciudad = df.iloc[idx][\"ciudad\"]\n",
    "        score = sim[idx]\n",
    "        texto = df.iloc[idx][\"texto_combinado\"].lower()\n",
    "        coincidencias = [w for w in query.lower().split() if w in texto]\n",
    "        print(f\"{i+1}. {nombre} ({ciudad}) ‚Üí similitud: {score:.4f}\")\n",
    "        if coincidencias:\n",
    "            print(f\"   üí¨ Coincidencias literales: {', '.join(coincidencias)}\")\n",
    "        else:\n",
    "            print(\"   ‚öôÔ∏è Coincidencia contextual (no literal)\")\n",
    "        print()\n",
    "\n",
    "    # --- Visualizaci√≥n de palabras m√°s relevantes del top-1 ---\n",
    "    idx_top = indices[0]\n",
    "    feature_names = np.array(vectorizer.get_feature_names_out())\n",
    "    tfidf_vector = tfidf_matrix[idx_top].toarray().flatten()\n",
    "    top_indices = tfidf_vector.argsort()[::-1][:10]\n",
    "    words = feature_names[top_indices]\n",
    "    scores = tfidf_vector[top_indices]\n",
    "\n",
    "    plt.figure(figsize=(7,4))\n",
    "    plt.barh(words[::-1], scores[::-1])\n",
    "    plt.title(f\"üî† Palabras con mayor peso TF-IDF en '{df.iloc[idx_top]['nombre_final']}'\")\n",
    "    plt.xlabel(\"Peso TF-IDF\")\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "\n",
    "    return resultados"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 995
    },
    "executionInfo": {
     "elapsed": 379,
     "status": "ok",
     "timestamp": 1763222045404,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "3zmbHG5Gg28T",
    "outputId": "c09c38b8-cb77-4a0c-e4d7-dbf687a07524"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "üîé **Consulta:** pulpo barato\n",
      "üìä Resultados m√°s similares por TF-IDF:\n",
      "\n",
      "1. Saborido (ourense) ‚Üí similitud: 0.5773\n",
      "   üí¨ Coincidencias literales: pulpo\n",
      "\n",
      "2. D'luna Avellaneda (vigo) ‚Üí similitud: 0.5519\n",
      "   üí¨ Coincidencias literales: pulpo\n",
      "\n",
      "3. Restaurante Santa Comba (a coru√±a) ‚Üí similitud: 0.5299\n",
      "   üí¨ Coincidencias literales: pulpo\n",
      "\n",
      "4. A Casita Do Pulpo (ourense) ‚Üí similitud: 0.5294\n",
      "   üí¨ Coincidencias literales: pulpo\n",
      "\n",
      "5. Meson do Pulpo (santiago) ‚Üí similitud: 0.5156\n",
      "   üí¨ Coincidencias literales: pulpo, barato\n",
      "\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipython-input-3977042823.py:49: UserWarning: Glyph 128288 (\\N{INPUT SYMBOL FOR LATIN CAPITAL LETTERS}) missing from font(s) DejaVu Sans.\n",
      "  plt.tight_layout()\n",
      "/usr/local/lib/python3.12/dist-packages/IPython/core/pylabtools.py:151: UserWarning: Glyph 128288 (\\N{INPUT SYMBOL FOR LATIN CAPITAL LETTERS}) missing from font(s) DejaVu Sans.\n",
      "  fig.canvas.print_figure(bytes_io, **kw)\n"
     ]
    },
    {
     "data": {
      "image/png": "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GwDA2bNns23D1NQUgwcPxuDBgzFw4EB069YNz549g4WFRXEfJhEREREVgzIVZB0cHBAREYH4+HgoFAo4OTlh+/btCA0NhaOjI3bs2IFLly7B0dFRY720tDSMGTMGX375JeLj4zF37lxMmDABOjo6MDc3h6WlJTZs2AAbGxskJCTgiy++0Fj/q6++go2NDRo2bAgdHR3s3bsX1tbWMDMzK8WjJyIiIqKCKFNTC6ZNmwZdXV3Url0bVlZWcHd3R//+/TF48GA0b94cT58+1RidzdKpUyc4OTmhbdu2GDx4MHr37o158+YBAHR0dBASEoIrV66gbt26+Pzzz7Fs2TKN9U1MTLB06VI0adIETZs2RXx8PI4dOwYdnTLVPURERET0DpkQQmi7iKLw8fHBixcvcOjQIa3WkZycDKVSCbvJe6AjN8p7BSIqdvFBPbVdAhERFVFWpkpKSsrzGiQOORIRERGRJDHIEhEREZEklamLvQpj69at2i6BiIiIiLSAI7JEREREJEmSH5Eta24GuPPhCERERESlgCOyRERERCRJDLJEREREJEkMskREREQkSQyyRERERCRJDLJEREREJEm8a0Exqzs3lI+opXKNj4ElIqKygiOyRERERCRJDLJEREREJEkMskREREQkSQyyRERERCRJDLJEREREJEkMskREREQkSQyyRERERCRJ5TrIpqWlabsEIiIiIiohZS7IZmZmYunSpahZsybkcjmqVauGRYsWAQBmzpyJWrVqwcjICNWrV4e/vz/evHmjXnfevHlwdXXFpk2b4OjoCAMDAwCATCbDpk2b0K9fPxgZGcHJyQmHDx/W2O/NmzfRvXt3KBQKVK5cGSNGjMCTJ09K78CJiIiIqEDKXJCdNWsWgoKC4O/vj6ioKOzevRuVK1cGAJiYmGDr1q2IiorC6tWrsXHjRqxcuVJj/du3b2P//v04cOAAIiMj1csDAgLg6emJ3377DT169ICXlxeePXsGAHjx4gU6duyIhg0b4vLly/jpp5/w8OFDeHp65lqnSqVCcnKyxouIiIiISo9MCCG0XUSWlJQUWFlZYe3atRg7dmye7ZcvX46QkBBcvnwZwNsR2cWLF+PevXuwsrJSt5PJZPjyyy+xYMECAMDLly+hUChw/PhxdOvWDQsXLsSvv/6K0NBQ9Tp//fUX7OzsEBMTg1q1amXb97x5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rFmDP//8E4cPH8aCBQu0XS4RERERFVK5G5EdOXIkXr9+jWbNmkFXVxeTJk2Cr68vZDIZtm7div/85z/4+uuv0ahRIyxfvhy9e/fWdslEREREVAgykXWTVSqS5ORkKJVK2E3eAx25kbbL+SDFB/XUdglERERURFmZKikpCaampu9tW+6mFhARERHRh4FBloiIiIgkiUGWiIiIiCSJQZaIiIiIJKnc3bVA224GuOc5MZmIiIiIio4jskREREQkSQyyRERERCRJDLJEREREJEkMskREREQkSQyyRERERCRJvGtBMas7N5SPqAUfF0tEREQljyOyRERERCRJDLJEREREJEkMskREREQkSQyyRERERCRJDLJEREREJEllLsi2b98ekydP1nYZRERERFTGlbkgS0RERESUH+U+yAohkJ6eru0yiIiIiKiYlckgm56ejgkTJkCpVKJixYrw9/eHEAIAsGPHDjRp0gQmJiawtrbGsGHD8OjRI/W6YWFhkMlkOH78OBo3bgy5XI6zZ88iMzMTgYGBcHR0hKGhIRo0aIB9+/ap13v+/Dm8vLxgZWUFQ0NDODk5ITg4uNSPnYiIiIjyp0w+2Wvbtm0YM2YMLl68iMuXL8PX1xfVqlXDuHHj8ObNGyxYsADOzs549OgRpkyZAh8fHxw7dkxjG1988QWWL1+O6tWrw9zcHIGBgdi5cye+++47ODk54ZdffsHw4cNhZWWFdu3awd/fH1FRUTh+/DgqVqyI27dv4/Xr17nWqFKpoFKp1O+Tk5NLrD+IiIiIKDuZyBrqLCPat2+PR48e4datW5DJZADehtLDhw8jKioqW/vLly+jadOmSElJgUKhQFhYGDp06IBDhw6hT58+AN6GTgsLC5w6dQpubm7qdceOHYtXr15h9+7d6N27NypWrIgtW7bkq8558+YhICAg23K7yXv4iFrwEbVERERUOMnJyVAqlUhKSoKpqel725bJqQUtWrRQh1gAcHNzQ2xsLDIyMnDlyhV4eHigWrVqMDExQbt27QAACQkJGtto0qSJ+s+3b9/Gq1ev0KVLFygUCvVr+/btiIuLAwB88sknCAkJgaurK2bMmIFz5869t8ZZs2YhKSlJ/UpMTCyuwyciIiKifCiTUwty888//8Dd3R3u7u7YtWsXrKyskJCQAHd3d6SlpWm0NTY2Vv85NTUVAHD06FFUqVJFo51cLgcAdO/eHXfv3sWxY8dw8uRJdOrUCX5+fli+fHmOtcjlcvW6RERERFT6ymSQjYiI0Hh/4cIFODk54ffff8fTp08RFBQEOzs7AG+nFuSldu3akMvlSEhIUI/g5sTKygre3t7w9vZGmzZtMH369FyDLBERERFpV5kMsgkJCZgyZQo+/vhjXL16FWvWrMGKFStQrVo16OvrY82aNRg/fjxu3ryJBQsW5Lk9ExMTTJs2DZ9//jkyMzPRunVrJCUlITw8HKampvD29sacOXPQuHFj1KlTByqVCkeOHIGLi0spHC0RERERFUaZDLIjR47E69ev0axZM+jq6mLSpEnw9fWFTCbD1q1b8Z///Adff/01GjVqhOXLl6N37955bnPBggWwsrJCYGAg/vzzT5iZmaFRo0b4z3/+AwDQ19fHrFmzEB8fD0NDQ7Rp0wYhISElfahEREREVEhl7q4FUpV1hR3vWvAW71pAREREhSH5uxYQEREREeWFQZaIiIiIJIlBloiIiIgkiUGWiIiIiCSJQZaIiIiIJKlM3n5Lym4GuOd5hR0RERERFR1HZImIiIhIkhhkiYiIiEiSGGSJiIiISJIYZImIiIhIkhhkiYiIiEiSGGSJiIiISJIYZImIiIhIkhhkiYiIiEiSGGSJiIiISJIYZImIiIhIkhhkAbRv3x6TJ0/WdhlEREREVAAMskREREQkSQyyeUhLS9N2CURERESUgw8uyL58+RIjR46EQqGAjY0NVqxYofG5g4MDFixYgJEjR8LU1BS+vr5aqpSIiIiI3ueDC7LTp0/Hzz//jB9//BEnTpxAWFgYrl69qtFm+fLlaNCgAa5duwZ/f38tVUpERERE76On7QJKU2pqKjZv3oydO3eiU6dOAIBt27ahatWqGu06duyIqVOnvndbKpUKKpVK/T45Obn4CyYiIiKiXH1QI7JxcXFIS0tD8+bN1cssLCzg7Oys0a5JkyZ5biswMBBKpVL9srOzK/Z6iYiIiCh3H1SQzS9jY+M828yaNQtJSUnqV2JiYilURkRERERZPqggW6NGDVSoUAERERHqZc+fP8cff/xR4G3J5XKYmppqvIiIiIio9HxQc2QVCgXGjBmD6dOnw9LSEpUqVcLs2bOho/NB5XkiIiKicuGDCrIAsGzZMqSmpsLDwwMmJiaYOnUqkpKStF0WERERERWQTAghtF1EeZCcnAylUomkpCROMyAiIiIqpIJkKn6nTkRERESSxCBLRERERJLEIEtEREREksQgS0RERESSxCBLRERERJLEIEtEREREksQgS0RERESSxCBLRERERJLEIEtEREREksQgS0RERESSxCBLRERERJLEIEtEREREksQgS0RERESSxCBLRERERJLEIEtEREREksQgS0RERESSxCBLRERERJLEIEtEREREkqSn7QLKCyEEACA5OVnLlRARERFJV1aWyspW78MgW0yePn0KALCzs9NyJURERETSl5KSAqVS+d42DLLFxMLCAgCQkJCQZ6dTdsnJybCzs0NiYiJMTU21XY7ksP+Khv1XdOzDomH/FQ37r2jKWv8JIZCSkgJbW9s82zLIFhMdnbfTjZVKZZk4CaTK1NSU/VcE7L+iYf8VHfuwaNh/RcP+K5qy1H/5HRTkxV5EREREJEkMskREREQkSQyyxUQul2Pu3LmQy+XaLkWS2H9Fw/4rGvZf0bEPi4b9VzTsv6KRcv/JRH7ubUBEREREVMZwRJaIiIiIJIlBloiIiIgkiUGWiIiIiCSJQbYAvvnmGzg4OMDAwADNmzfHxYsX39t+7969+Oijj2BgYIB69erh2LFjpVRp2VSQ/rt16xYGDBgABwcHyGQyrFq1qvQKLaMK0n8bN25EmzZtYG5uDnNzc3Tu3DnP87W8K0j/HThwAE2aNIGZmRmMjY3h6uqKHTt2lGK1ZVNBfwdmCQkJgUwmQ9++fUu2wDKuIP23detWyGQyjZeBgUEpVlv2FPT8e/HiBfz8/GBjYwO5XI5atWp90P8OF6T/2rdvn+38k8lk6NmzZylWnE+C8iUkJETo6+uLLVu2iFu3bolx48YJMzMz8fDhwxzbh4eHC11dXbF06VIRFRUlvvzyS1GhQgVx48aNUq68bCho/128eFFMmzZNfP/998La2lqsXLmydAsuYwraf8OGDRPffPONuHbtmoiOjhY+Pj5CqVSKv/76q5QrLxsK2n9nzpwRBw4cEFFRUeL27dti1apVQldXV/z000+lXHnZUdA+zHLnzh1RpUoV0aZNG9GnT5/SKbYMKmj/BQcHC1NTU3H//n3168GDB6VcddlR0P5TqVSiSZMmokePHuLs2bPizp07IiwsTERGRpZy5WVDQfvv6dOnGufezZs3ha6urggODi7dwvOB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\n",
      "text/plain": [
       "<Figure size 700x400 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"resultados_tfidf\",\n  \"rows\": 5,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"D'luna Avellaneda\",\n          \"Meson do Pulpo\",\n          \"Restaurante Santa Comba\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 4,\n        \"samples\": [\n          \"vigo\",\n          \"santiago\",\n          \"ourense\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rating_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.3563705936241091,\n        \"min\": 3.7,\n        \"max\": 4.6,\n        \"num_unique_values\": 4,\n        \"samples\": [\n          3.7,\n          4.5,\n          4.4\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"similaridad\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.024188631447559644,\n        \"min\": 0.5156260278037869,\n        \"max\": 0.5773268347421321,\n        \"num_unique_values\": 5,\n        \"samples\": [\n          0.5518577718225668,\n          0.5156260278037869,\n          0.529864250198015\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe",
       "variable_name": "resultados_tfidf"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-20b6f637-aa44-4201-8f14-6b39411069b0\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>rating_final</th>\n",
       "      <th>similaridad</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2901</th>\n",
       "      <td>Saborido</td>\n",
       "      <td>ourense</td>\n",
       "      <td>4.4</td>\n",
       "      <td>0.577327</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3233</th>\n",
       "      <td>D'luna Avellaneda</td>\n",
       "      <td>vigo</td>\n",
       "      <td>3.7</td>\n",
       "      <td>0.551858</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2333</th>\n",
       "      <td>Restaurante Santa Comba</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>4.6</td>\n",
       "      <td>0.529864</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>517</th>\n",
       "      <td>A Casita Do Pulpo</td>\n",
       "      <td>ourense</td>\n",
       "      <td>4.5</td>\n",
       "      <td>0.529374</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>77</th>\n",
       "      <td>Meson do Pulpo</td>\n",
       "      <td>santiago</td>\n",
       "      <td>4.4</td>\n",
       "      <td>0.515626</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-20b6f637-aa44-4201-8f14-6b39411069b0')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-20b6f637-aa44-4201-8f14-6b39411069b0 button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-20b6f637-aa44-4201-8f14-6b39411069b0');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-e05a7314-cc8d-495b-b0da-96286182c5ec\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-e05a7314-cc8d-495b-b0da-96286182c5ec')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-e05a7314-cc8d-495b-b0da-96286182c5ec button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "  <div id=\"id_00480a14-c85b-4ab6-84ca-53bf5cff19bc\">\n",
       "    <style>\n",
       "      .colab-df-generate {\n",
       "        background-color: #E8F0FE;\n",
       "        border: none;\n",
       "        border-radius: 50%;\n",
       "        cursor: pointer;\n",
       "        display: none;\n",
       "        fill: #1967D2;\n",
       "        height: 32px;\n",
       "        padding: 0 0 0 0;\n",
       "        width: 32px;\n",
       "      }\n",
       "\n",
       "      .colab-df-generate:hover {\n",
       "        background-color: #E2EBFA;\n",
       "        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "        fill: #174EA6;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate {\n",
       "        background-color: #3B4455;\n",
       "        fill: #D2E3FC;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate:hover {\n",
       "        background-color: #434B5C;\n",
       "        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "        fill: #FFFFFF;\n",
       "      }\n",
       "    </style>\n",
       "    <button class=\"colab-df-generate\" onclick=\"generateWithVariable('resultados_tfidf')\"\n",
       "            title=\"Generate code using this dataframe.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "       width=\"24px\">\n",
       "    <path d=\"M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "    <script>\n",
       "      (() => {\n",
       "      const buttonEl =\n",
       "        document.querySelector('#id_00480a14-c85b-4ab6-84ca-53bf5cff19bc button.colab-df-generate');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      buttonEl.onclick = () => {\n",
       "        google.colab.notebook.generateWithVariable('resultados_tfidf');\n",
       "      }\n",
       "      })();\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                 nombre_final    ciudad  rating_final  similaridad\n",
       "2901                 Saborido   ourense           4.4     0.577327\n",
       "3233        D'luna Avellaneda      vigo           3.7     0.551858\n",
       "2333  Restaurante Santa Comba  a coru√±a           4.6     0.529864\n",
       "517         A Casita Do Pulpo   ourense           4.5     0.529374\n",
       "77             Meson do Pulpo  santiago           4.4     0.515626"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Ejemplo: b√∫squeda por texto libre\n",
    "resultados_tfidf = explicar_resultados_tfidf(\"pulpo barato\", top_n=5)\n",
    "display(resultados_tfidf)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "SFif3skUgPeU"
   },
   "source": [
    "## B√∫squeda h√≠brida: TF-IDF + Embeddings sem√°nticos\n",
    "\n",
    "En este paso integramos dos enfoques de b√∫squeda:\n",
    "\n",
    "1. **TF-IDF**  \n",
    "   - Basado en frecuencia de palabras.  \n",
    "   - Muy r√°pido y explicable.  \n",
    "\n",
    "2. **SentenceTransformer (paraphrase-multilingual-MiniLM-L12-v2)**  \n",
    "   - Convierte frases en embeddings vectoriales.  \n",
    "   - Captura sin√≥nimos y similitud sem√°ntica.  \n",
    "\n",
    "3. **H√≠brido**  \n",
    "   - Calculamos similitud por ambos m√©todos.  \n",
    "   - Combinamos los scores con un peso configurable (ej. 0.5 cada uno).  \n",
    "   - Devolvemos los resultados ordenados por score h√≠brido.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "vp6YkLZ1gRp-"
   },
   "outputs": [],
   "source": [
    "!pip install -q sentence-transformers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 473,
     "referenced_widgets": [
      "6f7e3d702a80439a83328ad4368b2807",
      "c03cf1099bb4418095c9aa77e6dd74b6",
      "341b1422c58643fa9e8b7bbe19003647",
      "8d90e73ed9d74ae9ada8636d092a5f2d",
      "c2460ba2e6d4483fa3c512637540d7e3",
      "d8436bb698dc4a0ab2057349ef149856",
      "abfb666b97734412990dd2693372d1d1",
      "e338c54445ba44f6af1970916e5544e8",
      "1bfa7cb523644319adb0ccd1b4bd3a5c",
      "506e91fd3737446b8da2d6a595323a11",
      "4c337903c29a48be9ce22694761de768",
      "efbf4d70005e4ba48c7708d1e5732ca1",
      "0b509660800440b0904047803e545c77",
      "1a344480b5484b2fa80de7be739a9ba8",
      "6172c14fa44542a1b7e7f6985941d14d",
      "bd37e69dbfac4e1ca1e918e1996e31d4",
      "e1dd4ff207ee418fa100a87c8473d2a3",
      "765b6042bec44808a277d4113b3bbadb",
      "9d0b207531b0439791a129e7b21879a5",
      "f08130c708654328ab41b41aba9766a3",
      "f6c78b36be2748bfa1fabe3ed51369fa",
      "1302c99641044a49aabe2fa1fe8659ae",
      "cd751e73553b47568899901f893b0a6d",
      "7312d82195914534b433b038d9a108aa",
      "31371708d8d1444eb6b2d98e9c2c35bc",
      "2cb70314a4434a73a85ef5db599c86b3",
      "1838e2300f674416a193fb807265774b",
      "27990583f507401caee0a7059fed2b50",
      "4a03f06e88fb4740b30dd1d1d00e65bd",
      "9ed82d9b599c42ce8768870cdcc83ca3",
      "da34cf48683647ac8f6467a4cafa8270",
      "8c0e9beaa80c43bcace82ade13d3df4c",
      "36675f71dd114f599b9df5c3e019a235",
      "81c8f3713f2049ffb01352b35a0a9b23",
      "16d0c82beb124b4f9b90e2c9e59f3f10",
      "9324ba6978b74fd6a6c3e6593e0e2960",
      "3737b32c65204cc7bd4d82f0a34c8c18",
      "6c8dcd5b34f348c6b47bf1565eed4058",
      "40eb0f5965964e3e86b45bcc15559b9c",
      "d0dc54485709488b854460b05e7578ea",
      "495eaac316e948e8bf804448d974c9f8",
      "4c02a3f89541428d9c8ffcb62bf599fd",
      "b2e5323905394dc0b33160c17f2a8814",
      "58aa1f47320c4fd39e21cdbcca0a47c7",
      "fdd9d5bdab7042f09153c02fbd21f98e",
      "a421add6cdba4ddf992e6a86d75741ed",
      "8334c0a5ec6d43f790f763531a1f230a",
      "4a02a23e7ccf4ff19bd200e3baaab8e1",
      "6154e18a070d4e72906f6cb81e8eb860",
      "0e41d6311ab54501b72d516ba3e2e745",
      "c384f13d2bf648968053ebbf951f47e1",
      "c84402c909d244b8b734f9b50332e5a0",
      "8fc3089c5782437fa9452b4cdcda091c",
      "0ad0f32942ff48b1a08b498737aea41b",
      "47d4af0b6445426fb62fed5ab1a6f508",
      "eaccdfca00c14af8a3c0a2137d090894",
      "1a49df6d6338488e938b40c5ecf37d3b",
      "b18be5d740594702ba54e9b5e526be51",
      "0dddae36b4d24dfdbc48d57c86408181",
      "b35fba11a094420cbd09977bf514d5e6",
      "fa4d77ecd5c146f4ace92d466f289f6b",
      "f67751de466e49b1bddb59c595c7012c",
      "7996967bd8bb49ad84af3aa905906b3b",
      "4963f1120f5c4eeeb5d67e3fcf0902f7",
      "260574fd39794ea3a5c323edf2cbe10f",
      "b2f69d52a13443d596e3e3e26990f54d",
      "e5d16dce22ca421388296ab95917883a",
      "7cc948ec7b11417fbe262ea404ee7646",
      "fbf0e19095424539a3886db70ca0d0c7",
      "c1e43b49fcd54de09fa165c602964043",
      "a750b94af746414db01f504dfbba3e1e",
      "2b1a9cad92914a80b984e0533e0fa22d",
      "f45b65796fef4c72a775ca85cd36d0f8",
      "db05753271944d85b46e937a7deb3878",
      "342739a59fe84e7bab057ff2aee6f206",
      "a7bd8110e2e645968687e356e9afe4dd",
      "1726a01a2e93400cb08b87652d9cf564",
      "64b223141c004cdca23c1bd9144a4de5",
      "0cc6beb2d58d490ea84555b454aab73b",
      "05e742c985474ab083e6e28a5c6ab362",
      "355ac9cf37a5463ebdd02fc6d6683cd5",
      "07835e0be8444206b20f89cf490ad25d",
      "a3c90ecf0e4d4750b5e525291bff9182",
      "b6bf13d877f549b1afa1e8ce8b4b9cf4",
      "1d097282973347739e91d87a986b1bc6",
      "f004860f4ec948b696176dc65fedf45b",
      "4434771727b846e5a76365ab27d7bbd2",
      "1b57e43cae024bc8b04a665f84f5e041",
      "4e8c53238125470ba2e256fe232bb6d7",
      "588927070ba14bd092f6049e3b1d30f5",
      "c7b0f0f9a6bb4ac8807ad225e8659b1b",
      "a3485564116144d5b67496e77d65c573",
      "8b17a744f5b34c0ab5f1917494aa3df8",
      "70e846b7c48e48f1ac0e5b09559a62b6",
      "92a1741d9ad7478995b79c9723cff40d",
      "17732230af0c4cad9f1de12653d205f9",
      "e27c232009a442f7a7f779518ec3d7e6",
      "28a3160292454fefb1aa51c21751340c",
      "bfce8b512465450288c858a1979b9f7b",
      "c777f4aeef2947b0859ddcb3dc1e0bbf",
      "4b10cbcb36b94d32bce52ae720a40276",
      "18ed9d2e9b7c4bfc897689ebf0b0e405",
      "72ffd9f8b20c47f1a860f3be20db065a",
      "7e4e1032000840d9abd7ba1750a3fbc7",
      "17e2ea08268d4194b5b11c3597146ca8",
      "f6d5e859e2b44028b7d295f36e3ef7a1",
      "e0af14f8e9334eb8bb6cc57ba8a4269a",
      "91394785ba6744b99ce9ddae591b4a70",
      "06ed5f67b6154a17919bfb44c5894e5b",
      "34c2919f3716468e9e0f14eb33e6cfbb",
      "d90c47bd6a69459abfb2449ab410f7a5",
      "7504b86334194867807f5855b7352e57",
      "4e6ecd8888954ae9b5335e0095aa68d0",
      "9383cf97082343c998710134896aeffd",
      "2293483fca9b4f1785d04c52ac8a625b",
      "6a189df7252d432caea3e10b389a6b10",
      "7eb16664b24b4fbdadff4836c861dd1e",
      "a94adffe26674be0bedf3c5fa31dc835",
      "ac28480a14144a7fb276e9ca9e8527f1",
      "258680654e1c4fb6ac299e9b530f1270",
      "67af2240729748618b840169635a6384"
     ]
    },
    "executionInfo": {
     "elapsed": 186294,
     "status": "ok",
     "timestamp": 1763222241279,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "-b_AXK1JgbJI",
    "outputId": "c1e74dee-ec54-4532-f3e0-3f3864677980"
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.12/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: \n",
      "The secret `HF_TOKEN` does not exist in your Colab secrets.\n",
      "To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.\n",
      "You will be able to reuse this secret in all of your notebooks.\n",
      "Please note that authentication is recommended but still optional to access public models or datasets.\n",
      "  warnings.warn(\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "6f7e3d702a80439a83328ad4368b2807",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "modules.json:   0%|          | 0.00/229 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "efbf4d70005e4ba48c7708d1e5732ca1",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config_sentence_transformers.json:   0%|          | 0.00/122 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "cd751e73553b47568899901f893b0a6d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "README.md: 0.00B [00:00, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "81c8f3713f2049ffb01352b35a0a9b23",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "sentence_bert_config.json:   0%|          | 0.00/53.0 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "fdd9d5bdab7042f09153c02fbd21f98e",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/645 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "eaccdfca00c14af8a3c0a2137d090894",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "model.safetensors:   0%|          | 0.00/471M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "e5d16dce22ca421388296ab95917883a",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer_config.json:   0%|          | 0.00/480 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "64b223141c004cdca23c1bd9144a4de5",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer.json:   0%|          | 0.00/9.08M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "4e8c53238125470ba2e256fe232bb6d7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "special_tokens_map.json:   0%|          | 0.00/239 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c777f4aeef2947b0859ddcb3dc1e0bbf",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/190 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "d90c47bd6a69459abfb2449ab410f7a5",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Batches:   0%|          | 0/105 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "from sentence_transformers import SentenceTransformer\n",
    "import numpy as np\n",
    "\n",
    "# --- Cargar modelo SBERT (puede tardar un poco la primera vez) ---\n",
    "model = SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')\n",
    "\n",
    "# --- Precalcular embeddings de todos los restaurantes ---\n",
    "embeddings = model.encode(df[\"texto_combinado\"].tolist(), show_progress_bar=True)\n",
    "embeddings = np.array(embeddings)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "gculiwKShhVE"
   },
   "outputs": [],
   "source": [
    "def buscar_hibrido(query, top_n=10, alpha=0.5, ciudad=None, df_base=None):\n",
    "    \"\"\"\n",
    "    B√∫squeda h√≠brida TF-IDF + embeddings sem√°nticos (E5 o SBERT).\n",
    "    Si se pasa df_base, solo busca dentro de ese subconjunto filtrado.\n",
    "    \"\"\"\n",
    "\n",
    "    # --- Seleccionar base de datos ---\n",
    "    if df_base is not None:\n",
    "        # Mantener los √≠ndices del df global para alinear los scores\n",
    "        df_local = df_base.copy()\n",
    "        idx_local = df.index.isin(df_base.index)\n",
    "    else:\n",
    "        df_local = df.copy()\n",
    "        idx_local = np.ones(len(df), dtype=bool)\n",
    "\n",
    "    # --- TF-IDF ---\n",
    "    query_vec_tfidf = vectorizer.transform([query])\n",
    "    sim_tfidf_global = cosine_similarity(query_vec_tfidf, tfidf_matrix).flatten()\n",
    "\n",
    "    # --- Embeddings sem√°nticos ---\n",
    "    query_vec_sbert = model.encode([query])\n",
    "    sim_sbert_global = cosine_similarity(query_vec_sbert, embeddings).flatten()\n",
    "\n",
    "    # --- Combinar scores globales ---\n",
    "    sim_total_global = alpha * sim_tfidf_global + (1 - alpha) * sim_sbert_global\n",
    "\n",
    "    # --- Filtrar solo los √≠ndices locales ---\n",
    "    sim_tfidf = sim_tfidf_global[idx_local]\n",
    "    sim_sbert = sim_sbert_global[idx_local]\n",
    "    sim_total = sim_total_global[idx_local]\n",
    "\n",
    "    # --- Asignar scores al df_local ---\n",
    "    df_local = df_local.copy()\n",
    "    df_local[\"score_tfidf\"] = sim_tfidf\n",
    "    df_local[\"score_sbert\"] = sim_sbert\n",
    "    df_local[\"score_hibrido\"] = sim_total\n",
    "\n",
    "    # --- Filtro adicional por ciudad si aplica ---\n",
    "    if ciudad:\n",
    "        df_local = df_local[df_local[\"ciudad\"].str.lower() == ciudad.lower()]\n",
    "\n",
    "    # --- Orden final ---\n",
    "    df_local = df_local.sort_values(\"score_hibrido\", ascending=False)\n",
    "\n",
    "    return df_local[[\n",
    "        \"nombre_final\", \"ciudad\",\n",
    "        \"score_hibrido\", \"score_tfidf\", \"score_sbert\",\"reviews_final\",\n",
    "         \"latitude\", \"longitude\", \"horarios_norm\"\n",
    "    ]].head(top_n)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 380
    },
    "executionInfo": {
     "elapsed": 113,
     "status": "ok",
     "timestamp": 1763222241445,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "1xzy0A8uCTWz",
    "outputId": "8f940fbf-5aa7-47f7-8619-473ffb552bbf"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üîé Buscando 'cachopo y sidra' en todo el dataset con modelo MiniLM:\n"
     ]
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"resultados\",\n  \"rows\": 10,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"A Mi\\u00f1a Bodega\",\n          \"El Gale\\u00f3n\",\n          \"Meson Sidreria A Balea\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"lugo\",\n          \"ourense\",\n          \"pontevedra\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_hibrido\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.08403185688617458,\n        \"min\": 0.24632538855075836,\n        \"max\": 0.4963575701592078,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.25428279506921386,\n          0.4549894391238657,\n          0.3597649266279782\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_tfidf\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.14278412588326578,\n        \"min\": 0.0,\n        \"max\": 0.47157300598769764,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.10619155516623864,\n          0.37980720152304226,\n          0.25543220990086907\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_sbert\",\n      \"properties\": {\n        \"dtype\": \"float32\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.5293093919754028,\n          0.5946136116981506,\n          0.5535256862640381\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"reviews_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 819,\n        \"min\": 99,\n        \"max\": 2344,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          568,\n          2075,\n          698\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"latitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.5170177520978426,\n        \"min\": 42.193,\n        \"max\": 43.37097,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          42.342346,\n          43.0374003,\n          43.352264\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"longitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.4016863456855583,\n        \"min\": -8.76898,\n        \"max\": -7.5697735,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          -7.8560300000000005,\n          -7.5697735,\n          -8.41269\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"horarios_norm\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"['lunes: 12:00\\u201315:30, 17:30\\u201300:00', 'martes: 12:00\\u201315:30, 17:30\\u201300:00', 'mi\\u00e9rcoles: 12:00\\u201315:30, 17:30\\u201300:00', 'jueves: 12:00\\u201315:30, 17:30\\u201300:00', 'viernes: 12:00\\u201315:30, 17:30\\u201300:00', 's\\u00e1bado: 12:00\\u201315:30, 17:30\\u201300:00', 'domingo: Cerrado']\",\n          \"['lunes: 09:30\\u201323:00', 'martes: 09:30\\u201323:00', 'mi\\u00e9rcoles: 09:30\\u201323:00', 'jueves: 09:30\\u201323:00', 'viernes: 09:30\\u201300:00', 's\\u00e1bado: 09:30\\u201300:00', 'domingo: 13:00\\u201323:00']\",\n          \"['lunes: 11:00\\u201323:00', 'martes: Cerrado', 'mi\\u00e9rcoles: 11:00\\u201323:00', 'jueves: 11:00\\u201323:00', 'viernes: 11:00\\u201323:00', 's\\u00e1bado: 11:00\\u201323:00', 'domingo: 11:00\\u201318:00']\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe",
       "variable_name": "resultados"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-d13a2c34-b164-45e6-a280-bc16d580faf0\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>score_hibrido</th>\n",
       "      <th>score_tfidf</th>\n",
       "      <th>score_sbert</th>\n",
       "      <th>reviews_final</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>horarios_norm</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2193</th>\n",
       "      <td>O Fillo Do Medio</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.496358</td>\n",
       "      <td>0.471573</td>\n",
       "      <td>0.542386</td>\n",
       "      <td>290</td>\n",
       "      <td>43.362675</td>\n",
       "      <td>-8.409456</td>\n",
       "      <td>['lunes: Cerrado', 'martes: Cerrado', 'mi√©rcol...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1831</th>\n",
       "      <td>El Gale√≥n</td>\n",
       "      <td>lugo</td>\n",
       "      <td>0.454989</td>\n",
       "      <td>0.379807</td>\n",
       "      <td>0.594614</td>\n",
       "      <td>2075</td>\n",
       "      <td>43.037400</td>\n",
       "      <td>-7.569774</td>\n",
       "      <td>['lunes: 09:30‚Äì23:00', 'martes: 09:30‚Äì23:00', ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2633</th>\n",
       "      <td>Lua Chea Pontevedra</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>0.454043</td>\n",
       "      <td>0.404690</td>\n",
       "      <td>0.545698</td>\n",
       "      <td>177</td>\n",
       "      <td>42.432530</td>\n",
       "      <td>-8.644135</td>\n",
       "      <td>['lunes: 12:00‚Äì16:00, 20:30‚Äì23:30', 'martes: 1...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3180</th>\n",
       "      <td>Cerveceria Sidreria Rosalia</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.404782</td>\n",
       "      <td>0.332527</td>\n",
       "      <td>0.538971</td>\n",
       "      <td>99</td>\n",
       "      <td>43.370970</td>\n",
       "      <td>-8.395139</td>\n",
       "      <td>['lunes: 12:00‚Äì24:00', 'martes: 12:00‚Äì24:00', ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1692</th>\n",
       "      <td>Sidreria Carmi√±a</td>\n",
       "      <td>vigo</td>\n",
       "      <td>0.395061</td>\n",
       "      <td>0.352660</td>\n",
       "      <td>0.473805</td>\n",
       "      <td>484</td>\n",
       "      <td>42.193000</td>\n",
       "      <td>-8.768980</td>\n",
       "      <td>['lunes: Cerrado', 'martes: 19:00‚Äì24:00', 'mi√©...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1118</th>\n",
       "      <td>Meson Sidreria A Balea</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.359765</td>\n",
       "      <td>0.255432</td>\n",
       "      <td>0.553526</td>\n",
       "      <td>698</td>\n",
       "      <td>43.352264</td>\n",
       "      <td>-8.412690</td>\n",
       "      <td>['lunes: 11:00‚Äì23:00', 'martes: Cerrado', 'mi√©...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>253</th>\n",
       "      <td>Sidrer√≠a Monta√±es</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>0.348336</td>\n",
       "      <td>0.311986</td>\n",
       "      <td>0.415844</td>\n",
       "      <td>2344</td>\n",
       "      <td>42.430710</td>\n",
       "      <td>-8.643256</td>\n",
       "      <td>['lunes: Cerrado', 'martes: 13:15‚Äì16:30, 19:30...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2361</th>\n",
       "      <td>Acendra Restauraci√≥n</td>\n",
       "      <td>vigo</td>\n",
       "      <td>0.321740</td>\n",
       "      <td>0.223859</td>\n",
       "      <td>0.503519</td>\n",
       "      <td>108</td>\n",
       "      <td>42.222445</td>\n",
       "      <td>-8.751618</td>\n",
       "      <td>['lunes: 09:30‚Äì17:30', 'martes: 08:30‚Äì13:00, 1...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>439</th>\n",
       "      <td>A Mi√±a Bodega</td>\n",
       "      <td>ourense</td>\n",
       "      <td>0.254283</td>\n",
       "      <td>0.106192</td>\n",
       "      <td>0.529309</td>\n",
       "      <td>568</td>\n",
       "      <td>42.342346</td>\n",
       "      <td>-7.856030</td>\n",
       "      <td>['lunes: 12:00‚Äì15:30, 17:30‚Äì00:00', 'martes: 1...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2680</th>\n",
       "      <td>La Pinta</td>\n",
       "      <td>vigo</td>\n",
       "      <td>0.246325</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.703787</td>\n",
       "      <td>215</td>\n",
       "      <td>42.230830</td>\n",
       "      <td>-8.700770</td>\n",
       "      <td>['lunes: 8:00‚Äì23:00', 'martes: 8:00‚Äì23:00', 'm...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-d13a2c34-b164-45e6-a280-bc16d580faf0')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-d13a2c34-b164-45e6-a280-bc16d580faf0 button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-d13a2c34-b164-45e6-a280-bc16d580faf0');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-12a2f2ca-e88e-46de-9644-144f6b18cdce\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-12a2f2ca-e88e-46de-9644-144f6b18cdce')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-12a2f2ca-e88e-46de-9644-144f6b18cdce button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "  <div id=\"id_fc36dd70-a998-470b-948f-b86a65cf26de\">\n",
       "    <style>\n",
       "      .colab-df-generate {\n",
       "        background-color: #E8F0FE;\n",
       "        border: none;\n",
       "        border-radius: 50%;\n",
       "        cursor: pointer;\n",
       "        display: none;\n",
       "        fill: #1967D2;\n",
       "        height: 32px;\n",
       "        padding: 0 0 0 0;\n",
       "        width: 32px;\n",
       "      }\n",
       "\n",
       "      .colab-df-generate:hover {\n",
       "        background-color: #E2EBFA;\n",
       "        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "        fill: #174EA6;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate {\n",
       "        background-color: #3B4455;\n",
       "        fill: #D2E3FC;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate:hover {\n",
       "        background-color: #434B5C;\n",
       "        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "        fill: #FFFFFF;\n",
       "      }\n",
       "    </style>\n",
       "    <button class=\"colab-df-generate\" onclick=\"generateWithVariable('resultados')\"\n",
       "            title=\"Generate code using this dataframe.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "       width=\"24px\">\n",
       "    <path d=\"M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "    <script>\n",
       "      (() => {\n",
       "      const buttonEl =\n",
       "        document.querySelector('#id_fc36dd70-a998-470b-948f-b86a65cf26de button.colab-df-generate');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      buttonEl.onclick = () => {\n",
       "        google.colab.notebook.generateWithVariable('resultados');\n",
       "      }\n",
       "      })();\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                     nombre_final      ciudad  score_hibrido  score_tfidf  \\\n",
       "2193             O Fillo Do Medio    a coru√±a       0.496358     0.471573   \n",
       "1831                    El Gale√≥n        lugo       0.454989     0.379807   \n",
       "2633          Lua Chea Pontevedra  pontevedra       0.454043     0.404690   \n",
       "3180  Cerveceria Sidreria Rosalia    a coru√±a       0.404782     0.332527   \n",
       "1692             Sidreria Carmi√±a        vigo       0.395061     0.352660   \n",
       "1118       Meson Sidreria A Balea    a coru√±a       0.359765     0.255432   \n",
       "253             Sidrer√≠a Monta√±es  pontevedra       0.348336     0.311986   \n",
       "2361         Acendra Restauraci√≥n        vigo       0.321740     0.223859   \n",
       "439                 A Mi√±a Bodega     ourense       0.254283     0.106192   \n",
       "2680                     La Pinta        vigo       0.246325     0.000000   \n",
       "\n",
       "      score_sbert  reviews_final   latitude  longitude  \\\n",
       "2193     0.542386            290  43.362675  -8.409456   \n",
       "1831     0.594614           2075  43.037400  -7.569774   \n",
       "2633     0.545698            177  42.432530  -8.644135   \n",
       "3180     0.538971             99  43.370970  -8.395139   \n",
       "1692     0.473805            484  42.193000  -8.768980   \n",
       "1118     0.553526            698  43.352264  -8.412690   \n",
       "253      0.415844           2344  42.430710  -8.643256   \n",
       "2361     0.503519            108  42.222445  -8.751618   \n",
       "439      0.529309            568  42.342346  -7.856030   \n",
       "2680     0.703787            215  42.230830  -8.700770   \n",
       "\n",
       "                                          horarios_norm  \n",
       "2193  ['lunes: Cerrado', 'martes: Cerrado', 'mi√©rcol...  \n",
       "1831  ['lunes: 09:30‚Äì23:00', 'martes: 09:30‚Äì23:00', ...  \n",
       "2633  ['lunes: 12:00‚Äì16:00, 20:30‚Äì23:30', 'martes: 1...  \n",
       "3180  ['lunes: 12:00‚Äì24:00', 'martes: 12:00‚Äì24:00', ...  \n",
       "1692  ['lunes: Cerrado', 'martes: 19:00‚Äì24:00', 'mi√©...  \n",
       "1118  ['lunes: 11:00‚Äì23:00', 'martes: Cerrado', 'mi√©...  \n",
       "253   ['lunes: Cerrado', 'martes: 13:15‚Äì16:30, 19:30...  \n",
       "2361  ['lunes: 09:30‚Äì17:30', 'martes: 08:30‚Äì13:00, 1...  \n",
       "439   ['lunes: 12:00‚Äì15:30, 17:30‚Äì00:00', 'martes: 1...  \n",
       "2680  ['lunes: 8:00‚Äì23:00', 'martes: 8:00‚Äì23:00', 'm...  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# --- Ejemplo de uso ---\n",
    "print(\"üîé Buscando 'cachopo y sidra' en todo el dataset con modelo MiniLM:\")\n",
    "resultados = buscar_hibrido(\"cachopo y sidra \", top_n=10, alpha=0.65)\n",
    "display(resultados)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 450,
     "referenced_widgets": [
      "aba0a2cfe5f14c81a375adc13e89d1e2",
      "bf909d56f7d648fe9874361316b0c580",
      "1813eeda41584204ba581a860dd67d56",
      "69ea4c47cd9d4538b63247bae5fa6ad8",
      "438dbbc1c062442ea2cb8832f296af75",
      "b129546738f6434d83543a5576fcd70c",
      "594624c76e4845e69006ba90ee528b80",
      "af3bb945fcde4693af887d05c78c9b75",
      "a953eaff264c49a1a0c4edc4c94412e7",
      "7584a8ddb501424084a01b151ef3e3b9",
      "966e921ffe1b435ab2fcb3c63b57aa14",
      "cf53349ed2f941d38836787401741e2a",
      "f482d5e654e74ad3bfee039c8e883c65",
      "6c1056e765844d3796ddb5cb73173ff9",
      "dbff4c2083f149d8a380164d21aad4ee",
      "c0993ed198964e8492ae088f2ec61582",
      "0352e4b586c542efbf9853bf7f285187",
      "e4f00967d28e4b9fba7dfeae8c2a7886",
      "9eb808417c0d42059973dcbd151b1f6a",
      "6b5da8a9f61b4cc7a2053ffbf3b6c2dc",
      "bba6e8c3bc28425483a276d7a804fa1c",
      "9e96b519d1594aaba4ad2bdfe679c2db",
      "6a0c05e953bd4034a06781c529766b43",
      "dfd6f98aae0a46aab6d893363fbd408c",
      "ac257c8afc354bbbb90645559a4794f2",
      "da2db34b7c8a4802994be9001a5436aa",
      "89f99b5182344df69c708ac1df99ce3e",
      "72c18af0bb9e4e8b92dae5539b42e2db",
      "3f344960414c48adb45479e129b15d29",
      "dd1c4fe2ce854263a651188744cce256",
      "ce8433d478ac428b835abc3b1e2992fb",
      "92375e039ced4f9fb48ac848ccdb310b",
      "45f5bb987b144718b4f68c0ddc0bdf58",
      "68b17d14950347aca1ba6a9520f51011",
      "c875361c848e44c4a7616517f0460a46",
      "59d95793fff648689de60f375acc3a54",
      "20e5a7ac1a3f499cb124dc472105986d",
      "21a97473c5744e6c91f5bc0edf175b00",
      "eaceb155f5594bd5a9d48e4fc6abf786",
      "e45e73687f2a4c959d3d26a9f0eb1bc0",
      "2ea4e999068e4df0bd2b0a6b0def6d3c",
      "0a749480955840e1b9e233b18a92bd46",
      "78fdccc4ddac4751b4faffe7c66abf49",
      "c1aa00b132bf4c5b9e4be71eb46be03c",
      "dc60bfec547b44e3b0f11f8a42fee90e",
      "a3eb49ec715a4a4789768bba05a5fa1f",
      "fb264558124e454f86b67bc075f43f94",
      "2946ee29f0fc40aea7fb1443efa98788",
      "36ae322f7afa4b67befd54ba3bcd7272",
      "b1442386d7384d82a655a4be99b26052",
      "6280ed24c4e344b89ed6129ee0bcf255",
      "2b0e0cbee4d349798832281c3c6714b2",
      "ff68c74f532d44589bb06aee8242aa49",
      "40a0fcdcfb694385ab350a82f2e62519",
      "81f6ee1f31eb42f9b7b6d3e3847abe02",
      "56f28590004447a4832c50ed78c14a1b",
      "1063072e36c847fa8d08c9e526af8e28",
      "547db12439844ff2a888444fb69c5977",
      "eb6ce39082434929844c6f18839b9523",
      "0f2db2237a1a4b78b302ebb2c68c55ef",
      "801c6768c09841bdaa911f1969f73c3a",
      "4e149000ea884c379b54753330993f46",
      "a153ef24425847619394468ac2680cc2",
      "3ae539a3d9644f2e8717f2302a50bb46",
      "a10ebcfef6b2484ea1fa77c3cebd14cb",
      "e7a1587a813b46d78f866df2bfb31c5f",
      "8a2ebc4726f9443d9c1af65e925987a7",
      "d211325870a1483793f1363161aed16d",
      "94e88d0c96004bfc9ad414b3af720619",
      "77f29433973c42ceb22b6fcaaf0a7dcb",
      "d07387ee52784a3082445801d8829b96",
      "4a47ab01c61f485a8cd40d645bd5ecc4",
      "7880538fa341418a965ce64588b88b1b",
      "062e7a873b154a8e8f1003ee4c0b4a8f",
      "a38b85f7039d44478ce6069cc58bf5a0",
      "771474af01d248d6a653768ea7faae5e",
      "7fd5f5d2157f4275b12eef16eb636096",
      "02261ebd5929459e96ad700953b22638",
      "e670356d0ee44cba828b1d7f78d85dfd",
      "c005732c06a542c0b677b151d8d53fb6",
      "f9cecc70f4414b8bbc2b92836927166d",
      "9909e709c845422884cc36578ce785d4",
      "9675370d879a480889a5a5371240e2b9",
      "f14a1ebe0ab549d5b45ade39e442cbe9",
      "28e170de7277453c96ab5489c3d583d5",
      "182afd53d4fa486a9192e346f3715eec",
      "eeb809322a1645289ceb719e8ba5d4d0",
      "f806993a0b8b4d128437365fda286b13",
      "c43f24fd7b764ec6aa666f3d2c0794ab",
      "cfdad01f0c1d4eabacd35d427028c186",
      "dade9fcbcdf14e31b716b03e8619f166",
      "8821363759244adfa13e3d032a6c5179",
      "5b1e883feda949ddb9bf724bbd345fcf",
      "3806981cfa624a1cae3370344bfb0536",
      "3bdee3e542e640f0997df3432c405c00",
      "6033dac4891b4aeb8d902881b4e64324",
      "cbc77d0a1cbe47cbb8e208fd4f938119",
      "c9a3e62edc8443e79dd454da5d90efe4",
      "126abe556cdd4bb49682e07c52a7a8db",
      "58dd537e8bfe436e8c30fae00e128d64",
      "18d0fbd45f0c43e1a1111ee9c359a734",
      "d295bceab1994d21b1914f57e0782d5c",
      "d21cdbb1431448ed9b6c2db5d5c77d6d",
      "badba6bcb74948c191a472b9629c725c",
      "9d1201a73cbe41c48b439745e2811389",
      "3b7121c57fd0461bb232455f44c747b7",
      "e59e045c14a04fd998ce0d329c76c16c",
      "0a69d54673fd40909e6923f6d0aa9d2b",
      "d9580192e8ef46d3bd367870e5f2913a",
      "9eeb251ff6304a07b22916550033f7f5",
      "f353174f8c6c464481b73cfe6545f59d",
      "40e6422d5b734825a5129cc20d561d42",
      "b072ed8abf41438caae50f528e3e912d",
      "a0d04adb322a408e8c06eb1f47106aa6",
      "4564175a584c4d15b3e4a1d8e3cc0549",
      "6736dd15d34e44b7841d8f4832a2f108",
      "22c6e6735a294f908f24a911d5533562",
      "92bb2405350f4e28a5b717fecac65caf",
      "52773e5aadad4370aa17dd46c3798dca",
      "cd365673567a4d25ab4803d244cca04f",
      "fd18e62b33374935b47d70c7625e2ab2",
      "04ffbaf99f5445498737d55c9b79fad1",
      "abfa22895ec44771a11b580f3a97ce0e",
      "dc25a85f4e374df691a621a93a536e8f",
      "c65439907f4c4c718545b82d54a97697",
      "e8d663dbe32b46e1ac49b755889dc20c",
      "f0729ebb0ac34380a6697ebc0ed32f5b",
      "08df94b8a5ac4afca6cecee4c5aeb9dd",
      "7a869e4d68344dad8fcbb6e54bf3728a",
      "57bea38be5b3478f9b7e3bbc2a814869",
      "5e066fd705b746ada0b611b6509dc193",
      "4c89532876ae40cea4afe5c896e5ce43",
      "5f767bdc3d0a452b8b9e657746bec12b",
      "8bbc6c9b0777455f96dae95491a07c13",
      "3e9413f13c8041d4840e0dd025b1c763",
      "aaec292dd1c64120a1709dfe69571f92",
      "b4d6f744e48b409396ab0f8e3d13a284",
      "41e7df68c7884fb9a3cc11378887969b",
      "264d243deb764718a40e1024d2c7043f",
      "0be1267f31724ffe98694b4015647fa7",
      "04424055a0bc4d9a93a39521877a6c62",
      "3ae0069aa75340199d5794c6c201144d",
      "12ae95d7c5dd4b54a3091934cfef0621"
     ]
    },
    "executionInfo": {
     "elapsed": 2142859,
     "status": "ok",
     "timestamp": 1761317678597,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -120
    },
    "id": "aLgoaqxz-zKv",
    "outputId": "d2ba54be-744a-4aa5-9044-3b0cbf2f927a"
   },
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "aba0a2cfe5f14c81a375adc13e89d1e2",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "modules.json:   0%|          | 0.00/349 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "cf53349ed2f941d38836787401741e2a",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config_sentence_transformers.json:   0%|          | 0.00/123 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "6a0c05e953bd4034a06781c529766b43",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "README.md: 0.00B [00:00, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "68b17d14950347aca1ba6a9520f51011",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "sentence_bert_config.json:   0%|          | 0.00/54.0 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "dc60bfec547b44e3b0f11f8a42fee90e",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/687 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "56f28590004447a4832c50ed78c14a1b",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "pytorch_model.bin:   0%|          | 0.00/2.27G [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "8a2ebc4726f9443d9c1af65e925987a7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "model.safetensors:   0%|          | 0.00/2.27G [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "02261ebd5929459e96ad700953b22638",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer_config.json:   0%|          | 0.00/444 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c43f24fd7b764ec6aa666f3d2c0794ab",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "sentencepiece.bpe.model:   0%|          | 0.00/5.07M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "58dd537e8bfe436e8c30fae00e128d64",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer.json:   0%|          | 0.00/17.1M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "f353174f8c6c464481b73cfe6545f59d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "special_tokens_map.json:   0%|          | 0.00/964 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "04ffbaf99f5445498737d55c9b79fad1",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/191 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚öôÔ∏è Calculando embeddings con BAAI/bge-m3 (puede tardar unos minutos la primera vez)...\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "5f767bdc3d0a452b8b9e657746bec12b",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Batches:   0%|          | 0/105 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "from sentence_transformers import SentenceTransformer\n",
    "import numpy as np\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "\n",
    "# --- Cargar modelo multiling√ºe avanzado ---\n",
    "model = SentenceTransformer(\"BAAI/bge-m3\")\n",
    "\n",
    "# --- Normalizaci√≥n opcional (recomendado para bge-m3) ---\n",
    "def normalize(vectors):\n",
    "    norms = np.linalg.norm(vectors, axis=1, keepdims=True)\n",
    "    return vectors / np.clip(norms, a_min=1e-10, a_max=None)\n",
    "\n",
    "# --- Precalcular embeddings normalizados de todos los restaurantes ---\n",
    "print(\"‚öôÔ∏è Calculando embeddings con BAAI/bge-m3 (puede tardar unos minutos la primera vez)...\")\n",
    "embeddings = model.encode(\n",
    "    df[\"texto_combinado\"].tolist(),\n",
    "    normalize_embeddings=True,  # bge-m3 soporta normalizaci√≥n interna\n",
    "    show_progress_bar=True\n",
    ")\n",
    "embeddings = np.array(embeddings)\n",
    "\n",
    "# --- Nueva funci√≥n h√≠brida adaptada ---\n",
    "def buscar_hibrido_avanzado(query, top_n=10, alpha=0.5, ciudad=None):\n",
    "    # TF-IDF\n",
    "    query_vec_tfidf = vectorizer.transform([query])\n",
    "    sim_tfidf = cosine_similarity(query_vec_tfidf, tfidf_matrix).flatten()\n",
    "\n",
    "    # Embeddings con bge-m3\n",
    "    query_vec_sbert = model.encode([query], normalize_embeddings=True)\n",
    "    sim_sbert = cosine_similarity(query_vec_sbert, embeddings).flatten()\n",
    "\n",
    "    # Combinar scores (ajustando peso: bge-m3 suele ser m√°s fuerte)\n",
    "    sim_total = alpha * sim_tfidf + (1 - alpha) * sim_sbert\n",
    "\n",
    "    resultados = df.copy()\n",
    "    resultados[\"score_tfidf\"] = sim_tfidf\n",
    "    resultados[\"score_sbert\"] = sim_sbert\n",
    "    resultados[\"score_hibrido\"] = sim_total\n",
    "\n",
    "    # Filtro por ciudad si aplica\n",
    "    if ciudad:\n",
    "        resultados = resultados[resultados[\"ciudad\"].str.lower() == ciudad.lower()]\n",
    "\n",
    "    # Orden por score h√≠brido final\n",
    "    resultados = resultados.sort_values(\"score_hibrido\", ascending=False)\n",
    "\n",
    "    return resultados[[\n",
    "        \"nombre_final\", \"ciudad\",\n",
    "        \"score_hibrido\", \"score_tfidf\", \"score_sbert\",\n",
    "        \"reviews_final\", \"maps_url_final\", \"latitude\", \"longitude\"\n",
    "    ]].head(top_n)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "n7UmpzQr-RH4"
   },
   "outputs": [],
   "source": [
    "# --- Nueva funci√≥n h√≠brida adaptada ---\n",
    "def buscar_hibrido_avanzado(query, top_n=10, alpha=0.5, ciudad=None):\n",
    "    # TF-IDF\n",
    "    query_vec_tfidf = vectorizer.transform([query])\n",
    "    sim_tfidf = cosine_similarity(query_vec_tfidf, tfidf_matrix).flatten()\n",
    "\n",
    "    # Embeddings con bge-m3\n",
    "    query_vec_sbert = model.encode([query], normalize_embeddings=True)\n",
    "    sim_sbert = cosine_similarity(query_vec_sbert, embeddings).flatten()\n",
    "\n",
    "    # Combinar scores (ajustando peso: bge-m3 suele ser m√°s fuerte)\n",
    "    sim_total = alpha * sim_tfidf + (1 - alpha) * sim_sbert\n",
    "\n",
    "    resultados = df.copy()\n",
    "    resultados[\"score_tfidf\"] = sim_tfidf\n",
    "    resultados[\"score_sbert\"] = sim_sbert\n",
    "    resultados[\"score_hibrido\"] = sim_total\n",
    "\n",
    "    # Filtro por ciudad si aplica\n",
    "    if ciudad:\n",
    "        resultados = resultados[resultados[\"ciudad\"].str.lower() == ciudad.lower()]\n",
    "\n",
    "    # Orden por score h√≠brido final\n",
    "    resultados = resultados.sort_values(\"score_hibrido\", ascending=False)\n",
    "\n",
    "    return resultados[[\n",
    "        \"nombre_final\", \"ciudad\",\n",
    "        \"score_hibrido\", \"score_tfidf\", \"score_sbert\",\n",
    "        \"reviews_final\", \"maps_url_final\", \"latitude\", \"longitude\"\n",
    "    ]].head(top_n)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 380
    },
    "executionInfo": {
     "elapsed": 408,
     "status": "ok",
     "timestamp": 1761317679027,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -120
    },
    "id": "u_CHe2d1AEUo",
    "outputId": "a9b1773e-1d6b-4689-a7e0-8620700c4ca5"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üîé Buscando 'buenas vistas' en todo el dataset con modelo BGE-M3:\n"
     ]
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"resultados\",\n  \"rows\": 10,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"El patio de Valle Incl\\u00e1n\",\n          \"Golden 2\",\n          \"El Buen Tapeo gastrobar\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"vigo\",\n          \"lugo\",\n          \"ourense\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_hibrido\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.013549439461525961,\n        \"min\": 0.49217867851257324,\n        \"max\": 0.5245025157928467,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.49227601289749146,\n          0.5240976214408875,\n          0.4984913170337677\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_tfidf\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.0,\n        \"min\": 0.0,\n        \"max\": 0.0,\n        \"num_unique_values\": 1,\n        \"samples\": [\n          0.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_sbert\",\n      \"properties\": {\n        \"dtype\": \"float32\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.49227601289749146\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"reviews_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 570,\n        \"min\": 66,\n        \"max\": 1957,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          423\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"maps_url_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"https://maps.google.com/?cid=2921189024909109097&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"latitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.533074659049731,\n        \"min\": 42.2188536,\n        \"max\": 43.3706587,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          42.433548\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"longitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.3565516401669899,\n        \"min\": -8.7357444,\n        \"max\": -7.62461,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          -8.6459\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe",
       "variable_name": "resultados"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-6e651e98-9ce8-4a03-a670-0fa61a81d7bb\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>score_hibrido</th>\n",
       "      <th>score_tfidf</th>\n",
       "      <th>score_sbert</th>\n",
       "      <th>reviews_final</th>\n",
       "      <th>maps_url_final</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2865</th>\n",
       "      <td>Mirador</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.524503</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.524503</td>\n",
       "      <td>196</td>\n",
       "      <td>https://maps.google.com/?cid=39796796148558735...</td>\n",
       "      <td>43.366760</td>\n",
       "      <td>-8.403084</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1574</th>\n",
       "      <td>Golden 2</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.524098</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.524098</td>\n",
       "      <td>771</td>\n",
       "      <td>https://maps.google.com/?cid=16411654320294095833</td>\n",
       "      <td>43.359960</td>\n",
       "      <td>-8.419670</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2801</th>\n",
       "      <td>GALEGUESA</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.521442</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.521442</td>\n",
       "      <td>66</td>\n",
       "      <td>https://maps.google.com/?cid=17483985848188473...</td>\n",
       "      <td>43.370659</td>\n",
       "      <td>-8.396790</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2667</th>\n",
       "      <td>Mes√≥n do Vento.</td>\n",
       "      <td>vigo</td>\n",
       "      <td>0.512345</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.512345</td>\n",
       "      <td>224</td>\n",
       "      <td>https://maps.google.com/?cid=56408355600227309...</td>\n",
       "      <td>42.232780</td>\n",
       "      <td>-8.712484</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2735</th>\n",
       "      <td>Crazy Meals!</td>\n",
       "      <td>vigo</td>\n",
       "      <td>0.506206</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.506206</td>\n",
       "      <td>80</td>\n",
       "      <td>https://maps.google.com/?cid=72950241310573945...</td>\n",
       "      <td>42.218854</td>\n",
       "      <td>-8.735744</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>313</th>\n",
       "      <td>El Buen Tapeo gastrobar</td>\n",
       "      <td>ourense</td>\n",
       "      <td>0.498491</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.498491</td>\n",
       "      <td>708</td>\n",
       "      <td>https://maps.google.com/?cid=13937495388697659...</td>\n",
       "      <td>42.335392</td>\n",
       "      <td>-7.864552</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>127</th>\n",
       "      <td>Gazteka</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.496059</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.496059</td>\n",
       "      <td>1957</td>\n",
       "      <td>https://maps.google.com/?cid=14020558532091895...</td>\n",
       "      <td>43.368256</td>\n",
       "      <td>-8.405438</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1246</th>\n",
       "      <td>Entrepans</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>0.492996</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.492996</td>\n",
       "      <td>480</td>\n",
       "      <td>https://maps.google.com/?cid=85854825634460915...</td>\n",
       "      <td>43.341670</td>\n",
       "      <td>-8.403660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>962</th>\n",
       "      <td>El patio de Valle Incl√°n</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>0.492276</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.492276</td>\n",
       "      <td>423</td>\n",
       "      <td>https://maps.google.com/?cid=29211890249091090...</td>\n",
       "      <td>42.433548</td>\n",
       "      <td>-8.645900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2706</th>\n",
       "      <td>A Cantina</td>\n",
       "      <td>lugo</td>\n",
       "      <td>0.492179</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.492179</td>\n",
       "      <td>119</td>\n",
       "      <td>https://maps.google.com/?cid=10168889113250249...</td>\n",
       "      <td>43.121258</td>\n",
       "      <td>-7.624610</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-6e651e98-9ce8-4a03-a670-0fa61a81d7bb')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-6e651e98-9ce8-4a03-a670-0fa61a81d7bb button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-6e651e98-9ce8-4a03-a670-0fa61a81d7bb');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-39ff35be-2aaf-4281-b551-bc3f86e7ea6e\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-39ff35be-2aaf-4281-b551-bc3f86e7ea6e')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-39ff35be-2aaf-4281-b551-bc3f86e7ea6e button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "  <div id=\"id_2af22ad9-c971-4a73-beea-55d360d317d5\">\n",
       "    <style>\n",
       "      .colab-df-generate {\n",
       "        background-color: #E8F0FE;\n",
       "        border: none;\n",
       "        border-radius: 50%;\n",
       "        cursor: pointer;\n",
       "        display: none;\n",
       "        fill: #1967D2;\n",
       "        height: 32px;\n",
       "        padding: 0 0 0 0;\n",
       "        width: 32px;\n",
       "      }\n",
       "\n",
       "      .colab-df-generate:hover {\n",
       "        background-color: #E2EBFA;\n",
       "        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "        fill: #174EA6;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate {\n",
       "        background-color: #3B4455;\n",
       "        fill: #D2E3FC;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate:hover {\n",
       "        background-color: #434B5C;\n",
       "        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "        fill: #FFFFFF;\n",
       "      }\n",
       "    </style>\n",
       "    <button class=\"colab-df-generate\" onclick=\"generateWithVariable('resultados')\"\n",
       "            title=\"Generate code using this dataframe.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "       width=\"24px\">\n",
       "    <path d=\"M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "    <script>\n",
       "      (() => {\n",
       "      const buttonEl =\n",
       "        document.querySelector('#id_2af22ad9-c971-4a73-beea-55d360d317d5 button.colab-df-generate');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      buttonEl.onclick = () => {\n",
       "        google.colab.notebook.generateWithVariable('resultados');\n",
       "      }\n",
       "      })();\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                  nombre_final      ciudad  score_hibrido  score_tfidf  \\\n",
       "2865                   Mirador    a coru√±a       0.524503          0.0   \n",
       "1574                  Golden 2    a coru√±a       0.524098          0.0   \n",
       "2801                 GALEGUESA    a coru√±a       0.521442          0.0   \n",
       "2667           Mes√≥n do Vento.        vigo       0.512345          0.0   \n",
       "2735              Crazy Meals!        vigo       0.506206          0.0   \n",
       "313    El Buen Tapeo gastrobar     ourense       0.498491          0.0   \n",
       "127                    Gazteka    a coru√±a       0.496059          0.0   \n",
       "1246                 Entrepans    a coru√±a       0.492996          0.0   \n",
       "962   El patio de Valle Incl√°n  pontevedra       0.492276          0.0   \n",
       "2706                 A Cantina        lugo       0.492179          0.0   \n",
       "\n",
       "      score_sbert  reviews_final  \\\n",
       "2865     0.524503            196   \n",
       "1574     0.524098            771   \n",
       "2801     0.521442             66   \n",
       "2667     0.512345            224   \n",
       "2735     0.506206             80   \n",
       "313      0.498491            708   \n",
       "127      0.496059           1957   \n",
       "1246     0.492996            480   \n",
       "962      0.492276            423   \n",
       "2706     0.492179            119   \n",
       "\n",
       "                                         maps_url_final   latitude  longitude  \n",
       "2865  https://maps.google.com/?cid=39796796148558735...  43.366760  -8.403084  \n",
       "1574  https://maps.google.com/?cid=16411654320294095833  43.359960  -8.419670  \n",
       "2801  https://maps.google.com/?cid=17483985848188473...  43.370659  -8.396790  \n",
       "2667  https://maps.google.com/?cid=56408355600227309...  42.232780  -8.712484  \n",
       "2735  https://maps.google.com/?cid=72950241310573945...  42.218854  -8.735744  \n",
       "313   https://maps.google.com/?cid=13937495388697659...  42.335392  -7.864552  \n",
       "127   https://maps.google.com/?cid=14020558532091895...  43.368256  -8.405438  \n",
       "1246  https://maps.google.com/?cid=85854825634460915...  43.341670  -8.403660  \n",
       "962   https://maps.google.com/?cid=29211890249091090...  42.433548  -8.645900  \n",
       "2706  https://maps.google.com/?cid=10168889113250249...  43.121258  -7.624610  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# --- Ejemplo de uso ---\n",
    "print(\"üîé Buscando 'buenas vistas' en todo el dataset con modelo BGE-M3:\")\n",
    "resultados = buscar_hibrido_avanzado(\"buenas vistas\", top_n=10, alpha=0)\n",
    "display(resultados)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 404,
     "referenced_widgets": [
      "789ac96643d9443ea73c709dc864fe2a",
      "e1b9f47ce6fc420a9b97be2a836c729f",
      "f47420107e7040b8a9cee7b75c80176b",
      "59b3254f857b4b14bc3dd3c4daf1e395",
      "adf6ee29cfd14bdda67a4194a8f5ff29",
      "14974e7cace248c38ee72dbcc6da44ea",
      "be174fa282cd4ddeae8fe9bdd19e6940",
      "e5f1891951c74787b2fe6830b045e480",
      "bef411815d7b47e8b84ef359db1eb41f",
      "993ceb55d2764b3db01d1fd30424b469",
      "1dd851c01a3043dd88eb70628f473069",
      "d9b2c86b85f74426af4c645c3a93b3ab",
      "2add88415d5d4ec782c9c7718c36029e",
      "7718e15e90b74f53a627eaa9c4f4b413",
      "781e1d0c004e4ce4ac6055e937b8abf0",
      "8c9908fda12a47678c610f8c9e96d819",
      "6990e2b96d24453086d7f676dc58e798",
      "a5236698498c4a0d9cfbc947f7fa2668",
      "a69c45eeda6747a78a2e574a99603d24",
      "834ebd84006a498bbe5d208621b9e806",
      "5b99f9031cf64e9ca3fadb4553a6f7e6",
      "f642b0a6783d4d3ea231489f26aed454",
      "74411366b319489bb18182a3873e02e7",
      "abb4661bf8604dcd8ee2c1eaf4a95e11",
      "848e4e5d88244a2c8f73b4a6048a956c",
      "be019b2b82bb4c83ad061ace62243bcf",
      "a31248d89240482ca895495e844ca035",
      "cfa717d6ce004714a738ef4b56e1eafb",
      "d5325be8fc2f4c4ebcd49d09d7cfa2d1",
      "151bfbd60a2d4f86ae0773f71c721b36",
      "1a27dda2364a4e10961d5469cb2a528c",
      "0947539ff3c74f468d725a40bb481d5e",
      "f8a5f86b011845e0819d5ea138708ae3",
      "55904ed82e5e4bb5a7805c2fc4d40eea",
      "cea1e2855dc543c38f049fd890f47582",
      "e614edb8ce9f447e9dc6f4344bf00c5a",
      "523af681cfb4475ebb7615272eb1f10b",
      "0fac87ebc96e46c2bcc93f948ccbee9d",
      "76e2731a4beb4b57b6cbb9e8903b678d",
      "e93eb3821ac3425dbc5a22de79ee724d",
      "f92f27df76fb48c08d6f3f6cb1d29eb6",
      "dc8b98a001b24720b5e1882d3fb703dd",
      "74d119e1a26443ed97373657d73ddd2b",
      "805698989f134f0e9254c18a1fc43be0",
      "b6c4242ea1e1403bb085087ab5d3ac46",
      "5f501fc07b67480f84738c67bfd33f0d",
      "9401b5e9942c468c8692bfb45518810f",
      "b3b276cdbaaf4e58bd31fa7285d698d6",
      "82667414f0aa4075bcb0cff3cf125d34",
      "cd9fd5698f684f63a6885d5d5cc0e5f6",
      "3d3b571f67754fa6949828cb5296ec9b",
      "78dde01f0e344c0c80db4dbc387f829b",
      "aa1760eaff7449f7aa3167b153bda080",
      "7d1f615e18934b2f829c20d766db1b02",
      "e067887090e9414a929d2a869223b326",
      "8622b75e4df14a54bd1bfe029e1f3ff2",
      "804ac8638b0a4de4a960567d6afd3724",
      "d854dd0442534892bb257a670ca6d06b",
      "fa5846ee99434326b0b8edab01d1788e",
      "4aacfee22b1c4cf18818c17475d79fd6",
      "16abf2d1d663495e9ff8c5f2153b8d60",
      "a6dc2e06e3b44d73afbd4747702f5e89",
      "1465222571504495b48bc8a72162c300",
      "1dbcf7ae8d724c2488603bfe224ff488",
      "0bfad90981f94581adb0738de596811e",
      "d42a52b6c99e433aa605a31f3c4c0d1a",
      "2330ad714fa242c2888efe316b3bfc82",
      "b779184590e442949e057a2ecedcc8b1",
      "504c72f2b6f245b7a294c3a727c9f457",
      "6e748e0613cf45269d5d962759938a7d",
      "f9c80f712ac6493d85916dddb8a38e39",
      "0133de1adb0f46eea48c0a0d1ed060c7",
      "89220e0265c640cba1fa0e7bd389b440",
      "eb5be35c95eb4a68a6111b8812359684",
      "c3996fadfbd040dba239a9654c857c03",
      "4c23e144f1fb4af6ae38f838a1a442e9",
      "7dc0e8ad8bda43c1a91e93e621fe411a",
      "48d852ae78e543f58fddc5b51560f9eb",
      "bcfc8b7dc5474fa1954bfa476583cccd",
      "c3a0bc18d8894126b5e52cdeaf342b31",
      "5fd8444d9cc94915971c23ae8c7fb57e",
      "adf29983face426d9759e8b395f45675",
      "832ef88f7a2f43879e3cef6bacc22d4a",
      "17f9a60064184c27b3eb6997f8006210",
      "aaab869b2b2b4e43b70cd021bbeb0dae",
      "869fc6ab2367430883b147cd9ee90d5a",
      "51c5ba40de574636b77633fa1e4f4b83",
      "075b62648a9f4f1e9775e726b468190e",
      "dc59c684b4414bf4b680432ac7fd5aab",
      "e93744c9ac1244b4975e4f08538a9909",
      "dec5d7f69e3f4f25a03867369b024471",
      "8df1984fb8bf4fceaafa7cde75027c3c",
      "1a9637591fd940b7a75162a2b16b0446",
      "736de7a619f1454484c5d1b41074a2b7",
      "2553a8a8852044feadcfc90e96c3774b",
      "ad666ce54c514aa7b56d581f0fe308e7",
      "94ab8cf1261b40d8962476c48df14c9a",
      "09cbb2c702364006a1f498dfede792b5",
      "e854883a0b594d97a1a9144a819f6380",
      "594f97e247904d0c8d64c940b49a7b7c",
      "dec7cf13c2f34dd48876bb74ba02673a",
      "519d5838c6ea4cca8aa34dbdd7a13fac",
      "1ef73058d9ad46fba6a5185d4a0c3a5a",
      "89253fc073144897bdda3fcc3fdad03b",
      "c620e25a2cd541d6a8107b1f7a44d069",
      "2c617af9501a42deb1679d3f259b722b",
      "0d1febe8f2cb408c9964d0f1272f11e2",
      "a1b7f5b7f7f542ac9a045057bbf28aac",
      "32096f9821be44a0828cc4108680f498",
      "72e26e5438d64f8b93d0dd874a8a5a6f",
      "40180bd374e64feb947a4dffd048d4b1",
      "be88ee8306714738afac04aebab4189a",
      "46f6ebe8a2bc4162a8d7c6f6229b7441",
      "7ba071ff3be445169e5593c62174e182",
      "634ba0074f76450a85f60de9528a050d",
      "7bca07cd3ff348fba88c23f6d5b344da",
      "cc02ef93bedc45f1bfa48d7379a542a6",
      "dc91a94e35f343bc9852749ff4476960",
      "3c752f8acaf14a17b2874cbcb773d9c5",
      "54b3100b51b342c19dcba8c98b00ff6d",
      "7be788f4464442ba85d3f6ab7a33e6e6"
     ]
    },
    "executionInfo": {
     "elapsed": 698479,
     "status": "ok",
     "timestamp": 1761318377509,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -120
    },
    "id": "yM4Dr8JMHQbx",
    "outputId": "79f2c485-22ca-4e0a-c313-e58bb5a19bd3"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚öôÔ∏è Cargando modelo multilingual-e5-base (puede tardar unos segundos)...\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "789ac96643d9443ea73c709dc864fe2a",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "modules.json:   0%|          | 0.00/387 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "d9b2c86b85f74426af4c645c3a93b3ab",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "README.md: 0.00B [00:00, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "74411366b319489bb18182a3873e02e7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "sentence_bert_config.json:   0%|          | 0.00/57.0 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "55904ed82e5e4bb5a7805c2fc4d40eea",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/694 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "b6c4242ea1e1403bb085087ab5d3ac46",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "model.safetensors:   0%|          | 0.00/1.11G [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "8622b75e4df14a54bd1bfe029e1f3ff2",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer_config.json:   0%|          | 0.00/418 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "2330ad714fa242c2888efe316b3bfc82",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "sentencepiece.bpe.model:   0%|          | 0.00/5.07M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "48d852ae78e543f58fddc5b51560f9eb",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "tokenizer.json:   0%|          | 0.00/17.1M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "dc59c684b4414bf4b680432ac7fd5aab",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "special_tokens_map.json:   0%|          | 0.00/280 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "594f97e247904d0c8d64c940b49a7b7c",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/200 [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "40180bd374e64feb947a4dffd048d4b1",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Batches:   0%|          | 0/105 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Embeddings calculados: (3357, 768)\n"
     ]
    }
   ],
   "source": [
    "# --- BLOQUE: B√∫squeda h√≠brida con modelo multilingual-e5-base ---\n",
    "\n",
    "from sentence_transformers import SentenceTransformer\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "import numpy as np\n",
    "\n",
    "# --- Cargar el modelo E5 ---\n",
    "# Es multiling√ºe y entiende frases completas tipo \"comida gallega con sidra\"\n",
    "print(\"‚öôÔ∏è Cargando modelo multilingual-e5-base (puede tardar unos segundos)...\")\n",
    "model = SentenceTransformer(\"intfloat/multilingual-e5-base\")\n",
    "\n",
    "# --- Preparar embeddings del corpus (solo se hace una vez) ---\n",
    "# A√±adimos el prefijo \"passage: \" como recomienda el modelo\n",
    "corpus = [\"passage: \" + t for t in df[\"texto_combinado\"].astype(str).tolist()]\n",
    "embeddings = model.encode(corpus, normalize_embeddings=True, show_progress_bar=True)\n",
    "embeddings = np.array(embeddings)\n",
    "print(f\"‚úÖ Embeddings calculados: {embeddings.shape}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "c6pZ2qBjJnmm"
   },
   "outputs": [],
   "source": [
    "def buscar_hibrido_e5(query, top_n=10, alpha=0.65, ciudad=None, df_base=None):\n",
    "    \"\"\"\n",
    "    B√∫squeda h√≠brida TF-IDF + multilingual-E5-base.\n",
    "    Combina coincidencia literal (TF-IDF) y sem√°ntica (E5),\n",
    "    y permite limitar la b√∫squeda a un subconjunto filtrado (df_base).\n",
    "    \"\"\"\n",
    "\n",
    "    # --- Seleccionar base de datos ---\n",
    "    if df_base is not None:\n",
    "        df_local = df_base.copy()\n",
    "        idx_local = df.index.isin(df_base.index)\n",
    "    else:\n",
    "        df_local = df.copy()\n",
    "        idx_local = np.ones(len(df), dtype=bool)\n",
    "\n",
    "    # --- TF-IDF ---\n",
    "    query_vec_tfidf = vectorizer.transform([query])\n",
    "    sim_tfidf_global = cosine_similarity(query_vec_tfidf, tfidf_matrix).flatten()\n",
    "\n",
    "    # --- Embeddings sem√°nticos (E5) ---\n",
    "    query_vec_e5 = model.encode([\"query: \" + query], normalize_embeddings=True)\n",
    "    sim_e5_global = cosine_similarity(query_vec_e5, embeddings).flatten()\n",
    "\n",
    "    # --- Combinar pesos ---\n",
    "    sim_total_global = alpha * sim_tfidf_global + (1 - alpha) * sim_e5_global\n",
    "\n",
    "    # --- Filtrar los √≠ndices locales (si df_base est√° definido) ---\n",
    "    sim_tfidf = sim_tfidf_global[idx_local]\n",
    "    sim_e5 = sim_e5_global[idx_local]\n",
    "    sim_total = sim_total_global[idx_local]\n",
    "\n",
    "    # --- Asignar scores al df_local ---\n",
    "    df_local = df_local.copy()\n",
    "    df_local[\"score_tfidf\"] = sim_tfidf\n",
    "    df_local[\"score_sbert\"] = sim_e5\n",
    "    df_local[\"score_hibrido\"] = sim_total\n",
    "\n",
    "    # --- Filtro por ciudad si aplica ---\n",
    "    if ciudad:\n",
    "        df_local = df_local[df_local[\"ciudad\"].str.lower() == ciudad.lower()]\n",
    "\n",
    "    # --- Orden final ---\n",
    "    df_local = df_local.sort_values(\"score_hibrido\", ascending=False)\n",
    "\n",
    "    return df_local[[\n",
    "        \"nombre_final\", \"ciudad\", \"rating_final\", \"price_num\",\n",
    "        \"score_hibrido\", \"score_tfidf\", \"score_sbert\",\n",
    "        \"reviews_final\", \"maps_url_final\", \"latitude\", \"longitude\"\n",
    "    ]].head(top_n)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 554
    },
    "executionInfo": {
     "elapsed": 207,
     "status": "ok",
     "timestamp": 1761318377719,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -120
    },
    "id": "ImM5h3LGlzQG",
    "outputId": "8f04b1e7-c56a-4739-faaf-a581b05e6418"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üîé Buscando 'buenas vistas' en todo el dataset con multilingual-e5-base:\n"
     ]
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"resultados\",\n  \"rows\": 10,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"La Buena Vida Pontevedra\",\n          \"El Mirador\",\n          \"Contracorriente\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"vigo\",\n          \"santiago\",\n          \"ourense\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rating_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.4836206042848969,\n        \"min\": 3.1,\n        \"max\": 4.8,\n        \"num_unique_values\": 8,\n        \"samples\": [\n          3.9,\n          4.7,\n          4.6\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"price_num\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.8521681032463467,\n        \"min\": 1.0,\n        \"max\": 3.0,\n        \"num_unique_values\": 4,\n        \"samples\": [\n          1.0,\n          3.0,\n          2.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_hibrido\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.0047358411041262425,\n        \"min\": 0.8075770735740662,\n        \"max\": 0.8216044306755066,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.8083035349845886,\n          0.8212192058563232,\n          0.8137574195861816\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_tfidf\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.0,\n        \"min\": 0.0,\n        \"max\": 0.0,\n        \"num_unique_values\": 1,\n        \"samples\": [\n          0.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"score_sbert\",\n      \"properties\": {\n        \"dtype\": \"float32\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          0.8083035349845886\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"reviews_final\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 1162,\n        \"min\": 16,\n        \"max\": 3905,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          327\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"maps_url_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"https://maps.google.com/?cid=10730030041078475341&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"latitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.5377527870040256,\n        \"min\": 42.214104,\n        \"max\": 43.36676,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          42.429386\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"longitude\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.26483583363167995,\n        \"min\": -8.7506444,\n        \"max\": -7.859284,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          -8.639238\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe",
       "variable_name": "resultados"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-c2bdf148-2213-4bc5-b1fb-aa07d23398aa\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>rating_final</th>\n",
       "      <th>price_num</th>\n",
       "      <th>score_hibrido</th>\n",
       "      <th>score_tfidf</th>\n",
       "      <th>score_sbert</th>\n",
       "      <th>reviews_final</th>\n",
       "      <th>maps_url_final</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2210</th>\n",
       "      <td>La Bonita</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>4.6</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.821604</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.821604</td>\n",
       "      <td>84</td>\n",
       "      <td>https://maps.google.com/?cid=14569553216566100...</td>\n",
       "      <td>43.361013</td>\n",
       "      <td>-8.406685</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1621</th>\n",
       "      <td>El Mirador</td>\n",
       "      <td>vigo</td>\n",
       "      <td>3.9</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.821219</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.821219</td>\n",
       "      <td>399</td>\n",
       "      <td>https://maps.google.com/?cid=17816340372731294...</td>\n",
       "      <td>42.236470</td>\n",
       "      <td>-8.727980</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3267</th>\n",
       "      <td>La Buena Vida</td>\n",
       "      <td>vigo</td>\n",
       "      <td>4.3</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.816418</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.816418</td>\n",
       "      <td>16</td>\n",
       "      <td>https://maps.google.com/?cid=64980533779102930...</td>\n",
       "      <td>42.214104</td>\n",
       "      <td>-8.750644</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2865</th>\n",
       "      <td>Mirador</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>3.1</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.816177</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.816177</td>\n",
       "      <td>196</td>\n",
       "      <td>https://maps.google.com/?cid=39796796148558735...</td>\n",
       "      <td>43.366760</td>\n",
       "      <td>-8.403084</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1982</th>\n",
       "      <td>Bonilla a la Vista</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>4.2</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.814182</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.814182</td>\n",
       "      <td>822</td>\n",
       "      <td>https://maps.google.com/?cid=37906581132997581...</td>\n",
       "      <td>43.365570</td>\n",
       "      <td>-8.408526</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1890</th>\n",
       "      <td>Contracorriente</td>\n",
       "      <td>ourense</td>\n",
       "      <td>4.7</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.813757</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.813757</td>\n",
       "      <td>287</td>\n",
       "      <td>https://maps.google.com/?cid=17646032886721365664</td>\n",
       "      <td>42.343080</td>\n",
       "      <td>-7.859284</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2578</th>\n",
       "      <td>Bar Buenavista</td>\n",
       "      <td>vigo</td>\n",
       "      <td>4.8</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.812315</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.812315</td>\n",
       "      <td>174</td>\n",
       "      <td>https://maps.google.com/?cid=14723783550735364801</td>\n",
       "      <td>42.236600</td>\n",
       "      <td>-8.727867</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2118</th>\n",
       "      <td>La Aldea Biomarket</td>\n",
       "      <td>a coru√±a</td>\n",
       "      <td>4.2</td>\n",
       "      <td>2.5</td>\n",
       "      <td>0.811614</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.811614</td>\n",
       "      <td>357</td>\n",
       "      <td>https://maps.google.com/?cid=13278112074712886...</td>\n",
       "      <td>43.365726</td>\n",
       "      <td>-8.410712</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1918</th>\n",
       "      <td>La Buena Vida Pontevedra</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>4.3</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.808304</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.808304</td>\n",
       "      <td>327</td>\n",
       "      <td>https://maps.google.com/?cid=10730030041078475...</td>\n",
       "      <td>42.429386</td>\n",
       "      <td>-8.639238</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>Abastos 2.0</td>\n",
       "      <td>santiago</td>\n",
       "      <td>4.4</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.807577</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.807577</td>\n",
       "      <td>3905</td>\n",
       "      <td>https://maps.google.com/?cid=11312090037000363...</td>\n",
       "      <td>42.879982</td>\n",
       "      <td>-8.541538</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c2bdf148-2213-4bc5-b1fb-aa07d23398aa')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-c2bdf148-2213-4bc5-b1fb-aa07d23398aa button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-c2bdf148-2213-4bc5-b1fb-aa07d23398aa');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-f8287bb5-087f-44f1-9740-55270ff9ec6a\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-f8287bb5-087f-44f1-9740-55270ff9ec6a')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-f8287bb5-087f-44f1-9740-55270ff9ec6a button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "  <div id=\"id_aad9db2e-b61a-43aa-a782-aae22090636f\">\n",
       "    <style>\n",
       "      .colab-df-generate {\n",
       "        background-color: #E8F0FE;\n",
       "        border: none;\n",
       "        border-radius: 50%;\n",
       "        cursor: pointer;\n",
       "        display: none;\n",
       "        fill: #1967D2;\n",
       "        height: 32px;\n",
       "        padding: 0 0 0 0;\n",
       "        width: 32px;\n",
       "      }\n",
       "\n",
       "      .colab-df-generate:hover {\n",
       "        background-color: #E2EBFA;\n",
       "        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "        fill: #174EA6;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate {\n",
       "        background-color: #3B4455;\n",
       "        fill: #D2E3FC;\n",
       "      }\n",
       "\n",
       "      [theme=dark] .colab-df-generate:hover {\n",
       "        background-color: #434B5C;\n",
       "        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "        fill: #FFFFFF;\n",
       "      }\n",
       "    </style>\n",
       "    <button class=\"colab-df-generate\" onclick=\"generateWithVariable('resultados')\"\n",
       "            title=\"Generate code using this dataframe.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "       width=\"24px\">\n",
       "    <path d=\"M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "    <script>\n",
       "      (() => {\n",
       "      const buttonEl =\n",
       "        document.querySelector('#id_aad9db2e-b61a-43aa-a782-aae22090636f button.colab-df-generate');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      buttonEl.onclick = () => {\n",
       "        google.colab.notebook.generateWithVariable('resultados');\n",
       "      }\n",
       "      })();\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                  nombre_final      ciudad  rating_final  price_num  \\\n",
       "2210                 La Bonita    a coru√±a           4.6        2.0   \n",
       "1621                El Mirador        vigo           3.9        1.0   \n",
       "3267             La Buena Vida        vigo           4.3        1.0   \n",
       "2865                   Mirador    a coru√±a           3.1        1.0   \n",
       "1982        Bonilla a la Vista    a coru√±a           4.2        1.0   \n",
       "1890           Contracorriente     ourense           4.7        NaN   \n",
       "2578            Bar Buenavista        vigo           4.8        NaN   \n",
       "2118        La Aldea Biomarket    a coru√±a           4.2        2.5   \n",
       "1918  La Buena Vida Pontevedra  pontevedra           4.3        NaN   \n",
       "14                 Abastos 2.0    santiago           4.4        3.0   \n",
       "\n",
       "      score_hibrido  score_tfidf  score_sbert  reviews_final  \\\n",
       "2210       0.821604          0.0     0.821604             84   \n",
       "1621       0.821219          0.0     0.821219            399   \n",
       "3267       0.816418          0.0     0.816418             16   \n",
       "2865       0.816177          0.0     0.816177            196   \n",
       "1982       0.814182          0.0     0.814182            822   \n",
       "1890       0.813757          0.0     0.813757            287   \n",
       "2578       0.812315          0.0     0.812315            174   \n",
       "2118       0.811614          0.0     0.811614            357   \n",
       "1918       0.808304          0.0     0.808304            327   \n",
       "14         0.807577          0.0     0.807577           3905   \n",
       "\n",
       "                                         maps_url_final   latitude  longitude  \n",
       "2210  https://maps.google.com/?cid=14569553216566100...  43.361013  -8.406685  \n",
       "1621  https://maps.google.com/?cid=17816340372731294...  42.236470  -8.727980  \n",
       "3267  https://maps.google.com/?cid=64980533779102930...  42.214104  -8.750644  \n",
       "2865  https://maps.google.com/?cid=39796796148558735...  43.366760  -8.403084  \n",
       "1982  https://maps.google.com/?cid=37906581132997581...  43.365570  -8.408526  \n",
       "1890  https://maps.google.com/?cid=17646032886721365664  42.343080  -7.859284  \n",
       "2578  https://maps.google.com/?cid=14723783550735364801  42.236600  -8.727867  \n",
       "2118  https://maps.google.com/?cid=13278112074712886...  43.365726  -8.410712  \n",
       "1918  https://maps.google.com/?cid=10730030041078475...  42.429386  -8.639238  \n",
       "14    https://maps.google.com/?cid=11312090037000363...  42.879982  -8.541538  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# --- Ejemplo de uso ---\n",
    "print(\"üîé Buscando 'buenas vistas' en todo el dataset con multilingual-e5-base:\")\n",
    "resultados = buscar_hibrido_e5(\"buenas vistas\", top_n=10, alpha=0)\n",
    "display(resultados)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "m1EyHOksk9ol"
   },
   "outputs": [],
   "source": [
    "# --- Utilidades comunes ---\n",
    "\n",
    "def limpiar_duplicados(df_in):\n",
    "    \"\"\"Elimina duplicados seg√∫n 'id' o (nombre_final, ciudad).\"\"\"\n",
    "    return df_in.drop_duplicates(\n",
    "        subset=[\"id\"] if \"id\" in df_in.columns else [\"nombre_final\", \"ciudad\"]\n",
    "    )\n",
    "\n",
    "def seleccionar_columnas(df):\n",
    "    \"\"\"Selecciona columnas esenciales + extras si existen.\"\"\"\n",
    "    base = [\n",
    "        \"nombre_final\", \"ciudad\", \"rating_final\", \"price_num\",\n",
    "        \"maps_url_final\", \"reviews_final\", \"criterio\",\"criterio_orden\"\n",
    "    ]\n",
    "    extras = [\n",
    "        \"score_hibrido\", \"horarios_norm\", \"horarios_lista\",\n",
    "        \"latitude\", \"longitude\", \"phone\", \"international_phone\",\n",
    "        \"website\", \"email\", \"featured_image\", \"menu_link\",\n",
    "        \"reservation_link\", \"delivery\", \"reservable\"\n",
    "    ]\n",
    "    for extra in extras:\n",
    "        if extra in df.columns:\n",
    "            base.append(extra)\n",
    "    return df[base]\n",
    "\n",
    "\n",
    "# --- Prioridades globales coherentes ---\n",
    "PRIORIDAD_MAP = {\n",
    "    \"üìå Coincidencia exacta en texto\": 1,     # texto + flags/subcats\n",
    "    \"üìå Coincide con\": 2,                     # solo flags/subcats\n",
    "    \"üîé Coincidencia exacta en texto\": 3,     # texto solo\n",
    "    \"‚ú® B√∫squeda sem√°ntica\": 4,               # b√∫squeda sem√°ntica h√≠brida\n",
    "}\n",
    "\n",
    "def asignar_prioridad(criterio):\n",
    "    \"\"\"Asigna prioridad seg√∫n el tipo de coincidencia textual (parcial).\"\"\"\n",
    "    for clave, valor in PRIORIDAD_MAP.items():\n",
    "        if clave in str(criterio):  # <-- coincide aunque haya flag_pizza, subcat_asiatica_ramen, etc.\n",
    "            return valor\n",
    "    return 99\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "6N53hjboWWWN"
   },
   "source": [
    "## B√∫squeda h√≠brida + flags/subcategor√≠as\n",
    "\n",
    "Hasta ahora el sistema combinaba directamente TF-IDF y embeddings sem√°nticos.  \n",
    "Sin embargo, en muchos casos el usuario espera que las coincidencias **m√°s literales** y con **categor√≠as activas** aparezcan primero.\n",
    "\n",
    "Por ello se implementa una b√∫squeda jer√°rquica con niveles de prioridad:\n",
    "\n",
    "1. **Coincidencia exacta + flags/subcategor√≠as**  \n",
    "   - Se devuelven primero los restaurantes que contienen literalmente la palabra buscada en su texto (`texto_combinado`) **y** cumplen los filtros activos (`flag_*` o `subcat_*`).  \n",
    "\n",
    "2. **Solo flags/subcategor√≠as**  \n",
    "   - Si no se llena el `top_n`, se a√±aden restaurantes que cumplen los filtros activos aunque no mencionen la palabra exacta.  \n",
    "\n",
    "3. **Coincidencia exacta en texto (sin filtros)**  \n",
    "   - Si a√∫n faltan resultados, se incluyen los que contienen la palabra en `texto_combinado` aunque no tengan flag/subcategor√≠a activo.  \n",
    "\n",
    "4. **B√∫squeda sem√°ntica h√≠brida**  \n",
    "   - Como √∫ltimo recurso se completa la lista con la b√∫squeda h√≠brida TF-IDF + SBERT, que captura sin√≥nimos y expresiones similares.  \n",
    "\n",
    "De esta manera se garantiza que los resultados m√°s relevantes para el usuario aparecen al principio, y solo si no hay suficientes se ampl√≠a el abanico hacia coincidencias m√°s difusas.\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "a1nbYrIFlFqW"
   },
   "outputs": [],
   "source": [
    "def buscar_prioritario(query, flags=None, top_n=20, df_base=None):\n",
    "    \"\"\"\n",
    "    B√∫squeda jer√°rquica prioritaria dentro del DataFrame indicado (df_base).\n",
    "    Si no se pasa, usa el DataFrame global df.\n",
    "    \"\"\"\n",
    "    if df_base is None:\n",
    "        df_base = df  # fallback al global si no se pasa nada\n",
    "\n",
    "    resultados = pd.DataFrame()\n",
    "    faltan = top_n\n",
    "\n",
    "    # --- Separar flags y subcategor√≠as ---\n",
    "    subcats = [f for f in flags if f.startswith(\"subcat_\")] if flags else []\n",
    "    main_flags = [f for f in flags if f.startswith(\"flag_\")] if flags else []\n",
    "\n",
    "    # --- Nivel 1: Coincidencia exacta en texto + flags/subcats ---\n",
    "    if query.strip() and (main_flags or subcats):\n",
    "        subset = df_base.copy()\n",
    "        for f in main_flags + subcats:\n",
    "            if f in subset.columns:\n",
    "                subset = subset[subset[f] == 1]\n",
    "        patron = rf\"\\b{query.rstrip('s')}\\w*\\b\"\n",
    "        subset = subset[subset[\"texto_combinado\"].astype(str).str.contains(\n",
    "            patron, case=False, na=False, regex=True\n",
    "        )]\n",
    "        if not subset.empty:\n",
    "            subset[\"criterio\"] = f\"üìå Coincidencia exacta en texto ('{query}') + {' + '.join(main_flags + subcats)}\"\n",
    "            resultados = pd.concat([resultados, subset])\n",
    "        resultados = limpiar_duplicados(resultados)\n",
    "        faltan = top_n - len(resultados)\n",
    "\n",
    "    # --- Nivel 2: Coincidencia por flags/subcats (sin texto) ---\n",
    "    if faltan > 0 and (main_flags or subcats):\n",
    "        subset = df_base.copy()\n",
    "        for f in main_flags + subcats:\n",
    "            if f in subset.columns:\n",
    "                subset = subset[subset[f] == 1]\n",
    "        if not subset.empty:\n",
    "            subset[\"criterio\"] = f\"üìå Coincide con {' + '.join(main_flags + subcats)}\"\n",
    "            resultados = pd.concat([resultados, subset])\n",
    "        resultados = limpiar_duplicados(resultados)\n",
    "        faltan = top_n - len(resultados)\n",
    "\n",
    "    # --- Nivel 3: Coincidencia exacta solo en texto ---\n",
    "    if faltan > 0 and query.strip():\n",
    "        patron = rf\"\\b{query.rstrip('s')}\\w*\\b\"\n",
    "        subset = df_base[df_base[\"texto_combinado\"].astype(str).str.contains(\n",
    "            patron, case=False, na=False, regex=True\n",
    "        )].copy()\n",
    "        if not subset.empty:\n",
    "            subset[\"criterio\"] = f\"üîé Coincidencia exacta en texto ('{query}')\"\n",
    "            resultados = pd.concat([resultados, subset])\n",
    "        resultados = limpiar_duplicados(resultados)\n",
    "        faltan = top_n - len(resultados)\n",
    "\n",
    "    # --- Nivel 4: B√∫squeda sem√°ntica h√≠brida ---\n",
    "    if faltan > 0 and query.strip():\n",
    "        semanticos = buscar_hibrido(query, top_n=faltan, df_base=df_base, ciudad=None).copy()\n",
    "        semanticos[\"criterio\"] = f\"‚ú® B√∫squeda sem√°ntica h√≠brida ('{query}')\"\n",
    "        resultados = pd.concat([resultados, semanticos])\n",
    "        resultados = limpiar_duplicados(resultados)\n",
    "\n",
    "    # --- Asignar prioridad √∫nica ---\n",
    "    resultados[\"criterio_orden\"] = resultados[\"criterio\"].apply(asignar_prioridad)\n",
    "\n",
    "    # --- Ordenar jer√°rquicamente ---\n",
    "    resultados = resultados.sort_values(\n",
    "        by=[\"criterio_orden\", \"rating_final\", \"reviews_final\"],\n",
    "        ascending=[True, False, False],\n",
    "        kind=\"mergesort\"\n",
    "    )\n",
    "\n",
    "    return seleccionar_columnas(resultados)\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "0OAEZLNinTyC"
   },
   "source": [
    "## B√∫squeda √∫nica por flags/subcategor√≠as\n",
    "\n",
    "Adem√°s de la b√∫squeda por texto o proximidad, el sistema permite filtrar restaurantes por categor√≠as:\n",
    "\n",
    "1. **Flags (`flag_*`)**  \n",
    "   Variables binarias que representan las categor√≠as principales:  \n",
    "   - `flag_pizza`  \n",
    "   - `flag_hamburguesas`  \n",
    "   - `flag_veggie`  \n",
    "   - `flag_mexicana`, etc.  \n",
    "\n",
    "2. **Subcategor√≠as (`subcat_*`)**  \n",
    "   Algunas categor√≠as maestras tienen subdivisiones m√°s espec√≠ficas, por ejemplo:  \n",
    "   - `subcat_espa√±ola_tapas`  \n",
    "   - `subcat_espa√±ola_pulpo`  \n",
    "   - `subcat_latina_peruana`  \n",
    "   - `subcat_veggie_sin_gluten`  \n",
    "\n",
    "### L√≥gica de filtrado\n",
    "- Los filtros se aplican en **modo AND**: si se seleccionan varias categor√≠as/subcategor√≠as, el restaurante debe cumplirlas todas.    \n",
    "- Si no se selecciona ning√∫n flag ni subcategor√≠a, esta capa no elimina resultados.  \n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "LpgPqR41349M"
   },
   "outputs": [],
   "source": [
    "def filtrar_flags(df, flags_activos=None, top_n=50):\n",
    "    \"\"\"Filtra el DataFrame por flags y subcategor√≠as (modo AND).\"\"\"\n",
    "    df_filtrado = df.copy()\n",
    "    resultados = pd.DataFrame()\n",
    "\n",
    "    # --- Separar flags principales y subcategor√≠as ---\n",
    "    subcats = [f for f in flags_activos if f.startswith(\"subcat_\")] if flags_activos else []\n",
    "    main_flags = [f for f in flags_activos if f.startswith(\"flag_\")] if flags_activos else []\n",
    "\n",
    "    # --- Aplicar flags/subcats (modo AND) ---\n",
    "    if main_flags or subcats:\n",
    "        for f in main_flags + subcats:\n",
    "            if f in df_filtrado.columns:\n",
    "                df_filtrado = df_filtrado[df_filtrado[f] == 1]\n",
    "        if not df_filtrado.empty:\n",
    "            df_filtrado[\"criterio\"] = \"üìå Coincide con \" + \" + \".join(main_flags + subcats)\n",
    "            resultados = pd.concat([resultados, df_filtrado])\n",
    "\n",
    "    # --- Si no hay coincidencias ---\n",
    "    if resultados.empty:\n",
    "        resultados[\"criterio\"] = \"‚ùå Sin resultados\"\n",
    "\n",
    "    resultados = limpiar_duplicados(resultados)\n",
    "\n",
    "    # --- Asignar prioridad coherente ---\n",
    "    resultados[\"criterio_orden\"] = resultados[\"criterio\"].apply(asignar_prioridad)\n",
    "\n",
    "    # --- Ordenar estable ---\n",
    "    resultados = resultados.sort_values(\n",
    "        by=[\"criterio_orden\", \"rating_final\", \"reviews_final\"],\n",
    "        ascending=[True, False, False],\n",
    "        kind=\"mergesort\"\n",
    "    )\n",
    "\n",
    "    return seleccionar_columnas(resultados).head(top_n)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "tFsg6FUM0esW"
   },
   "source": [
    "## Funci√≥n unificada de b√∫squeda + filtrado\n",
    "\n",
    "Inicialmente se usaban dos funciones distintas:\n",
    "\n",
    "- **`buscar_prioritario`** ‚Üí cuando el usuario introduc√≠a una *query* de texto libre.  \n",
    "- **`filtrar_flags`** ‚Üí cuando el usuario solo seleccionaba *flags* o *subcategor√≠as*.  \n",
    "\n",
    "Para simplificar el flujo se crea una funci√≥n √∫nica **`buscar_y_filtrar`** que unifica ambas:\n",
    "\n",
    "1. Si el usuario introduce una **query** ‚Üí se ejecuta la l√≥gica de `buscar_prioritario` (con un pre-top de 500 resultados).  \n",
    "2. Si no hay query ‚Üí se ejecuta la l√≥gica de `filtrar_flags`.  \n",
    "3. En ambos casos se aplican filtros adicionales de **ciudad**, **precio m√°ximo** (`price_num`) y **rating m√≠nimo** (`rating_final`).  \n",
    "4. Finalmente se devuelven los resultados ordenados y limitados al `top_n` solicitado.  \n",
    "\n",
    "De esta forma, el asistente solo necesita invocar **una funci√≥n central** para obtener resultados consistentes, independientemente de si la b√∫squeda se hace por texto libre o solo por categor√≠as.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "uykK8wS84DIh"
   },
   "outputs": [],
   "source": [
    "def buscar_y_filtrar(query=\"\", flags=None, ciudad=None, precio_max=None, rating_min=None, top_n=20):\n",
    "    \"\"\"\n",
    "    Unifica b√∫squeda textual y filtrado por flags/subcategor√≠as,\n",
    "    aplicando primero los filtros globales (ciudad, precio, rating)\n",
    "    y luego la b√∫squeda jer√°rquica dentro del subconjunto filtrado.\n",
    "    \"\"\"\n",
    "\n",
    "    df_filtrado = df.copy()\n",
    "\n",
    "    # --- Filtros previos: ciudad, precio, rating ---\n",
    "    if ciudad:\n",
    "        ciudad_norm = quitar_acentos(ciudad.lower().strip())\n",
    "        df_filtrado = df_filtrado[\n",
    "            df_filtrado[\"ciudad\"].str.lower().str.strip().apply(quitar_acentos) == ciudad_norm\n",
    "        ]\n",
    "\n",
    "    if precio_max is not None:\n",
    "        df_filtrado = df_filtrado[\n",
    "            (df_filtrado[\"price_num\"].isna()) | (df_filtrado[\"price_num\"] <= precio_max)\n",
    "        ]\n",
    "\n",
    "    if rating_min is not None:\n",
    "        df_filtrado = df_filtrado[df_filtrado[\"rating_final\"] >= rating_min]\n",
    "\n",
    "    # --- Si tras los filtros no queda nada, salir ---\n",
    "    if df_filtrado.empty:\n",
    "        return pd.DataFrame()\n",
    "\n",
    "    # --- B√∫squeda prioritaria dentro del subconjunto filtrado ---\n",
    "    if query.strip():\n",
    "        resultados = buscar_prioritario(query, flags=flags, top_n=40, df_base=df_filtrado)\n",
    "    else:\n",
    "        resultados = filtrar_flags(df_filtrado, flags_activos=flags, top_n=40)\n",
    "\n",
    "    # --- Orden final coherente y truncado ---\n",
    "    if not resultados.empty:\n",
    "        resultados = resultados.sort_values(\n",
    "            by=[\"criterio_orden\", \"rating_final\", \"reviews_final\"],\n",
    "            ascending=[True, False, False],\n",
    "            kind=\"mergesort\"\n",
    "        )\n",
    "\n",
    "    return resultados.head(top_n)\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "Pkm-XcGyYosQ"
   },
   "source": [
    "## Filtro por proximidad con OpenRouteService\n",
    "\n",
    "Adem√°s de los filtros por texto y categor√≠as, el sistema permite restringir los resultados a restaurantes **cercanos a la ubicaci√≥n del usuario**.\n",
    "\n",
    "En lugar de calcular solo la distancia en l√≠nea recta (*Haversine*), utilizamos la API de **OpenRouteService (ORS)**, que devuelve la **distancia real** y el **tiempo estimado de trayecto** en distintos modos de transporte (*coche, andando, bici, etc.*).\n",
    "\n",
    "### Ventajas\n",
    "- Distancia real seg√∫n la red de carreteras o caminos.  \n",
    "- Tiempo estimado de trayecto en minutos.  \n",
    "- Geocodificaci√≥n de direcciones ‚Üí conversi√≥n a coordenadas (lat, lon).  \n",
    "\n",
    "### Flujo de c√°lculo\n",
    "1. Si el usuario proporciona una direcci√≥n ‚Üí se convierte en coordenadas con ORS.  \n",
    "2. Se hace un **prefiltrado r√°pido** con Haversine para descartar restaurantes demasiado lejanos.  \n",
    "3. Para los candidatos cercanos se consulta ORS ‚Üí obteniendo distancia real y tiempo de trayecto.  \n",
    "4. Se ordenan los resultados por proximidad o se filtran por radio/tiempo m√°ximo.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "executionInfo": {
     "elapsed": 11023,
     "status": "ok",
     "timestamp": 1763222252548,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "VYp4_UhkZxYV",
    "outputId": "67ccace7-8303-47d9-9ab9-c7b8653b1bdd"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting openrouteservice\n",
      "  Downloading openrouteservice-2.3.3-py3-none-any.whl.metadata (9.2 kB)\n",
      "Requirement already satisfied: requests>=2.0 in /usr/local/lib/python3.12/dist-packages (from openrouteservice) (2.32.4)\n",
      "Requirement already satisfied: charset_normalizer<4,>=2 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0->openrouteservice) (3.4.4)\n",
      "Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0->openrouteservice) (3.11)\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0->openrouteservice) (2.5.0)\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0->openrouteservice) (2025.10.5)\n",
      "Downloading openrouteservice-2.3.3-py3-none-any.whl (33 kB)\n",
      "Installing collected packages: openrouteservice\n",
      "Successfully installed openrouteservice-2.3.3\n"
     ]
    }
   ],
   "source": [
    "!pip install openrouteservice"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 224
    },
    "executionInfo": {
     "elapsed": 27099,
     "status": "ok",
     "timestamp": 1763222279648,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "fZWNnGXgZmPA",
    "outputId": "1088281d-92ee-4464-84bc-253262827001"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üìç Coordenadas usuario: 42.426576 -8.640552\n"
     ]
    },
    {
     "data": {
      "application/vnd.google.colaboratory.intrinsic+json": {
       "summary": "{\n  \"name\": \"filtrar_proximidad_hibrido(lat_user, lon_user, radio_km=3, modo=\\\"driving-car\\\", top_n=5)\",\n  \"rows\": 5,\n  \"fields\": [\n    {\n      \"column\": \"nombre_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"Pizzer\\u00eda Carlos Pontevedra\",\n          \"Casa Rom\\u00e1n - Pontevedra\",\n          \"Sibuya Urban Sushi Bar\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ciudad\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"pontevedra\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"distancia_km\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.17431144540735133,\n        \"min\": 0.9368,\n        \"max\": 1.3599,\n        \"num_unique_values\": 4,\n        \"samples\": [\n          1.175\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"tiempo_min\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 0.634812527006552,\n        \"min\": 3.185,\n        \"max\": 4.703333333333333,\n        \"num_unique_values\": 4,\n        \"samples\": [\n          3.881666666666667\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"maps_url_final\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"https://maps.google.com/?cid=18055858016742034430&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}",
       "type": "dataframe"
      },
      "text/html": [
       "\n",
       "  <div id=\"df-74410651-35c1-44fb-a493-489063dcc2c5\" class=\"colab-df-container\">\n",
       "    <div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>nombre_final</th>\n",
       "      <th>ciudad</th>\n",
       "      <th>distancia_km</th>\n",
       "      <th>tiempo_min</th>\n",
       "      <th>maps_url_final</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Il Piccolo</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>0.9368</td>\n",
       "      <td>3.185000</td>\n",
       "      <td>https://maps.google.com/?cid=12637090998901812...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>Pizzer√≠a Carlos Pontevedra</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>1.1750</td>\n",
       "      <td>3.881667</td>\n",
       "      <td>https://maps.google.com/?cid=18055858016742034...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>Sibuya Urban Sushi Bar</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>1.3194</td>\n",
       "      <td>4.703333</td>\n",
       "      <td>https://maps.google.com/?cid=10307487329597763...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Vi√±oteca Bagos</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>1.3194</td>\n",
       "      <td>4.703333</td>\n",
       "      <td>https://maps.google.com/?cid=53343118250615916...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Casa Rom√°n - Pontevedra</td>\n",
       "      <td>pontevedra</td>\n",
       "      <td>1.3599</td>\n",
       "      <td>4.140000</td>\n",
       "      <td>https://maps.google.com/?cid=11676743898097058...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>\n",
       "    <div class=\"colab-df-buttons\">\n",
       "\n",
       "  <div class=\"colab-df-container\">\n",
       "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-74410651-35c1-44fb-a493-489063dcc2c5')\"\n",
       "            title=\"Convert this dataframe to an interactive table.\"\n",
       "            style=\"display:none;\">\n",
       "\n",
       "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
       "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
       "  </svg>\n",
       "    </button>\n",
       "\n",
       "  <style>\n",
       "    .colab-df-container {\n",
       "      display:flex;\n",
       "      gap: 12px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert {\n",
       "      background-color: #E8F0FE;\n",
       "      border: none;\n",
       "      border-radius: 50%;\n",
       "      cursor: pointer;\n",
       "      display: none;\n",
       "      fill: #1967D2;\n",
       "      height: 32px;\n",
       "      padding: 0 0 0 0;\n",
       "      width: 32px;\n",
       "    }\n",
       "\n",
       "    .colab-df-convert:hover {\n",
       "      background-color: #E2EBFA;\n",
       "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "      fill: #174EA6;\n",
       "    }\n",
       "\n",
       "    .colab-df-buttons div {\n",
       "      margin-bottom: 4px;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert {\n",
       "      background-color: #3B4455;\n",
       "      fill: #D2E3FC;\n",
       "    }\n",
       "\n",
       "    [theme=dark] .colab-df-convert:hover {\n",
       "      background-color: #434B5C;\n",
       "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
       "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
       "      fill: #FFFFFF;\n",
       "    }\n",
       "  </style>\n",
       "\n",
       "    <script>\n",
       "      const buttonEl =\n",
       "        document.querySelector('#df-74410651-35c1-44fb-a493-489063dcc2c5 button.colab-df-convert');\n",
       "      buttonEl.style.display =\n",
       "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "\n",
       "      async function convertToInteractive(key) {\n",
       "        const element = document.querySelector('#df-74410651-35c1-44fb-a493-489063dcc2c5');\n",
       "        const dataTable =\n",
       "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
       "                                                    [key], {});\n",
       "        if (!dataTable) return;\n",
       "\n",
       "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
       "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
       "          + ' to learn more about interactive tables.';\n",
       "        element.innerHTML = '';\n",
       "        dataTable['output_type'] = 'display_data';\n",
       "        await google.colab.output.renderOutput(dataTable, element);\n",
       "        const docLink = document.createElement('div');\n",
       "        docLink.innerHTML = docLinkHtml;\n",
       "        element.appendChild(docLink);\n",
       "      }\n",
       "    </script>\n",
       "  </div>\n",
       "\n",
       "\n",
       "    <div id=\"df-fca11be5-592c-41c4-8a22-b3303e5d5caa\">\n",
       "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-fca11be5-592c-41c4-8a22-b3303e5d5caa')\"\n",
       "                title=\"Suggest charts\"\n",
       "                style=\"display:none;\">\n",
       "\n",
       "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
       "     width=\"24px\">\n",
       "    <g>\n",
       "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
       "    </g>\n",
       "</svg>\n",
       "      </button>\n",
       "\n",
       "<style>\n",
       "  .colab-df-quickchart {\n",
       "      --bg-color: #E8F0FE;\n",
       "      --fill-color: #1967D2;\n",
       "      --hover-bg-color: #E2EBFA;\n",
       "      --hover-fill-color: #174EA6;\n",
       "      --disabled-fill-color: #AAA;\n",
       "      --disabled-bg-color: #DDD;\n",
       "  }\n",
       "\n",
       "  [theme=dark] .colab-df-quickchart {\n",
       "      --bg-color: #3B4455;\n",
       "      --fill-color: #D2E3FC;\n",
       "      --hover-bg-color: #434B5C;\n",
       "      --hover-fill-color: #FFFFFF;\n",
       "      --disabled-bg-color: #3B4455;\n",
       "      --disabled-fill-color: #666;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart {\n",
       "    background-color: var(--bg-color);\n",
       "    border: none;\n",
       "    border-radius: 50%;\n",
       "    cursor: pointer;\n",
       "    display: none;\n",
       "    fill: var(--fill-color);\n",
       "    height: 32px;\n",
       "    padding: 0;\n",
       "    width: 32px;\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart:hover {\n",
       "    background-color: var(--hover-bg-color);\n",
       "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
       "    fill: var(--button-hover-fill-color);\n",
       "  }\n",
       "\n",
       "  .colab-df-quickchart-complete:disabled,\n",
       "  .colab-df-quickchart-complete:disabled:hover {\n",
       "    background-color: var(--disabled-bg-color);\n",
       "    fill: var(--disabled-fill-color);\n",
       "    box-shadow: none;\n",
       "  }\n",
       "\n",
       "  .colab-df-spinner {\n",
       "    border: 2px solid var(--fill-color);\n",
       "    border-color: transparent;\n",
       "    border-bottom-color: var(--fill-color);\n",
       "    animation:\n",
       "      spin 1s steps(1) infinite;\n",
       "  }\n",
       "\n",
       "  @keyframes spin {\n",
       "    0% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "      border-left-color: var(--fill-color);\n",
       "    }\n",
       "    20% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    30% {\n",
       "      border-color: transparent;\n",
       "      border-left-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    40% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-top-color: var(--fill-color);\n",
       "    }\n",
       "    60% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "    }\n",
       "    80% {\n",
       "      border-color: transparent;\n",
       "      border-right-color: var(--fill-color);\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "    90% {\n",
       "      border-color: transparent;\n",
       "      border-bottom-color: var(--fill-color);\n",
       "    }\n",
       "  }\n",
       "</style>\n",
       "\n",
       "      <script>\n",
       "        async function quickchart(key) {\n",
       "          const quickchartButtonEl =\n",
       "            document.querySelector('#' + key + ' button');\n",
       "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
       "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
       "          try {\n",
       "            const charts = await google.colab.kernel.invokeFunction(\n",
       "                'suggestCharts', [key], {});\n",
       "          } catch (error) {\n",
       "            console.error('Error during call to suggestCharts:', error);\n",
       "          }\n",
       "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
       "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
       "        }\n",
       "        (() => {\n",
       "          let quickchartButtonEl =\n",
       "            document.querySelector('#df-fca11be5-592c-41c4-8a22-b3303e5d5caa button');\n",
       "          quickchartButtonEl.style.display =\n",
       "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
       "        })();\n",
       "      </script>\n",
       "    </div>\n",
       "\n",
       "    </div>\n",
       "  </div>\n"
      ],
      "text/plain": [
       "                  nombre_final      ciudad  distancia_km  tiempo_min  \\\n",
       "2                   Il Piccolo  pontevedra        0.9368    3.185000   \n",
       "12  Pizzer√≠a Carlos Pontevedra  pontevedra        1.1750    3.881667   \n",
       "11      Sibuya Urban Sushi Bar  pontevedra        1.3194    4.703333   \n",
       "7               Vi√±oteca Bagos  pontevedra        1.3194    4.703333   \n",
       "8      Casa Rom√°n - Pontevedra  pontevedra        1.3599    4.140000   \n",
       "\n",
       "                                       maps_url_final  \n",
       "2   https://maps.google.com/?cid=12637090998901812...  \n",
       "12  https://maps.google.com/?cid=18055858016742034...  \n",
       "11  https://maps.google.com/?cid=10307487329597763...  \n",
       "7   https://maps.google.com/?cid=53343118250615916...  \n",
       "8   https://maps.google.com/?cid=11676743898097058...  "
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# --- Paso 3: Proximidad geogr√°fica con OpenRouteService ---\n",
    "\n",
    "import openrouteservice\n",
    "from openrouteservice import convert\n",
    "\n",
    "# ‚ö†Ô∏è Necesitas tu propia API KEY de ORS\n",
    "api_key = \"eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImFmNmI5ZmEwNzQ2YjRmNWY4MjgyMDRlZDlhYzIwNDdlIiwiaCI6Im11cm11cjY0In0=\"\n",
    "client = openrouteservice.Client(key=api_key)\n",
    "\n",
    "# --- Funci√≥n: geocodificar direcci√≥n a coordenadas ---\n",
    "def direccion_a_coordenadas(direccion, solo_espana=True):\n",
    "    \"\"\"\n",
    "    Devuelve las coordenadas (lat, lon) de una direcci√≥n mediante ORS Pelias.\n",
    "    Si solo_espana=True, limita la b√∫squeda al territorio espa√±ol\n",
    "    (previene falsos positivos en direcciones hom√≥nimas).\n",
    "    \"\"\"\n",
    "    try:\n",
    "        extra = {}\n",
    "        if solo_espana:\n",
    "            extra = {\n",
    "                \"boundary.country\": \"ES\",\n",
    "                \"boundary.rect.min_lon\": -9.30,  # l√≠mite oeste\n",
    "                \"boundary.rect.min_lat\": 41.80,  # l√≠mite sur\n",
    "                \"boundary.rect.max_lon\": -6.50,  # l√≠mite este\n",
    "                \"boundary.rect.max_lat\": 43.80   # l√≠mite norte\n",
    "            }\n",
    "\n",
    "        geocode = client.pelias_search(direccion, extra_params=extra)\n",
    "        if geocode and \"features\" in geocode and geocode[\"features\"]:\n",
    "            coords = geocode[\"features\"][0][\"geometry\"][\"coordinates\"]  # [lon, lat]\n",
    "            return coords[1], coords[0]  # devolver (lat, lon)\n",
    "        else:\n",
    "            print(f\"‚ö†Ô∏è No se encontraron coordenadas para '{direccion}'\")\n",
    "    except Exception as e:\n",
    "        print(f\"‚ö†Ô∏è Error geocodificando '{direccion}': {e}\")\n",
    "    return None, None\n",
    "\n",
    "\n",
    "# --- Funci√≥n: calcular distancia real entre 2 puntos ---\n",
    "def distancia_real(lat1, lon1, lat2, lon2, modo=\"driving-car\"):\n",
    "    try:\n",
    "        coords = [(lon1, lat1), (lon2, lat2)]  # ORS usa (lon, lat)\n",
    "        ruta = client.directions(coords, profile=modo, format=\"geojson\")\n",
    "        dist_m = ruta[\"features\"][0][\"properties\"][\"segments\"][0][\"distance\"]\n",
    "        dur_s = ruta[\"features\"][0][\"properties\"][\"segments\"][0][\"duration\"]\n",
    "        return dist_m/1000, dur_s/60  # km y minutos\n",
    "    except Exception as e:\n",
    "        print(f\"‚ö†Ô∏è Error en distancia_real con modo {modo}: {e}\")\n",
    "        return None, None\n",
    "\n",
    "\n",
    "from math import radians, sin, cos, sqrt, atan2\n",
    "import time\n",
    "\n",
    "# --- Funci√≥n Haversine (distancia en l√≠nea recta en km) ---\n",
    "def haversine(lat1, lon1, lat2, lon2):\n",
    "    R = 6371  # radio de la tierra en km\n",
    "    dlat = radians(lat2 - lat1)\n",
    "    dlon = radians(lon2 - lon1)\n",
    "    a = sin(dlat/2)**2 + cos(radians(lat1)) * cos(radians(lat2)) * sin(dlon/2)**2\n",
    "    c = 2 * atan2(sqrt(a), sqrt(1-a))\n",
    "    return R * c\n",
    "\n",
    "def filtrar_proximidad_hibrido(lat, lon, radio_km=5, top_n=5, modo=\"driving-car\"):\n",
    "    # 1. Preselecci√≥n con Haversine (r√°pido, sin API)\n",
    "    distancias = df.apply(\n",
    "        lambda row: haversine(lat, lon, row[\"latitude\"], row[\"longitude\"]), axis=1\n",
    "    )\n",
    "    df_temp = df.copy()\n",
    "    df_temp[\"distancia_haversine\"] = distancias\n",
    "    candidatos = df_temp[df_temp[\"distancia_haversine\"] <= radio_km].head(20)\n",
    "\n",
    "    # 2. Calcular distancia real solo para esos candidatos\n",
    "    resultados = []\n",
    "    for i, row in candidatos.iterrows():\n",
    "        try:\n",
    "            d_km, d_min = distancia_real(lat, lon, row[\"latitude\"], row[\"longitude\"], modo=modo)\n",
    "            resultados.append((row[\"nombre_final\"], row[\"ciudad\"], d_km, d_min, row[\"maps_url_final\"]))\n",
    "            time.sleep(1)  # evitar saturar API\n",
    "        except:\n",
    "            pass\n",
    "\n",
    "    # 3. Ordenar por distancia real\n",
    "    df_res = pd.DataFrame(resultados, columns=[\"nombre_final\", \"ciudad\", \"distancia_km\", \"tiempo_min\", \"maps_url_final\"])\n",
    "    return df_res.sort_values(\"distancia_km\").head(top_n)\n",
    "\n",
    "# --- Completar coordenadas faltantes a partir de address_norm ---\n",
    "def rellenar_coordenadas(df):\n",
    "    for i, row in df.iterrows():\n",
    "        if pd.isna(row[\"latitude\"]) or pd.isna(row[\"longitude\"]):\n",
    "            if \"address_norm\" in row and pd.notna(row[\"address_norm\"]):\n",
    "                lat, lon = direccion_a_coordenadas(row[\"address_norm\"])\n",
    "                if lat and lon:\n",
    "                    df.at[i, \"latitude\"] = lat\n",
    "                    df.at[i, \"longitude\"] = lon\n",
    "                    print(f\"‚úÖ Coordenadas obtenidas para {row['nombre_final']}: {lat:.5f}, {lon:.5f}\")\n",
    "                else:\n",
    "                    print(f\"‚ö†Ô∏è No se pudo geocodificar la direcci√≥n de {row['nombre_final']}\")\n",
    "    return df\n",
    "\n",
    "# --- Ejemplo de uso ---\n",
    "# Direcci√≥n inicial ‚Üí centro de Pontevedra\n",
    "lat_user, lon_user = direccion_a_coordenadas(\"Praza da Ferrer√≠a, Pontevedra, Espa√±a\")\n",
    "print(\"üìç Coordenadas usuario:\", lat_user, lon_user)\n",
    "\n",
    "# Restaurantes en un radio de 3 km en coche\n",
    "filtrar_proximidad_hibrido(lat_user, lon_user, radio_km=3, modo=\"driving-car\", top_n=5)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "boXwXuvLbheF"
   },
   "source": [
    "## Filtro por disponibilidad horaria\n",
    "\n",
    "Adem√°s de los filtros por categor√≠as o proximidad, el sistema permite comprobar si un restaurante est√° **abierto** en un momento concreto.  \n",
    "\n",
    "El dataset incluye un campo `horarios_norm` con los horarios en formato string (a veces con guiones largos `‚Äì` o cierres en `24:00`).  \n",
    "Para poder filtrarlos correctamente se siguen estos pasos:\n",
    "\n",
    "1. **Conversi√≥n a lista**  \n",
    "   - El string se convierte a una lista real mediante `ast.literal_eval`.  \n",
    "\n",
    "2. **Normalizaci√≥n**  \n",
    "   - Se sustituyen guiones largos `‚Äì` por guiones normales `-`.  \n",
    "   - Se cambia `24:00` por `23:59` (para que Python lo acepte como hora v√°lida).  \n",
    "\n",
    "3. **Parseo y comparaci√≥n**  \n",
    "   - Se parsean los intervalos horarios con `datetime.strptime`.  \n",
    "   - Se comprueba si la hora actual (o la especificada por el usuario) cae dentro de alguno de los rangos.  \n",
    "   - Se contemplan casos especiales:\n",
    "     - *‚Äúcerrado‚Äù* ‚Üí se devuelve como cerrado.  \n",
    "     - *‚Äúabierto 24 horas‚Äù* ‚Üí se devuelve como abierto.  \n",
    "     - *‚Äúhorario no disponible‚Äù* ‚Üí se devuelve como abierto.  \n",
    "     - Rango que cruza medianoche (ej: 20:00‚Äì02:00) ‚Üí se considera abierto si la hora cae antes del cierre o despu√©s de la apertura.\n",
    "\n",
    "De esta manera es posible filtrar resultados y mostrar √∫nicamente restaurantes que est√©n abiertos en el d√≠a y hora solicitados.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "d2fJ9b-VbwiB"
   },
   "outputs": [],
   "source": [
    "import ast\n",
    "from datetime import datetime, time\n",
    "import unicodedata\n",
    "\n",
    "def quitar_acentos(txt):\n",
    "    return \"\".join(\n",
    "        c for c in unicodedata.normalize(\"NFD\", txt)\n",
    "        if unicodedata.category(c) != \"Mn\"\n",
    "    )\n",
    "\n",
    "def parse_horarios(val):\n",
    "    \"\"\"Convierte string/lista de horarios a lista normalizada.\"\"\"\n",
    "    if val is None or (isinstance(val, str) and val.strip() == \"\"):\n",
    "        return []\n",
    "    if isinstance(val, list):\n",
    "        return val\n",
    "    if isinstance(val, str):\n",
    "        if val.strip().startswith(\"[\") and val.strip().endswith(\"]\"):\n",
    "            try:\n",
    "                return ast.literal_eval(val)\n",
    "            except:\n",
    "                return []\n",
    "        else:\n",
    "            return [val]\n",
    "    return []\n",
    "\n",
    "def esta_abierto(horarios, fecha_hora=None):\n",
    "    if fecha_hora is None:\n",
    "        fecha_hora = datetime.now()\n",
    "\n",
    "    dias = [\"lunes\",\"martes\",\"miercoles\",\"jueves\",\"viernes\",\"sabado\",\"domingo\"]\n",
    "    dia_actual = dias[fecha_hora.weekday()]\n",
    "    hora_actual = fecha_hora.time()\n",
    "\n",
    "    if not horarios:\n",
    "        return True  # si no hay horarios, asumimos abierto\n",
    "\n",
    "    # Si todos son \"horario no disponible\", tambi√©n asumimos abierto\n",
    "    if all(\"horario no disponible\" in quitar_acentos(h.lower()) for h in horarios):\n",
    "        return True\n",
    "\n",
    "    for h in horarios:\n",
    "        h_norm = quitar_acentos(h.lower().strip())\n",
    "\n",
    "        # D√≠a correcto\n",
    "        if h_norm.startswith(dia_actual):\n",
    "            if \"cerrado\" in h_norm:\n",
    "                return False\n",
    "            if \"abierto 24 horas\" in h_norm:\n",
    "                return True\n",
    "            if \"horario no disponible\" in h_norm:\n",
    "                continue\n",
    "\n",
    "            try:\n",
    "                _, horario_str = h.split(\":\", 1)\n",
    "            except ValueError:\n",
    "                continue\n",
    "\n",
    "            # Normalizar\n",
    "            horario_str = horario_str.replace(\"‚Äì\", \"-\").replace(\" \", \"\")\n",
    "            rangos = horario_str.split(\",\")\n",
    "\n",
    "            for r in rangos:\n",
    "                if \"-\" not in r:\n",
    "                    continue\n",
    "                ini, fin = r.split(\"-\")\n",
    "                ini, fin = ini.strip(), fin.strip()\n",
    "\n",
    "                # Casos especiales\n",
    "                if fin in [\"24:00\",\"00:00\",\"0:00\"]:\n",
    "                    fin = \"23:59\"\n",
    "\n",
    "                # Asegurar formato hh:mm\n",
    "                if len(ini) == 4: ini = \"0\" + ini\n",
    "                if len(fin) == 4: fin = \"0\" + fin\n",
    "\n",
    "                try:\n",
    "                    t_ini = datetime.strptime(ini, \"%H:%M\").time()\n",
    "                    t_fin = datetime.strptime(fin, \"%H:%M\").time()\n",
    "\n",
    "                    if t_ini <= t_fin:\n",
    "                        if t_ini <= hora_actual <= t_fin:\n",
    "                            return True\n",
    "                    else:  # cruza medianoche\n",
    "                        if hora_actual >= t_ini or hora_actual <= t_fin:\n",
    "                            return True\n",
    "                except Exception as e:\n",
    "                    print(\"‚ö†Ô∏è Error parseando:\", r, \"->\", e)\n",
    "    return False\n",
    "\n",
    "\n",
    "\n",
    "# --- Paso 3: funci√≥n de filtrado ---\n",
    "def filtrar_abiertos(df, fecha_hora=None):\n",
    "    return df[df[\"horarios_lista\"].apply(lambda x: esta_abierto(x, fecha_hora))]\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "executionInfo": {
     "elapsed": 20,
     "status": "ok",
     "timestamp": 1761646907652,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "gbyOoWPceWIK",
    "outputId": "eb87f0d4-a56b-4147-a7d2-b34e8460a3cb"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚û°Ô∏è Restaurante: A Noiesa Casa de Comidas\n",
      "‚û°Ô∏è Horarios: ['lunes: 13:00‚Äì17:00, 20:00‚Äì24:00', 'martes: 13:00‚Äì17:00, 20:00‚Äì24:00', 'mi√©rcoles: 13:00‚Äì17:00, 20:00‚Äì24:00', 'jueves: 13:00‚Äì17:00, 20:00‚Äì24:00', 'viernes: 13:00‚Äì17:00, 20:00‚Äì24:00', 's√°bado: 13:00‚Äì17:00, 20:00‚Äì24:00', 'domingo: 13:00‚Äì17:00, 20:00‚Äì24:00']\n",
      "‚û°Ô∏è ¬øEst√° abierto mi√©rcoles a las 00:00?: False\n"
     ]
    }
   ],
   "source": [
    "# coger un restaurante al azar que tenga horarios\n",
    "rest = df.iloc[0]\n",
    "print(\"‚û°Ô∏è Restaurante:\", rest[\"nombre_final\"])\n",
    "print(\"‚û°Ô∏è Horarios:\", rest[\"horarios_lista\"])\n",
    "\n",
    "# probar si est√° abierto un viernes a las 22:00\n",
    "fecha_test = datetime.strptime(\"2025-09-10 00:00\", \"%Y-%m-%d %H:%M\")\n",
    "print(\"‚û°Ô∏è ¬øEst√° abierto mi√©rcoles a las 00:00?:\", esta_abierto(rest[\"horarios_lista\"], fecha_hora=fecha_test))\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "4wCE7ENSrOUy"
   },
   "source": [
    "## Funci√≥n integrada de recomendaci√≥n + mapa\n",
    "\n",
    "La l√≥gica completa del recomendador se integra en una √∫nica funci√≥n interactiva **`asistente_recomendador(...)`**, que combina:\n",
    "\n",
    "1. **B√∫squeda sem√°ntica h√≠brida**  \n",
    "   - Se apoya en TF-IDF + SBERT, con la l√≥gica de prioridad (exactitud ‚Üí flags/subcategor√≠as ‚Üí sem√°ntica).  \n",
    "\n",
    "2. **Filtros**  \n",
    "   - Ciudad, flags y subcategor√≠as, precio m√°ximo (`price_num`) y rating m√≠nimo (`rating_final`).  \n",
    "\n",
    "3. **Disponibilidad horaria**  \n",
    "   - Se pueden introducir d√≠a y hora concretos, y solo se muestran restaurantes abiertos en ese momento (considerando tambi√©n casos de *‚Äúhorario no disponible‚Äù* como abiertos).  \n",
    "\n",
    "4. **Proximidad geogr√°fica**  \n",
    "   - Si el usuario introduce una direcci√≥n, se geocodifica con ORS.  \n",
    "   - Se hace un prefiltrado r√°pido con Haversine.  \n",
    "   - Para los candidatos cercanos se calculan distancias y tiempos reales en coche y andando mediante la API de ORS.  \n",
    "   - Opcionalmente los resultados se ordenan por proximidad.  \n",
    "\n",
    "5. **Visualizaci√≥n en mapa**  \n",
    "   - Los resultados se muestran en un **mapa Folium interactivo** con popups informativos:  \n",
    "     - Nombre, ciudad, rating, n¬∫ de rese√±as y precio.  \n",
    "     - Tel√©fono, web, men√∫, reserva online.  \n",
    "     - Indicadores de delivery y reserva.  \n",
    "     - Imagen destacada (si est√° disponible).  \n",
    "   - El mapa incluye una leyenda con iconos diferenciados:  \n",
    "     - üî¥ Usuario  \n",
    "     - ‚≠ê Top 3 restaurantes  \n",
    "     - üç¥ Otros restaurantes  \n",
    "\n",
    "De esta forma, el asistente gu√≠a al usuario en todo el proceso y devuelve resultados filtrados, ordenados y representados en un mapa interactivo.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "twvFZqkn4sR9"
   },
   "outputs": [],
   "source": [
    "import folium\n",
    "from IPython.display import display\n",
    "\n",
    "def mostrar_mapa(resultados, lat_centro=None, lon_centro=None, lat_user=None, lon_user=None):\n",
    "    if resultados.empty:\n",
    "        print(\"‚ùå No hay resultados para mostrar en el mapa.\")\n",
    "        return None\n",
    "\n",
    "    # Usar el primer restaurante como centro si no se pasan coords\n",
    "    if lat_centro is None or lon_centro is None:\n",
    "        if \"latitude\" in resultados.columns and \"longitude\" in resultados.columns:\n",
    "            lat_centro = resultados.iloc[0][\"latitude\"]\n",
    "            lon_centro = resultados.iloc[0][\"longitude\"]\n",
    "        else:\n",
    "            lat_centro, lon_centro = 42.8782, -8.5448  # fallback Galicia\n",
    "\n",
    "    # Crear mapa\n",
    "    mapa = folium.Map(location=[lat_centro, lon_centro], zoom_start=14)\n",
    "\n",
    "    # Pin rojo: ubicaci√≥n del usuario\n",
    "    if lat_user is not None and lon_user is not None:\n",
    "        folium.Marker(\n",
    "            [lat_user, lon_user],\n",
    "            popup=\"üìç Tu ubicaci√≥n\",\n",
    "            icon=folium.Icon(color=\"red\", icon=\"user\", prefix=\"fa\")\n",
    "        ).add_to(mapa)\n",
    "\n",
    "    # Seleccionar top 3 restaurantes\n",
    "    top3_nombres = resultados.head(3)[\"nombre_final\"].tolist()\n",
    "\n",
    "    # A√±adir marcadores de restaurantes\n",
    "    for _, row in resultados.iterrows():\n",
    "        if \"latitude\" in row and \"longitude\" in row and pd.notna(row[\"latitude\"]) and pd.notna(row[\"longitude\"]):\n",
    "            # --- Normalizar precio ---\n",
    "            precio_txt = \"?\" if pd.isna(row[\"price_num\"]) else row[\"price_num\"]\n",
    "\n",
    "            # --- Info b√°sica ---\n",
    "            popup_html = f\"\"\"\n",
    "            <div style=\"font-size:14px;\">\n",
    "                <b>{row['nombre_final']}</b><br>\n",
    "                üìç {row['ciudad']}<br>\n",
    "                ‚≠ê {row['rating_final']} ({row['reviews_final']} rese√±as) | üí∂ {precio_txt}<br>\n",
    "                <a href=\"{row['maps_url_final']}\" target=\"_blank\">üåê Abrir en Google Maps</a><br>\n",
    "            \"\"\"\n",
    "\n",
    "            # --- Tel√©fono: preferir international_phone ---\n",
    "            if \"international_phone\" in row and pd.notna(row[\"international_phone\"]):\n",
    "                popup_html += f\"üìû {row['international_phone']}<br>\"\n",
    "            elif \"phone\" in row and pd.notna(row[\"phone\"]):\n",
    "                popup_html += f\"üìû {row['phone']}<br>\"\n",
    "\n",
    "            # --- Info extra ---\n",
    "            if \"website\" in row and pd.notna(row[\"website\"]):\n",
    "                popup_html += f\"<a href='{row['website']}' target='_blank'>üîó Web</a><br>\"\n",
    "            if \"email\" in row and pd.notna(row[\"email\"]):\n",
    "                popup_html += f\"‚úâÔ∏è {row['email']}<br>\"\n",
    "            if \"menu_link\" in row and pd.notna(row[\"menu_link\"]):\n",
    "                popup_html += f\"<a href='{row['menu_link']}' target='_blank'>üìã Men√∫</a><br>\"\n",
    "            if \"reservation_link\" in row and pd.notna(row[\"reservation_link\"]):\n",
    "                popup_html += f\"<a href='{row['reservation_link']}' target='_blank'>üìÖ Reservar</a><br>\"\n",
    "\n",
    "            # --- Servicios ---\n",
    "            if \"delivery\" in row and row[\"delivery\"] == 1:\n",
    "                popup_html += \"üöö Delivery<br>\"\n",
    "            if \"reservable\" in row and row[\"reservable\"] == 1:\n",
    "                popup_html += \"üìÖ Reservable<br>\"\n",
    "\n",
    "            # --- Imagen destacada ---\n",
    "            if \"featured_image\" in row and pd.notna(row[\"featured_image\"]):\n",
    "                popup_html += f\"<br><img src='{row['featured_image']}' width='200'>\"\n",
    "\n",
    "            popup_html += \"</div>\"\n",
    "\n",
    "            # --- Icono seg√∫n top3 o no ---\n",
    "            if row[\"nombre_final\"] in top3_nombres:\n",
    "                icono = folium.Icon(color=\"blue\", icon=\"star\", prefix=\"fa\")\n",
    "            else:\n",
    "                icono = folium.Icon(color=\"gray\", icon=\"cutlery\", prefix=\"fa\")\n",
    "\n",
    "            folium.Marker(\n",
    "                location=[row[\"latitude\"], row[\"longitude\"]],\n",
    "                popup=folium.Popup(popup_html, max_width=300),\n",
    "                tooltip=row[\"nombre_final\"],\n",
    "                icon=icono\n",
    "            ).add_to(mapa)\n",
    "\n",
    "    # üîé Leyenda con los mismos iconos que el mapa\n",
    "    legend_html = \"\"\"\n",
    "    <div style=\"\n",
    "        position: fixed;\n",
    "        bottom: 20px; left: 20px; width: 240px;\n",
    "        z-index:9999; font-size:14px;\n",
    "        background:white; padding:10px; border:2px solid grey; border-radius:8px;\">\n",
    "    <b>üîé Leyenda</b><br>\n",
    "    <i class=\"fa fa-user fa-lg\" style=\"color:red\"></i> Tu ubicaci√≥n<br>\n",
    "    <i class=\"fa fa-star fa-lg\" style=\"color:blue\"></i> Top 3 restaurantes<br>\n",
    "    <i class=\"fa fa-cutlery fa-lg\" style=\"color:gray\"></i> Otros restaurantes\n",
    "    </div>\n",
    "    \"\"\"\n",
    "    mapa.get_root().html.add_child(folium.Element(legend_html))\n",
    "\n",
    "\n",
    "    display(mapa)\n",
    "    return mapa\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "DPFFCOVOxMvl"
   },
   "outputs": [],
   "source": [
    "from datetime import datetime, timedelta\n",
    "import time  #  aseguramos el import correcto\n",
    "\n",
    "def asistente_recomendador():\n",
    "    print(\"üëã Bienvenido al recomendador gastron√≥mico\")\n",
    "\n",
    "    # --- Preguntar ciudad ---\n",
    "    ciudades_disponibles = sorted(df[\"ciudad\"].dropna().str.lower().unique())\n",
    "    while True:\n",
    "        ciudad = input(f\"\\nüìç Ciudades disponibles: {', '.join(ciudades_disponibles)}\\nüìç ¬øEn qu√© ciudad quieres comer? \").strip().lower()\n",
    "        if ciudad in ciudades_disponibles:\n",
    "            break\n",
    "        print(f\"‚ö†Ô∏è Ciudad no disponible: {ciudad}. Opciones v√°lidas: {', '.join(ciudades_disponibles)}\")\n",
    "\n",
    "    # --- Precio m√°ximo ---\n",
    "    while True:\n",
    "        precio_txt = input(\"\\nüí∞ Precio m√°ximo (1=barato ... 4=caro, ENTER = sin Precio m√°ximo): \").strip()\n",
    "        if not precio_txt:\n",
    "            precio_max = None\n",
    "            break\n",
    "        if precio_txt.isdigit() and 1 <= int(precio_txt) <= 4:\n",
    "            precio_max = float(precio_txt)\n",
    "            break\n",
    "        print(\"‚ö†Ô∏è Precio m√°ximo inv√°lido. Debe estar entre 1 y 4.\")\n",
    "\n",
    "    # --- Rating m√≠nimo ---\n",
    "    while True:\n",
    "        rating_txt = input(\"\\n‚≠ê Rating m√≠nimo (ej: 4.0, ENTER = sin Rating m√≠nimo ): \").strip().replace(\",\", \".\")\n",
    "        if not rating_txt:\n",
    "            rating_min = None\n",
    "            break\n",
    "        try:\n",
    "            rating_val = float(rating_txt)\n",
    "            if 0 <= rating_val <= 5:\n",
    "                rating_min = rating_val\n",
    "                break\n",
    "            else:\n",
    "                print(\"‚ö†Ô∏è Rating inv√°lido. Debe estar entre 0.0 y 5.0\")\n",
    "        except:\n",
    "            print(\"‚ö†Ô∏è Introduce un n√∫mero v√°lido (ej: 4.2).\")\n",
    "\n",
    "    # --- Flags (filtro principal) ---\n",
    "    flags_disponibles = [c.replace(\"flag_\", \"\") for c in df.columns if c.startswith(\"flag_\")]\n",
    "\n",
    "    print(\"\\nüìã Categor√≠as gastron√≥micas disponibles y sus subcategor√≠as:\")\n",
    "    for f in sorted(flags_disponibles):\n",
    "        maestro = f\n",
    "        posibles_subcats = [c for c in df.columns if c.startswith(f\"subcat_{maestro}_\")]\n",
    "        if posibles_subcats:\n",
    "            subcats_txt = \", \".join([c.replace(f\"subcat_{maestro}_\", \"\") for c in posibles_subcats])\n",
    "            print(f\"   - {maestro} ‚Üí [{subcats_txt}]\")\n",
    "        else:\n",
    "            print(f\"   - {maestro}\")\n",
    "\n",
    "    while True:\n",
    "        flags_txt = input(\n",
    "            \"üçî Indica una o varias categor√≠as separadas por coma (ej: pizza, veggie, italiana). ENTER = ninguna: \"\n",
    "        ).strip()\n",
    "\n",
    "        if not flags_txt:\n",
    "            flags = []\n",
    "            break\n",
    "\n",
    "        # Normalizar entrada y validar\n",
    "        flags_input = [x.strip().lower() for x in flags_txt.split(\",\") if x.strip()]\n",
    "        flags_invalidas = [f for f in flags_input if f not in flags_disponibles]\n",
    "\n",
    "        if flags_invalidas:\n",
    "            print(f\"‚ö†Ô∏è Las siguientes categor√≠as no son v√°lidas: {', '.join(flags_invalidas)}\")\n",
    "            print(\"üí° Revisa la lista anterior e intenta de nuevo.\\n\")\n",
    "            continue  # vuelve a pedir toda la lista\n",
    "\n",
    "        if not flags_input:\n",
    "            print(\"‚ö†Ô∏è No se reconoci√≥ ning√∫n filtro v√°lido. Int√©ntalo de nuevo.\\n\")\n",
    "            continue\n",
    "\n",
    "        # Si todo es v√°lido, convertir a formato flag_ y respetar el orden\n",
    "        flags = [\"flag_\" + f for f in flags_input]\n",
    "        print(f\"‚úÖ Categor√≠as seleccionadas: {', '.join(flags_input)}\")\n",
    "        break\n",
    "\n",
    "    # --- Subcategor√≠as ---\n",
    "    if flags:\n",
    "        for f in flags.copy():\n",
    "            maestro = f.replace(\"flag_\", \"\")\n",
    "            posibles_subcats = [c for c in df.columns if c.startswith(f\"subcat_{maestro}_\")]\n",
    "\n",
    "            if posibles_subcats:\n",
    "                subcats_limpias = [c.replace(f\"subcat_{maestro}_\", \"\") for c in posibles_subcats]\n",
    "\n",
    "                print(f\"\\nüìã Subcategor√≠as disponibles para {maestro}:\")\n",
    "                for sc in subcats_limpias:\n",
    "                    print(f\"   - {sc}\")\n",
    "                while True:\n",
    "                    subcat = input(f\"üëâ ¬øQuieres alguna subcategor√≠a de {maestro}? (ENTER = sin subcategor√≠a): \").strip().lower().replace(\" \", \"_\")\n",
    "                    if not subcat:\n",
    "                        break\n",
    "                    elif f\"subcat_{maestro}_{subcat}\" in df.columns:\n",
    "                        flags.append(f\"subcat_{maestro}_{subcat}\")\n",
    "                        print(f\"‚úÖ Subcategor√≠a a√±adida: {subcat}\")\n",
    "                        break\n",
    "                    else:\n",
    "                        print(f\"‚ö†Ô∏è Subcategor√≠a no v√°lida: {subcat}.\")\n",
    "                        print(\"üí° Revisa la lista anterior e intenta de nuevo.\\n\")\n",
    "\n",
    "\n",
    "    # --- Query (texto libre) ---\n",
    "    query = input(\"\\nüîé ¬øQuieres afinar con un t√©rmino libre (ej: terraza, barato, men√∫ degustaci√≥n...)? ENTER = ninguno: \").strip()\n",
    "\n",
    "    # --- Preguntar si quiere filtrar por d√≠a y horario ---\n",
    "    usar_horarios = None\n",
    "    while usar_horarios not in [\"s\", \"n\"]:\n",
    "        usar_horarios = input(\"\\nüìÖ ¬øQuieres filtrar por d√≠a y horario de apertura? (s/n): \").strip().lower()\n",
    "        if usar_horarios not in [\"s\", \"n\"]:\n",
    "            print(\"‚ö†Ô∏è Respuesta no v√°lida. Escribe 's' o 'n'.\")\n",
    "    usar_horarios = (usar_horarios == \"s\")\n",
    "\n",
    "    fecha_hora = None\n",
    "    if usar_horarios:\n",
    "        dias = [\"lunes\", \"martes\", \"mi√©rcoles\", \"jueves\", \"viernes\", \"s√°bado\", \"domingo\"]\n",
    "\n",
    "        # --- Pedir d√≠a ---\n",
    "        while True:\n",
    "            dia_txt = input(\"\\nüëâ D√≠a de la semana (ej: viernes, ENTER = hoy): \").strip().lower()\n",
    "            if not dia_txt:\n",
    "                # si el usuario da ENTER, se usa el d√≠a actual\n",
    "                fecha = datetime.now().date()\n",
    "                break\n",
    "            elif dia_txt in dias:\n",
    "                hoy = datetime.now()\n",
    "                dia_idx = dias.index(dia_txt)\n",
    "                delta_dias = (dia_idx - hoy.weekday()) % 7\n",
    "                fecha = (hoy + timedelta(days=delta_dias)).date()\n",
    "                break\n",
    "            else:\n",
    "                print(\"‚ö†Ô∏è D√≠a no v√°lido. Debe ser uno de:\", \", \".join(dias))\n",
    "\n",
    "        # --- Pedir hora ---\n",
    "        while True:\n",
    "            hora_txt = input(\"\\nüëâ Hora en formato 24h (ej: 22:00, ENTER = ahora): \").strip().replace(\".\", \":\")\n",
    "            if not hora_txt:\n",
    "                hora = datetime.now().time()\n",
    "                break\n",
    "            try:\n",
    "                hora = datetime.strptime(hora_txt, \"%H:%M\").time()\n",
    "                break\n",
    "            except ValueError:\n",
    "                print(\"‚ö†Ô∏è Hora no v√°lida. Usa el formato HH:MM (por ejemplo, 21:30).\")\n",
    "\n",
    "        fecha_hora = datetime.combine(fecha, hora)\n",
    "\n",
    "\n",
    "    # --- Direcci√≥n del usuario (opcional) ---\n",
    "    lat_user, lon_user = None, None  # valores por defecto\n",
    "    intentos = 0\n",
    "\n",
    "    while True:\n",
    "        direccion_usuario = input(\n",
    "            \"\\nüöó Introduce tu direcci√≥n (ej: 'R√∫a do Franco 10, Santiago de Compostela, A Coru√±a') \"\n",
    "            \"ENTER = sin direcci√≥n: \"\n",
    "        ).strip()\n",
    "\n",
    "        if not direccion_usuario:\n",
    "            print(\"‚ÑπÔ∏è No se indic√≥ direcci√≥n. Se continuar√° sin ubicaci√≥n.\")\n",
    "            break\n",
    "\n",
    "        lat_user, lon_user = direccion_a_coordenadas(direccion_usuario)\n",
    "        if lat_user and lon_user:\n",
    "            print(f\"‚úÖ Direcci√≥n reconocida: {direccion_usuario} ‚Üí ({lat_user:.5f}, {lon_user:.5f})\")\n",
    "            break\n",
    "        else:\n",
    "            intentos += 1\n",
    "            print(\"‚ö†Ô∏è No se pudo reconocer la direcci√≥n.\")\n",
    "            if intentos < 3:\n",
    "                print(\"üí° Prueba a escribirla con m√°s detalle (ejemplo: 'Calle Real 5, A Coru√±a, Galicia').\\n\")\n",
    "            else:\n",
    "                print(\"‚ùå No se pudo obtener la ubicaci√≥n tras varios intentos. Se continuar√° sin ubicaci√≥n.\")\n",
    "                lat_user, lon_user = None, None\n",
    "                break\n",
    "\n",
    "    # --- Ordenar proximidad (solo si hay direcci√≥n) ---\n",
    "    ordenar_por_proximidad = False\n",
    "\n",
    "    if lat_user and lon_user:\n",
    "        while True:\n",
    "            respuesta = input(\"üìç ¬øQuieres ordenar los resultados por cercan√≠a en coche? (s/n): \").strip().lower()\n",
    "\n",
    "            if respuesta in [\"s\", \"n\"]:\n",
    "                ordenar_por_proximidad = (respuesta == \"s\")\n",
    "                break\n",
    "\n",
    "            print(\"\\n‚ö†Ô∏è Respuesta no v√°lida. Escribe 's' para s√≠ o 'n' para no.\")\n",
    "\n",
    "\n",
    "    # --- B√∫squeda unificada ---\n",
    "    resultados = buscar_y_filtrar(\n",
    "        query=query,\n",
    "        flags=flags,\n",
    "        ciudad=ciudad,\n",
    "        precio_max=precio_max,\n",
    "        rating_min=rating_min,\n",
    "        top_n=20\n",
    "    )\n",
    "\n",
    "    # --- Normalizar horarios ---\n",
    "    if \"horarios_norm\" in resultados.columns:\n",
    "        resultados[\"horarios_lista\"] = resultados[\"horarios_norm\"].apply(parse_horarios)\n",
    "    else:\n",
    "        resultados = resultados.merge(df[[\"nombre_final\", \"horarios_norm\"]], on=\"nombre_final\", how=\"left\")\n",
    "        resultados[\"horarios_lista\"] = resultados[\"horarios_norm\"].apply(parse_horarios)\n",
    "\n",
    "    # --- Aplicar filtro si corresponde ---\n",
    "    if usar_horarios and fecha_hora:\n",
    "        resultados = filtrar_abiertos(resultados, fecha_hora=fecha_hora)\n",
    "\n",
    "    # --- Completar coordenadas ---\n",
    "    resultados = rellenar_coordenadas(resultados)\n",
    "\n",
    "    # --- Distancias coche y andando ---\n",
    "    if not resultados.empty and lat_user and lon_user:\n",
    "        resultados[\"distancia_haversine\"] = resultados.apply(\n",
    "            lambda row: haversine(lat_user, lon_user, row[\"latitude\"], row[\"longitude\"])\n",
    "            if pd.notna(row[\"latitude\"]) and pd.notna(row[\"longitude\"]) else None,\n",
    "            axis=1\n",
    "        )\n",
    "\n",
    "        candidatos = resultados.nsmallest(20, \"distancia_haversine\").copy()\n",
    "        for _, row in candidatos.iterrows():\n",
    "            try:\n",
    "                d_car_km, d_car_min = distancia_real(lat_user, lon_user, row[\"latitude\"], row[\"longitude\"], modo=\"driving-car\")\n",
    "                d_walk_km, d_walk_min = distancia_real(lat_user, lon_user, row[\"latitude\"], row[\"longitude\"], modo=\"foot-walking\")\n",
    "                resultados.loc[resultados[\"nombre_final\"] == row[\"nombre_final\"], \"distancia_car_km\"] = d_car_km\n",
    "                resultados.loc[resultados[\"nombre_final\"] == row[\"nombre_final\"], \"tiempo_car_min\"] = d_car_min\n",
    "                resultados.loc[resultados[\"nombre_final\"] == row[\"nombre_final\"], \"distancia_walk_km\"] = d_walk_km\n",
    "                resultados.loc[resultados[\"nombre_final\"] == row[\"nombre_final\"], \"tiempo_walk_min\"] = d_walk_min\n",
    "                time.sleep(1)  # ‚úÖ ahora correcto\n",
    "            except Exception as e:\n",
    "                print(f\"‚ö†Ô∏è Error calculando distancias para {row['nombre_final']}: {e}\")\n",
    "\n",
    "\n",
    "        # --- Reordenar resultados finales respetando prioridad ---\n",
    "        orden_cols = [\"criterio_orden\", \"rating_final\", \"reviews_final\"]\n",
    "        asc = [True, False, False]\n",
    "\n",
    "        if ordenar_por_proximidad:\n",
    "            # Insertamos distancia despu√©s de la prioridad, antes del rating\n",
    "            orden_cols.insert(1, \"distancia_car_km\")\n",
    "            asc.insert(1, True)\n",
    "\n",
    "        resultados = resultados.sort_values(\n",
    "            by=orden_cols, ascending=asc, kind=\"mergesort\"\n",
    "        )\n",
    "\n",
    "\n",
    "    # --- Mostrar resultados ---\n",
    "    if resultados.empty:\n",
    "        print(\"‚ùå No se encontraron restaurantes con esos criterios.\")\n",
    "    else:\n",
    "        print(\"\\n‚úÖ Aqu√≠ tienes tus recomendaciones:\")\n",
    "        for _, row in resultados.head(15).iterrows():\n",
    "            car_info = f\" üöó {row['distancia_car_km']:.1f} km | {row['tiempo_car_min']:.0f} min\" if pd.notna(row.get(\"distancia_car_km\")) else \"\"\n",
    "            walk_info = f\" üö∂ {row['distancia_walk_km']:.1f} km | {row['tiempo_walk_min']:.0f} min\" if pd.notna(row.get(\"distancia_walk_km\")) else \"\"\n",
    "\n",
    "            print(f\"‚û°Ô∏è {row['nombre_final']} ({row['ciudad']}) ‚≠ê {row['rating_final']} \"\n",
    "                  f\"({row['reviews_final']} rese√±as) üí∞ {row['price_num']}{car_info}{walk_info}\\n\"\n",
    "                  f\"   {row['maps_url_final']}\\n\"\n",
    "                  f\"   üìù Este restaurante se ha elegido porque cumple: {row['criterio']}\\n\")\n",
    "\n",
    "        # --- Mapa interactivo ---\n",
    "        resultados = resultados.dropna(subset=[\"latitude\", \"longitude\"])\n",
    "        if not resultados.empty:\n",
    "            # Ejecuta el asistente y guarda el mapa\n",
    "            m = mostrar_mapa(resultados.head(15), lat_user=lat_user, lon_user=lon_user)\n",
    "\n",
    "            # Exportar el mapa a HTML\n",
    "            if m is not None:\n",
    "                m.save(\"mapa_recomendador.html\")\n",
    "                print(\"‚úÖ Mapa exportado correctamente como 'mapa_recomendador.html'\")\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "AEUU8lAh8Ged"
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "\n",
    "# Cargar datasets\n",
    "df_core = pd.read_json(\"restaurantes_con_subcategorias.json\")   # el limpio\n",
    "df_extra = pd.read_json(\"restaurantes_extra.json\")         # info adicional"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "Q3yTxIsQ8XmX"
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "\n",
    "# Cargar datasets\n",
    "df_core = pd.read_json(\"restaurantes_con_subcategorias.json\")   # el limpio\n",
    "df_extra = pd.read_json(\"restaurantes_extra.json\")         # info adicional\n",
    "\n",
    "# Asegurar que tienen la columna id\n",
    "print(\"Core:\", df_core.shape, \"Extra:\", df_extra.shape)\n",
    "\n",
    "# Hacemos el merge por id (left = mantener solo los del core limpio)\n",
    "df_enriquecido = df_core.merge(df_extra, on=\"id\", how=\"left\")\n",
    "\n",
    "print(\"‚úÖ Dataset enriquecido:\", df_enriquecido.shape)\n",
    "\n",
    "# Guardar resultado para usar en el recomendador\n",
    "df_enriquecido.to_json(\"restaurantes_enriquecido.json\", orient=\"records\", force_ascii=False, indent=2)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "BBMmqENodUYV"
   },
   "source": [
    "## ***Recomendador***"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 1000
    },
    "collapsed": true,
    "executionInfo": {
     "elapsed": 84890,
     "status": "ok",
     "timestamp": 1763225611145,
     "user": {
      "displayName": "Javier Piay",
      "userId": "08145038044156931411"
     },
     "user_tz": -60
    },
    "id": "4Se-ZLFM6AU_",
    "outputId": "6bffa6f7-f3f9-4bae-bdd3-c3c0727a8078"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üëã Bienvenido al recomendador gastron√≥mico\n",
      "\n",
      "üìç Ciudades disponibles: a coru√±a, lugo, ourense, pontevedra, santiago, vigo\n",
      "üìç ¬øEn qu√© ciudad quieres comer? madrid\n",
      "‚ö†Ô∏è Ciudad no disponible: madrid. Opciones v√°lidas: a coru√±a, lugo, ourense, pontevedra, santiago, vigo\n",
      "\n",
      "üìç Ciudades disponibles: a coru√±a, lugo, ourense, pontevedra, santiago, vigo\n",
      "üìç ¬øEn qu√© ciudad quieres comer? a coru√±a\n",
      "\n",
      "üí∞ Precio m√°ximo (1=barato ... 4=caro, ENTER = sin Precio m√°ximo): 3\n",
      "\n",
      "‚≠ê Rating m√≠nimo (ej: 4.0, ENTER = sin Rating m√≠nimo ): 6.4\n",
      "‚ö†Ô∏è Rating inv√°lido. Debe estar entre 0.0 y 5.0\n",
      "\n",
      "‚≠ê Rating m√≠nimo (ej: 4.0, ENTER = sin Rating m√≠nimo ): 4.2\n",
      "\n",
      "üìã Categor√≠as gastron√≥micas disponibles y sus subcategor√≠as:\n",
      "   - africana\n",
      "   - asi√°tica ‚Üí [ramen, china, japonesa, india]\n",
      "   - carnes\n",
      "   - desayunos ‚Üí [brunch, cafeter√≠a]\n",
      "   - dulces ‚Üí [helados, pasteler√≠as]\n",
      "   - espa√±ola ‚Üí [pescados, men√∫_del_d√≠a, arroces, tapas, pulpo, mariscos, cocina_gallega]\n",
      "   - europea\n",
      "   - gourmet ‚Üí [men√∫_degustaci√≥n]\n",
      "   - hamburguesas\n",
      "   - italiana\n",
      "   - latina ‚Üí [venezolana, brasile√±a, salvadore√±a, peruana, boliviana, argentina]\n",
      "   - mexicana\n",
      "   - pizza\n",
      "   - poke\n",
      "   - r√°pida ‚Üí [bocadillos, autoservicio]\n",
      "   - turca\n",
      "   - veggie ‚Üí [vegetariano, vegano, sin_gluten]\n",
      "   - √°rabe\n",
      "üçî Indica una o varias categor√≠as separadas por coma (ej: pizza, veggie, italiana). ENTER = ninguna: espa√±ola\n",
      "‚úÖ Categor√≠as seleccionadas: espa√±ola\n",
      "\n",
      "üìã Subcategor√≠as disponibles para espa√±ola:\n",
      "   - pescados\n",
      "   - men√∫_del_d√≠a\n",
      "   - arroces\n",
      "   - tapas\n",
      "   - pulpo\n",
      "   - mariscos\n",
      "   - cocina_gallega\n",
      "üëâ ¬øQuieres alguna subcategor√≠a de espa√±ola? (ENTER = sin subcategor√≠a): pulpo\n",
      "‚úÖ Subcategor√≠a a√±adida: pulpo\n",
      "\n",
      "üîé ¬øQuieres afinar con un t√©rmino libre (ej: terraza, barato, men√∫ degustaci√≥n...)? ENTER = ninguno: barato\n",
      "\n",
      "üìÖ ¬øQuieres filtrar por d√≠a y horario de apertura? (s/n): s\n",
      "\n",
      "üëâ D√≠a de la semana (ej: viernes, ENTER = hoy): viernes\n",
      "\n",
      "üëâ Hora en formato 24h (ej: 22:00, ENTER = ahora): 22:30\n",
      "\n",
      "üöó Introduce tu direcci√≥n (ej: 'R√∫a do Franco 10, Santiago de Compostela, A Coru√±a') ENTER = sin direcci√≥n: estadio riazor, a coru√±a\n",
      "‚úÖ Direcci√≥n reconocida: estadio riazor, a coru√±a ‚Üí (43.36870, -8.41748)\n",
      "üìç ¬øQuieres ordenar los resultados por cercan√≠a en coche? (s/n): n\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "‚úÖ Aqu√≠ tienes tus recomendaciones:\n",
      "‚û°Ô∏è Pulpeira O Fiuza (a coru√±a) ‚≠ê 4.4 (3363 rese√±as) üí∞ 1.0 üöó 3.9 km | 8 min üö∂ 2.7 km | 32 min\n",
      "   https://maps.google.com/?cid=12965002102508580301&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincidencia exacta en texto ('barato') + flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Pulpeira do rompeolas (a coru√±a) ‚≠ê 4.3 (367 rese√±as) üí∞ 1.0 üöó 0.1 km | 0 min üö∂ 0.2 km | 2 min\n",
      "   https://maps.google.com/?cid=13538092360148595184&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincidencia exacta en texto ('barato') + flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Restaurante La Mas√≠a (a coru√±a) ‚≠ê 4.7 (1614 rese√±as) üí∞ 2.0 üöó 2.9 km | 6 min üö∂ 2.1 km | 25 min\n",
      "   https://maps.google.com/?cid=6974152603202816736&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Pulpeira de Lola La Antigua de Melide (a coru√±a) ‚≠ê 4.6 (3156 rese√±as) üí∞ 1.0 üöó 2.6 km | 5 min üö∂ 2.1 km | 25 min\n",
      "   https://maps.google.com/?cid=6457642486034185766&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Mi√±a Nai by DosRaices (a coru√±a) ‚≠ê 4.6 (358 rese√±as) üí∞ nan\n",
      "   https://maps.google.com/?cid=9017401117557207231&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Restaurante Luis (a coru√±a) ‚≠ê 4.5 (1019 rese√±as) üí∞ 1.0 üöó 40.2 km | 33 min üö∂ 37.6 km | 451 min\n",
      "   https://maps.google.com/?cid=11865598308238284077&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Lembranza (a coru√±a) ‚≠ê 4.5 (66 rese√±as) üí∞ 1.0 üöó 3.4 km | 7 min üö∂ 2.8 km | 34 min\n",
      "   https://maps.google.com/?cid=16232104871908236384&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è A Taberna de Cunqueiro (a coru√±a) ‚≠ê 4.4 (6715 rese√±as) üí∞ 1.0 üöó 1.3 km | 4 min üö∂ 1.3 km | 16 min\n",
      "   https://maps.google.com/?cid=16483483857867775265&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Restaurante La Sart√©n (a coru√±a) ‚≠ê 4.4 (2336 rese√±as) üí∞ 3.0 üöó 2.1 km | 6 min üö∂ 2.0 km | 23 min\n",
      "   https://maps.google.com/?cid=16726322293219331152&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Pulpeira de Arz√∫a (a coru√±a) ‚≠ê 4.4 (1145 rese√±as) üí∞ 1.0 üöó 2.9 km | 6 min üö∂ 2.2 km | 27 min\n",
      "   https://maps.google.com/?cid=17680445616790017379&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Pulpeira A Nova Lanchi√±a (a coru√±a) ‚≠ê 4.3 (3743 rese√±as) üí∞ 1.0 üöó 3.0 km | 6 min üö∂ 2.2 km | 26 min\n",
      "   https://maps.google.com/?cid=17631126293125342762&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è A Pulpeira De Melide (a coru√±a) ‚≠ê 4.2 (7317 rese√±as) üí∞ 2.0 üöó 2.0 km | 6 min üö∂ 1.9 km | 23 min\n",
      "   https://maps.google.com/?cid=1852299128374766643&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üìå Coincide con flag_espa√±ola + subcat_espa√±ola_pulpo\n",
      "\n",
      "‚û°Ô∏è Mahara taberna (a coru√±a) ‚≠ê 4.8 (583 rese√±as) üí∞ 1.0 üöó 1.8 km | 5 min üö∂ 1.6 km | 19 min\n",
      "   https://maps.google.com/?cid=6935440815486712986&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üîé Coincidencia exacta en texto ('barato')\n",
      "\n",
      "‚û°Ô∏è Marshall Pizza (a coru√±a) ‚≠ê 4.8 (440 rese√±as) üí∞ 1.0 üöó 0.6 km | 2 min üö∂ 0.6 km | 8 min\n",
      "   https://maps.google.com/?cid=14993012133824578498\n",
      "   üìù Este restaurante se ha elegido porque cumple: üîé Coincidencia exacta en texto ('barato')\n",
      "\n",
      "‚û°Ô∏è Taquer√≠a Ni√±o Rey (a coru√±a) ‚≠ê 4.8 (394 rese√±as) üí∞ 1.0 üöó 1.6 km | 4 min üö∂ 1.3 km | 15 min\n",
      "   https://maps.google.com/?cid=4110596099082726434&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA\n",
      "   üìù Este restaurante se ha elegido porque cumple: üîé Coincidencia exacta en texto ('barato')\n",
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n",
       "&lt;html&gt;\n",
       "&lt;head&gt;\n",
       "    \n",
       "    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n",
       "    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n",
       "    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n",
       "    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n",
       "    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n",
       "    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n",
       "    \n",
       "            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n",
       "                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n",
       "            &lt;style&gt;\n",
       "                #map_d1d32f053cd6f112eeb98e906a4d0700 {\n",
       "                    position: relative;\n",
       "                    width: 100.0%;\n",
       "                    height: 100.0%;\n",
       "                    left: 0.0%;\n",
       "                    top: 0.0%;\n",
       "                }\n",
       "                .leaflet-container { font-size: 1rem; }\n",
       "            &lt;/style&gt;\n",
       "\n",
       "            &lt;style&gt;html, body {\n",
       "                width: 100%;\n",
       "                height: 100%;\n",
       "                margin: 0;\n",
       "                padding: 0;\n",
       "            }\n",
       "            &lt;/style&gt;\n",
       "\n",
       "            &lt;style&gt;#map {\n",
       "                position:absolute;\n",
       "                top:0;\n",
       "                bottom:0;\n",
       "                right:0;\n",
       "                left:0;\n",
       "                }\n",
       "            &lt;/style&gt;\n",
       "\n",
       "            &lt;script&gt;\n",
       "                L_NO_TOUCH = false;\n",
       "                L_DISABLE_3D = false;\n",
       "            &lt;/script&gt;\n",
       "\n",
       "        \n",
       "&lt;/head&gt;\n",
       "&lt;body&gt;\n",
       "    \n",
       "    \n",
       "    &lt;div style=&quot;\n",
       "        position: fixed;\n",
       "        bottom: 20px; left: 20px; width: 240px;\n",
       "        z-index:9999; font-size:14px;\n",
       "        background:white; padding:10px; border:2px solid grey; border-radius:8px;&quot;&gt;\n",
       "    &lt;b&gt;üîé Leyenda&lt;/b&gt;&lt;br&gt;\n",
       "    &lt;i class=&quot;fa fa-user fa-lg&quot; style=&quot;color:red&quot;&gt;&lt;/i&gt; Tu ubicaci√≥n&lt;br&gt;\n",
       "    &lt;i class=&quot;fa fa-star fa-lg&quot; style=&quot;color:blue&quot;&gt;&lt;/i&gt; Top 3 restaurantes&lt;br&gt;\n",
       "    &lt;i class=&quot;fa fa-cutlery fa-lg&quot; style=&quot;color:gray&quot;&gt;&lt;/i&gt; Otros restaurantes\n",
       "    &lt;/div&gt;\n",
       "    \n",
       "    \n",
       "            &lt;div class=&quot;folium-map&quot; id=&quot;map_d1d32f053cd6f112eeb98e906a4d0700&quot; &gt;&lt;/div&gt;\n",
       "        \n",
       "&lt;/body&gt;\n",
       "&lt;script&gt;\n",
       "    \n",
       "    \n",
       "            var map_d1d32f053cd6f112eeb98e906a4d0700 = L.map(\n",
       "                &quot;map_d1d32f053cd6f112eeb98e906a4d0700&quot;,\n",
       "                {\n",
       "                    center: [43.38066, -8.399491],\n",
       "                    crs: L.CRS.EPSG3857,\n",
       "                    ...{\n",
       "  &quot;zoom&quot;: 14,\n",
       "  &quot;zoomControl&quot;: true,\n",
       "  &quot;preferCanvas&quot;: false,\n",
       "}\n",
       "\n",
       "                }\n",
       "            );\n",
       "\n",
       "            \n",
       "\n",
       "        \n",
       "    \n",
       "            var tile_layer_2ec6388acf918974e81555d30b77dc12 = L.tileLayer(\n",
       "                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n",
       "                {\n",
       "  &quot;minZoom&quot;: 0,\n",
       "  &quot;maxZoom&quot;: 19,\n",
       "  &quot;maxNativeZoom&quot;: 19,\n",
       "  &quot;noWrap&quot;: false,\n",
       "  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n",
       "  &quot;subdomains&quot;: &quot;abc&quot;,\n",
       "  &quot;detectRetina&quot;: false,\n",
       "  &quot;tms&quot;: false,\n",
       "  &quot;opacity&quot;: 1,\n",
       "}\n",
       "\n",
       "            );\n",
       "        \n",
       "    \n",
       "            tile_layer_2ec6388acf918974e81555d30b77dc12.addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var marker_76b8fd16738d9f36d04c24dd196527d8 = L.marker(\n",
       "                [43.368705, -8.417479],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_713729193014812139a76c7517bc393f = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;red&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;user&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_6a1e3aa36a3fb7ab9f0f2e62cb465703 = L.popup({\n",
       "  &quot;maxWidth&quot;: &quot;100%&quot;,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_15d7e1190aee12a9a3950b50a2db1bdc = $(`&lt;div id=&quot;html_15d7e1190aee12a9a3950b50a2db1bdc&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;üìç Tu ubicaci√≥n&lt;/div&gt;`)[0];\n",
       "                popup_6a1e3aa36a3fb7ab9f0f2e62cb465703.setContent(html_15d7e1190aee12a9a3950b50a2db1bdc);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_76b8fd16738d9f36d04c24dd196527d8.bindPopup(popup_6a1e3aa36a3fb7ab9f0f2e62cb465703)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "                marker_76b8fd16738d9f36d04c24dd196527d8.setIcon(icon_713729193014812139a76c7517bc393f);\n",
       "            \n",
       "    \n",
       "            var marker_283e786c96b49bf46e2dc036efe44ce8 = L.marker(\n",
       "                [43.38066, -8.399491],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_be19957efa02c2f902dcd801e2f9723a = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;blue&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;star&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_11bba8c837a11d39909ea8f9f6605506 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_7985cf1449a9684b781d86e650489637 = $(`&lt;div id=&quot;html_7985cf1449a9684b781d86e650489637&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Pulpeira O Fiuza&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.4 (3363 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=12965002102508580301&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 92 34 70&lt;br&gt;&lt;a href=&#x27;http://www.pulpeiraofiuza.com/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è marlauralucia@hotmail.com&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-m/1280/2e/8d/6c/fb/caption.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_11bba8c837a11d39909ea8f9f6605506.setContent(html_7985cf1449a9684b781d86e650489637);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_283e786c96b49bf46e2dc036efe44ce8.bindPopup(popup_11bba8c837a11d39909ea8f9f6605506)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_283e786c96b49bf46e2dc036efe44ce8.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Pulpeira O Fiuza\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_283e786c96b49bf46e2dc036efe44ce8.setIcon(icon_be19957efa02c2f902dcd801e2f9723a);\n",
       "            \n",
       "    \n",
       "            var marker_00aba27e23df3c6d20bffc5119367890 = L.marker(\n",
       "                [43.369694, -8.416663],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_c7a1eb0e14fd52877994f1fb1d48d431 = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;blue&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;star&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_01dad743a2aac16182d2143aeabba979 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_795c91b99a9986ec421d2fe9850c88e9 = $(`&lt;div id=&quot;html_795c91b99a9986ec421d2fe9850c88e9&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Pulpeira do rompeolas&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.3 (367 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=13538092360148595184&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 881 92 54 25&lt;br&gt;&lt;a href=&#x27;https://rompeolaspulpeira.es/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è info@rompeolaspulpeira.es&lt;br&gt;&lt;a href=&#x27;https://rompeolaspulpeira.es/carta-pulpeira/&#x27; target=&#x27;_blank&#x27;&gt;üìã Men√∫&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-w/18/8d/8a/c7/img-20190705-wa0076-largejpg.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_01dad743a2aac16182d2143aeabba979.setContent(html_795c91b99a9986ec421d2fe9850c88e9);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_00aba27e23df3c6d20bffc5119367890.bindPopup(popup_01dad743a2aac16182d2143aeabba979)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_00aba27e23df3c6d20bffc5119367890.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Pulpeira do rompeolas\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_00aba27e23df3c6d20bffc5119367890.setIcon(icon_c7a1eb0e14fd52877994f1fb1d48d431);\n",
       "            \n",
       "    \n",
       "            var marker_c932f2bea848618ecabd74f8e01cc32c = L.marker(\n",
       "                [43.354233, -8.415129],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_c2ccf318e58042a6fefaa375d9a7bdbe = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;blue&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;star&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_840669ea3745f83a9c84992f251d80a3 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_6719e5f23b401a8b511d03f2bd11a9e6 = $(`&lt;div id=&quot;html_6719e5f23b401a8b511d03f2bd11a9e6&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Restaurante La Mas√≠a&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.7 (1614 rese√±as) | üí∂ 2.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=6974152603202816736&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 854 62 00 41&lt;br&gt;&lt;a href=&#x27;https://restaurante.covermanager.com/reserva-en-la-masia/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/0c/49/76/ea/nuestra-terraza.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_840669ea3745f83a9c84992f251d80a3.setContent(html_6719e5f23b401a8b511d03f2bd11a9e6);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_c932f2bea848618ecabd74f8e01cc32c.bindPopup(popup_840669ea3745f83a9c84992f251d80a3)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_c932f2bea848618ecabd74f8e01cc32c.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Restaurante La Mas√≠a\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_c932f2bea848618ecabd74f8e01cc32c.setIcon(icon_c2ccf318e58042a6fefaa375d9a7bdbe);\n",
       "            \n",
       "    \n",
       "            var marker_0c302f1a253d42a64f34037b02ae7848 = L.marker(\n",
       "                [43.355002999999996, -8.411828],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_a9d136fbf99cfebc9d1ac1852b5e234e = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_fd5579d60779384e4da1f69a2200d5a9 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_96daefe0668d97e8c1fc50d9c53c26c8 = $(`&lt;div id=&quot;html_96daefe0668d97e8c1fc50d9c53c26c8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Pulpeira de Lola La Antigua de Melide&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.6 (3156 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=6457642486034185766&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 23 61 64&lt;br&gt;&lt;a href=&#x27;https://www.facebook.com/pulpeiradelolalaantiguademelide/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è pulpeiradelola@gmail.com&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/17/49/d6/10/una-racion-de-pulpo-y.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_fd5579d60779384e4da1f69a2200d5a9.setContent(html_96daefe0668d97e8c1fc50d9c53c26c8);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_0c302f1a253d42a64f34037b02ae7848.bindPopup(popup_fd5579d60779384e4da1f69a2200d5a9)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_0c302f1a253d42a64f34037b02ae7848.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Pulpeira de Lola La Antigua de Melide\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_0c302f1a253d42a64f34037b02ae7848.setIcon(icon_a9d136fbf99cfebc9d1ac1852b5e234e);\n",
       "            \n",
       "    \n",
       "            var marker_69fdd20cbab8bc5ebc228b8b8d8943e6 = L.marker(\n",
       "                [43.4065077, -8.1700427],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_d58c9b34c53ac5725b6dd31df87ee9a9 = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_8bc069cea52581121d6fc2017c60cff4 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_836e230c4efaa6e2e5b0ea86239899ef = $(`&lt;div id=&quot;html_836e230c4efaa6e2e5b0ea86239899ef&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Restaurante Luis&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.5 (1019 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=11865598308238284077&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 666 54 79 84&lt;br&gt;&lt;a href=&#x27;https://www.buenacarta.es/qr5236&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_8bc069cea52581121d6fc2017c60cff4.setContent(html_836e230c4efaa6e2e5b0ea86239899ef);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_69fdd20cbab8bc5ebc228b8b8d8943e6.bindPopup(popup_8bc069cea52581121d6fc2017c60cff4)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_69fdd20cbab8bc5ebc228b8b8d8943e6.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Restaurante Luis\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_69fdd20cbab8bc5ebc228b8b8d8943e6.setIcon(icon_d58c9b34c53ac5725b6dd31df87ee9a9);\n",
       "            \n",
       "    \n",
       "            var marker_8f8b9638709a966b26189c7011611e6a = L.marker(\n",
       "                [43.3499, -8.40815],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_c0b4b62c85897873b4e5750972436e9b = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_04e403310f82988fcc8139d5f1e2e6d5 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_54aeb82036460b6749ce7ef0c69b0c01 = $(`&lt;div id=&quot;html_54aeb82036460b6749ce7ef0c69b0c01&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Lembranza&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.5 (66 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=16232104871908236384&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 698 14 41 29&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_04e403310f82988fcc8139d5f1e2e6d5.setContent(html_54aeb82036460b6749ce7ef0c69b0c01);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_8f8b9638709a966b26189c7011611e6a.bindPopup(popup_04e403310f82988fcc8139d5f1e2e6d5)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_8f8b9638709a966b26189c7011611e6a.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Lembranza\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_8f8b9638709a966b26189c7011611e6a.setIcon(icon_c0b4b62c85897873b4e5750972436e9b);\n",
       "            \n",
       "    \n",
       "            var marker_0a40f466f63dbef912f55d4a0f62185b = L.marker(\n",
       "                [43.368713, -8.403434],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_2acc2e46cf5f566a09bf2c5ed71eafee = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_b93ca89f01784754ed4bdec9b36e31ba = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_e7299247718682edaca5616eb0b90d77 = $(`&lt;div id=&quot;html_e7299247718682edaca5616eb0b90d77&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;A Taberna de Cunqueiro&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.4 (6715 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=16483483857867775265&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 21 26 29&lt;br&gt;&lt;a href=&#x27;http://www.atabernadecunqueiro.com/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è info@atabernadecunqueiro.com&lt;br&gt;üöö Delivery&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/14/ab/fa/05/20180916-130143-largejpg.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_b93ca89f01784754ed4bdec9b36e31ba.setContent(html_e7299247718682edaca5616eb0b90d77);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_0a40f466f63dbef912f55d4a0f62185b.bindPopup(popup_b93ca89f01784754ed4bdec9b36e31ba)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_0a40f466f63dbef912f55d4a0f62185b.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     A Taberna de Cunqueiro\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_0a40f466f63dbef912f55d4a0f62185b.setIcon(icon_2acc2e46cf5f566a09bf2c5ed71eafee);\n",
       "            \n",
       "    \n",
       "            var marker_3a970cbf2d5567bcf2521bab21adf399 = L.marker(\n",
       "                [43.372753, -8.396715],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_be163e790d63ea56d4df2bd8c9e797cb = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_c5537cf59ec512e1a00c025c21100720 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_ba06d2c9be45207b56291e4ada91ba2f = $(`&lt;div id=&quot;html_ba06d2c9be45207b56291e4ada91ba2f&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Restaurante La Sart√©n&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.4 (2336 rese√±as) | üí∂ 3.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=16726322293219331152&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 91 93 13&lt;br&gt;&lt;a href=&#x27;http://www.restaurantelasarten.com/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è info@restaurantelasarten.com&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/05/e2/75/b8/restaurante-la-sarten.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_c5537cf59ec512e1a00c025c21100720.setContent(html_ba06d2c9be45207b56291e4ada91ba2f);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_3a970cbf2d5567bcf2521bab21adf399.bindPopup(popup_c5537cf59ec512e1a00c025c21100720)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_3a970cbf2d5567bcf2521bab21adf399.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Restaurante La Sart√©n\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_3a970cbf2d5567bcf2521bab21adf399.setIcon(icon_be163e790d63ea56d4df2bd8c9e797cb);\n",
       "            \n",
       "    \n",
       "            var marker_9f24a1ddbef38bf84eaa044553653efd = L.marker(\n",
       "                [43.35456, -8.409228],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_42c5232c71217c156a1dd958f38cef2c = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_4b0929e43fceeb7eadbfcdffbfe2a2ec = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_ade47bd5dce6b5feeaa460a4c2f2ba21 = $(`&lt;div id=&quot;html_ade47bd5dce6b5feeaa460a4c2f2ba21&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Pulpeira de Arz√∫a&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.4 (1145 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=17680445616790017379&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 23 50 76&lt;br&gt;&lt;a href=&#x27;http://www.pulpeiradearzua.es/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/14/54/46/c6/img-20180826-211646-largejpg.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_4b0929e43fceeb7eadbfcdffbfe2a2ec.setContent(html_ade47bd5dce6b5feeaa460a4c2f2ba21);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_9f24a1ddbef38bf84eaa044553653efd.bindPopup(popup_4b0929e43fceeb7eadbfcdffbfe2a2ec)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_9f24a1ddbef38bf84eaa044553653efd.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Pulpeira de Arz√∫a\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_9f24a1ddbef38bf84eaa044553653efd.setIcon(icon_42c5232c71217c156a1dd958f38cef2c);\n",
       "            \n",
       "    \n",
       "            var marker_ae5e7b2b5336c2d732a4f0927a5df3a4 = L.marker(\n",
       "                [43.355347, -8.407868],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_a3d5000eece9d57f18627f6c04cf856e = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_c933b55d3f89e65f44f7eac38a3320aa = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_227906842826352b084840752875ed77 = $(`&lt;div id=&quot;html_227906842826352b084840752875ed77&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Pulpeira A Nova Lanchi√±a&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.3 (3743 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=17631126293125342762&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 91 68 29&lt;br&gt;&lt;a href=&#x27;http://www.anovalanchi√±a.es/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/0d/c8/74/26/20161202-132037-largejpg.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_c933b55d3f89e65f44f7eac38a3320aa.setContent(html_227906842826352b084840752875ed77);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_ae5e7b2b5336c2d732a4f0927a5df3a4.bindPopup(popup_c933b55d3f89e65f44f7eac38a3320aa)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_ae5e7b2b5336c2d732a4f0927a5df3a4.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Pulpeira A Nova Lanchi√±a\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_ae5e7b2b5336c2d732a4f0927a5df3a4.setIcon(icon_a3d5000eece9d57f18627f6c04cf856e);\n",
       "            \n",
       "    \n",
       "            var marker_211c05d318c330f4ac72b1fa68ad33a0 = L.marker(\n",
       "                [43.37284, -8.397186],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_4f1c88b223fe41cfa7f1509f955d3686 = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_98a2bb8c5d5da8e97e6688130e66b47d = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_46d6a4c1022486d13b77373d659fc0ba = $(`&lt;div id=&quot;html_46d6a4c1022486d13b77373d659fc0ba&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;A Pulpeira De Melide&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.2 (7317 rese√±as) | üí∂ 2.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=1852299128374766643&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 15 21 97&lt;br&gt;&lt;a href=&#x27;http://www.pulpeirademelide.com/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è info@pulpeirademelide.com&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-o/0c/67/fb/3a/pulpeira-de-melide.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_98a2bb8c5d5da8e97e6688130e66b47d.setContent(html_46d6a4c1022486d13b77373d659fc0ba);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_211c05d318c330f4ac72b1fa68ad33a0.bindPopup(popup_98a2bb8c5d5da8e97e6688130e66b47d)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_211c05d318c330f4ac72b1fa68ad33a0.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     A Pulpeira De Melide\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_211c05d318c330f4ac72b1fa68ad33a0.setIcon(icon_4f1c88b223fe41cfa7f1509f955d3686);\n",
       "            \n",
       "    \n",
       "            var marker_e02dff1515e83d1413195c0244f01bef = L.marker(\n",
       "                [43.3718, -8.4009],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_5d20450e8fddd60f67e53bc507bbac92 = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_278e4ed1167fdd7c67534f206fc4ad3c = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_0d579bfa9b404a6cdcf6d419ba3a9f3a = $(`&lt;div id=&quot;html_0d579bfa9b404a6cdcf6d419ba3a9f3a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Mahara taberna&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.8 (583 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=6935440815486712986&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 981 07 56 34&lt;br&gt;&lt;a href=&#x27;https://m.facebook.com/maharatabernarock/?locale2=es_ES&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-m/1280/1d/90/64/9b/caption.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_278e4ed1167fdd7c67534f206fc4ad3c.setContent(html_0d579bfa9b404a6cdcf6d419ba3a9f3a);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_e02dff1515e83d1413195c0244f01bef.bindPopup(popup_278e4ed1167fdd7c67534f206fc4ad3c)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_e02dff1515e83d1413195c0244f01bef.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Mahara taberna\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_e02dff1515e83d1413195c0244f01bef.setIcon(icon_5d20450e8fddd60f67e53bc507bbac92);\n",
       "            \n",
       "    \n",
       "            var marker_10aff5a6b5e377fa4577be1269f93d59 = L.marker(\n",
       "                [43.37197, -8.423036],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_82a166824896ae21b0695e56a844ceac = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_076683a4f2c091ae379f9c23ec57a49a = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_9b7076a42226a89df775afa6a35d023c = $(`&lt;div id=&quot;html_9b7076a42226a89df775afa6a35d023c&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Marshall Pizza&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.8 (440 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=14993012133824578498&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 881 04 89 40&lt;br&gt;&lt;a href=&#x27;https://marshall-pizza.order.app.hd.digital/menus&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;üöö Delivery&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_076683a4f2c091ae379f9c23ec57a49a.setContent(html_9b7076a42226a89df775afa6a35d023c);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_10aff5a6b5e377fa4577be1269f93d59.bindPopup(popup_076683a4f2c091ae379f9c23ec57a49a)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_10aff5a6b5e377fa4577be1269f93d59.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Marshall Pizza\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_10aff5a6b5e377fa4577be1269f93d59.setIcon(icon_82a166824896ae21b0695e56a844ceac);\n",
       "            \n",
       "    \n",
       "            var marker_2786f76578e1f4f4927f794f75e4bb0e = L.marker(\n",
       "                [43.360546, -8.417662],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_bed2d036282179ac7b9ab85e14ccf957 = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_aac47b83c48cd80f4e1d093ff7e95baa = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_8f8e756c0a1107fdd52ec8c90fd51532 = $(`&lt;div id=&quot;html_8f8e756c0a1107fdd52ec8c90fd51532&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Taquer√≠a Ni√±o Rey&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.8 (394 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=4110596099082726434&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 668 59 29 68&lt;br&gt;&lt;a href=&#x27;https://taquerianinorey.es/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è businessramosmontes@gmail.com&lt;br&gt;üöö Delivery&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-m/1280/2a/4a/76/e3/caption.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_aac47b83c48cd80f4e1d093ff7e95baa.setContent(html_8f8e756c0a1107fdd52ec8c90fd51532);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_2786f76578e1f4f4927f794f75e4bb0e.bindPopup(popup_aac47b83c48cd80f4e1d093ff7e95baa)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_2786f76578e1f4f4927f794f75e4bb0e.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Taquer√≠a Ni√±o Rey\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_2786f76578e1f4f4927f794f75e4bb0e.setIcon(icon_bed2d036282179ac7b9ab85e14ccf957);\n",
       "            \n",
       "    \n",
       "            var marker_a53db32126244c1d67a73195cf2012cf = L.marker(\n",
       "                [43.368256, -8.405438],\n",
       "                {\n",
       "}\n",
       "            ).addTo(map_d1d32f053cd6f112eeb98e906a4d0700);\n",
       "        \n",
       "    \n",
       "            var icon_f3b050fd214d50b47f9787b136369ccf = L.AwesomeMarkers.icon(\n",
       "                {\n",
       "  &quot;markerColor&quot;: &quot;gray&quot;,\n",
       "  &quot;iconColor&quot;: &quot;white&quot;,\n",
       "  &quot;icon&quot;: &quot;cutlery&quot;,\n",
       "  &quot;prefix&quot;: &quot;fa&quot;,\n",
       "  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "        var popup_e374821f56c507cba491e3b5276e74a4 = L.popup({\n",
       "  &quot;maxWidth&quot;: 300,\n",
       "});\n",
       "\n",
       "        \n",
       "            \n",
       "                var html_b06845848ebbd9af49199e659d23eb33 = $(`&lt;div id=&quot;html_b06845848ebbd9af49199e659d23eb33&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;             &lt;div style=&quot;font-size:14px;&quot;&gt;                 &lt;b&gt;Gazteka&lt;/b&gt;&lt;br&gt;                 üìç a coru√±a&lt;br&gt;                 ‚≠ê 4.7 (1957 rese√±as) | üí∂ 1.0&lt;br&gt;                 &lt;a href=&quot;https://maps.google.com/?cid=14020558532091895716&amp;g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAAYBCAA&quot; target=&quot;_blank&quot;&gt;üåê Abrir en Google Maps&lt;/a&gt;&lt;br&gt;             üìû +34 604 07 16 43&lt;br&gt;&lt;a href=&#x27;http://www.gazteka.com/&#x27; target=&#x27;_blank&#x27;&gt;üîó Web&lt;/a&gt;&lt;br&gt;‚úâÔ∏è gazteka.21@gmail.com&lt;br&gt;&lt;a href=&#x27;https://gazteka.com/carta-restaurante-gazteka/&#x27; target=&#x27;_blank&#x27;&gt;üìã Men√∫&lt;/a&gt;&lt;br&gt;üöö Delivery&lt;br&gt;üìÖ Reservable&lt;br&gt;&lt;br&gt;&lt;img src=&#x27;https://media-cdn.tripadvisor.com/media/photo-m/1280/1e/13/d0/1f/gazteka.jpg&#x27; width=&#x27;200&#x27;&gt;&lt;/div&gt;&lt;/div&gt;`)[0];\n",
       "                popup_e374821f56c507cba491e3b5276e74a4.setContent(html_b06845848ebbd9af49199e659d23eb33);\n",
       "            \n",
       "        \n",
       "\n",
       "        marker_a53db32126244c1d67a73195cf2012cf.bindPopup(popup_e374821f56c507cba491e3b5276e74a4)\n",
       "        ;\n",
       "\n",
       "        \n",
       "    \n",
       "    \n",
       "            marker_a53db32126244c1d67a73195cf2012cf.bindTooltip(\n",
       "                `&lt;div&gt;\n",
       "                     Gazteka\n",
       "                 &lt;/div&gt;`,\n",
       "                {\n",
       "  &quot;sticky&quot;: true,\n",
       "}\n",
       "            );\n",
       "        \n",
       "    \n",
       "                marker_a53db32126244c1d67a73195cf2012cf.setIcon(icon_f3b050fd214d50b47f9787b136369ccf);\n",
       "            \n",
       "&lt;/script&gt;\n",
       "&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>"
      ],
      "text/plain": [
       "<folium.folium.Map at 0x7a7a228b0920>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Mapa exportado correctamente como 'mapa_recomendador.html'\n"
     ]
    }
   ],
   "source": [
    "# Ejecutar solo esta celda\n",
    "asistente_recomendador()"
   ]
  }
 ],
 "metadata": {
  "colab": {
   "authorship_tag": "ABX9TyNd6YLCkRBjSjePjERegNJm",
   "mount_file_id": "1P7gH2typDsKgg64zxZSSdwbEXruVKKn4",
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3",
   "name": "python3"
  },
  "language_info": {
   "name": "python"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
